<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Financeiro - Clinica Dr. Leonardo</title>
    <link rel="icon" type="image/x-icon" href="468038433_1127108832442232_1209364678782051882_n.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #f4d03f 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* === ESTILOS DA TELA DE LOGIN === */
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            width: 100%;
            max-width: 900px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 500px;
            margin: 0 auto;
            margin-top: 5vh;
        }

        .login-left {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-left::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="60" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }

        .logo {
            font-size: 4em;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            animation: pulse 2s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .login-left h1 {
            font-size: 2.2em;
            margin-bottom: 15px;
            font-weight: 300;
            position: relative;
            z-index: 1;
        }

        .login-left p {
            font-size: 1.1em;
            opacity: 0.9;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .features {
            margin-top: 30px;
            position: relative;
            z-index: 1;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            font-size: 0.95em;
        }

        .feature-icon {
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 12px;
        }

        .login-right {
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-form {
            width: 100%;
        }

        .login-form h2 {
            color: #1e3c72;
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .login-form .subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 1em;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 0.95em;
        }

        .form-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2a5298;
            background: white;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .form-group input::placeholder {
            color: #999;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 38px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            user-select: none;
        }

        .remember-forgot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .remember-me {
            display: flex;
            align-items: center;
        }

        .remember-me input {
            margin-right: 8px;
            width: auto;
        }

        .forgot-password {
            color: #2a5298;
            text-decoration: none;
            font-weight: 500;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 60, 114, 0.3);
        }

        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
            border-left: 4px solid #dc3545;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
            border-left: 4px solid #28a745;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2a5298;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === ESTILOS DO SISTEMA FINANCEIRO === */
        .sistema-container {
            max-width: 1700px; 
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: #f8f9fa;
            font-size: 12px;
            font-weight: 500;
            color: #333;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-bottom: 3px solid #f4d03f;
        }

        .tab-content { display: none; padding: 30px; min-height: 500px; }

        .tab-content.active { display: block; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .card h3 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #f4d03f;
            padding-bottom: 5px;
        }

        .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 5px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-card h4 {
            margin-bottom: 10px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .summary-card .value {
            font-size: 1.4em;
            font-weight: bold;
        }

        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 5px;
        }

        .transaction-item {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transaction-item:hover {
            background-color: #f8f9fa;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .transaction-value.receita {
            color: #28a745;
        }

        .transaction-value.despesa {
            color: #dc3545;
        }

        .transaction-date {
            font-size: 0.9em;
            color: #6c757d;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .table th, .table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            font-size: 13px;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .valor-detalhado {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }

        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-pendente {
            background: #ffc107;
            color: #212529;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            border: none;
        }

        .status-pago {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            border: none;
        }

        .status-cancelada {
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            border: none;
        }

        /* Estilos espec√≠ficos para cirurgias */
        .insumo-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }

        .resumo-financeiro {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid #1e3c72;
        }

        .margem-alta {
            color: #28a745 !important;
            font-weight: bold;
        }

        .margem-media {
            color: #ffc107 !important;
            font-weight: bold;
        }

        .margem-baixa {
            color: #dc3545 !important;
            font-weight: bold;
        }

        .detalhes-cirurgia {
            font-size: 0.85em;
            color: #666;
            margin-top: 3px;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .login-container {
                grid-template-columns: 1fr;
                max-width: 400px;
            }

            .login-left {
                padding: 40px 30px;
            }

            .login-right {
                padding: 40px 30px;
            }

            .logo {
                font-size: 3em;
            }

            .features {
                display: none;
            }
        }

        /* Estados de exibi√ß√£o - CORRIGIDO */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        /* Anima√ß√µes para notifica√ß√µes */
        @keyframes slideIn {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Estilos para o status de salvamento */
        .status-salvamento {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .status-salvamento:hover {
            background: rgba(0,0,0,0.9);
        }
    </style>
</head>
<body>
    <div id="telaLogin" class="visible">
        <div class="login-container">
            <div class="login-left">
                <div class="logo">üëÅÔ∏è</div>
                <h1>
        <img src="468038433_1127108832442232_1209364678782051882_n.jpg" 
             alt="Logo" 
             style="height:40px; vertical-align:middle; margin-right:10px;">
        Sistema Financeiro
    </h1>
                <p>Gest√£o completa e inteligente para cl√≠nicas oftalmol√≥gicas</p>
                
                <div class="features">
                    <div class="feature-item">
                        <div class="feature-icon">üìä</div>
                        <span>Dashboard em tempo real</span>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üí∞</div>
                        <span>Controle de receitas e despesas</span>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üè•</div>
                        <span>Gest√£o completa de cirurgias</span>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üìã</div>
                        <span>Relat√≥rios detalhados</span>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üì¶</div>
                        <span>Controle de estoque</span>
                    </div>
                </div>
            </div>

            <div class="login-right">
                <form class="login-form" id="loginForm">
                    <h2>Acesso ao Sistema</h2>
                    <p class="subtitle">Entre com suas credenciais para acessar</p>

                    <div class="error-message" id="errorMessage"></div>
                    <div class="success-message" id="successMessage"></div>

                    <div class="form-group">
                        <label for="username">Usu√°rio</label>
                        <input 
                            type="text" 
                            id="username" 
                            name="username" 
                            placeholder="Digite seu usu√°rio"
                            required
                            autocomplete="username"
                        >
                    </div>

                    <div class="form-group">
                        <label for="password">Senha</label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            placeholder="Digite sua senha"
                            required
                            autocomplete="current-password"
                        >
                        <span class="password-toggle" onclick="togglePassword()">üëÅÔ∏è</span>
                    </div>

                    <div class="remember-forgot">
                        <label class="remember-me">
                            <input type="checkbox" id="rememberMe" name="rememberMe">
                            Lembrar de mim
                        </label>
                        <a href="#" class="forgot-password" onclick="mostrarRecuperacao()">Esqueceu a senha?</a>
                    </div>

                    <button type="submit" class="login-btn" id="loginBtn">
                        Entrar no Sistema
                    </button>

                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <span>Verificando credenciais...</span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="telaSistema" class="hidden">
        <div class="sistema-container">
            <div class="header">
                <button class="logout-btn" onclick="fazerLogout()">üö™ Sair</button>
                <h1>
        <img src="468038433_1127108832442232_1209364678782051882_n.jpg" 
             alt="Logo" 
             style="height:40px; vertical-align:middle; margin-right:10px;">
        Sistema Financeiro
    </h1>
                <p>Clinica Oftalmologica Dr. Leonardo</p>
                <div style="margin-top: 15px;">
                    <button onclick="adicionarDadosExemplo()" style="background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 5px; margin: 5px; cursor: pointer;">
                        Adicionar Dados de Exemplo
                    </button>
                    <button onclick="salvarDados()" style="background: rgba(40,167,69,0.8); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 5px; margin: 5px; cursor: pointer;">
                        üíæ Salvar Dados
                    </button>
                    <button onclick="exportarBackup()" style="background: rgba(0,123,255,0.8); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 5px; margin: 5px; cursor: pointer;">
                        üì• Baixar Backup
                    </button>
                    <button onclick="document.getElementById('fileInput').click()" style="background: rgba(255,193,7,0.8); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 5px; margin: 5px; cursor: pointer;">
                        üì§ Carregar Backup
                    </button>
                    <button onclick="limparTodosDados()" style="background: rgba(220,53,69,0.8); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 5px; margin: 5px; cursor: pointer;">
                        üóëÔ∏è Limpar Todos os Dados
                    </button>
                    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="importarBackup(event)">
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="abrirAba('dashboard')">Dashboard</div>
                <div class="tab" onclick="abrirAba('receitas')">Receitas</div>
                <div class="tab" onclick="abrirAba('despesas')">Despesas</div>
                <div class="tab" onclick="abrirAba('cirurgias')">Cirurgias</div>
                <div class="tab" onclick="abrirAba('parcelas')">Parcelas</div>
                <div class="tab" onclick="abrirAba('insumos')">Insumos</div>
                <div class="tab" onclick="abrirAba('financeiro')">Financeiro</div>
                <div class="tab" onclick="abrirAba('relatorios')">Relatorios</div>
            </div>

            
<div id="dashboard" class="tab-content active">

<div class="card" style="margin-bottom: 20px;">
  <h3>Per√≠odo do Dashboard</h3>
  <div style="display:flex; gap:12px; flex-wrap: wrap; align-items: end; margin-top:10px;">
    <div class="form-group" style="min-width: 220px;">
      <label>Selecione o per√≠odo</label>
      <select id="filtroPeriodo">
        <option value="mes-atual">M√™s Atual</option>
        <option value="mes-anterior">M√™s Anterior</option>
        <option value="3m">√öltimos 3 meses</option>
        <option value="6m" selected>√öltimos 6 meses</option>
        <option value="12m">√öltimos 12 meses</option>
        <option value="ano-atual">Ano Atual</option>
        <option value="personalizado">Personalizado</option>
      </select>
    </div>
    <div class="form-group" id="rangePersonalizado" style="display:none;">
      <label>Data inicial</label>
      <input type="date" id="periodoDataInicial">
    </div>
    <div class="form-group" id="rangePersonalizado2" style="display:none;">
      <label>Data final</label>
      <input type="date" id="periodoDataFinal">
    </div>
    <button class="btn" type="button" id="aplicarPeriodoBtn">Aplicar</button>
  </div>
</div>

                <div class="summary-cards">
                    <div class="summary-card">
                        <h4>Saldo Atual</h4>
                        <div class="value" id="saldoAtual">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h4>Receita (per√≠odo)</h4>
                        <div class="value" id="totalReceitas">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h4>Despesas (per√≠odo)</h4>
                        <div class="value" id="totalDespesas">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h4>Resultado (per√≠odo)</h4>
                        <div class="value" id="resultado">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h4>Cirurgias (per√≠odo)</h4>
                        <div class="value" id="totalCirurgias">0</div>
                    </div>
                </div>
                
<div class="summary-cards" id="extraSummaryCards">
                    <div class="summary-card">
                        <h4>Insumos (compras no per√≠odo)</h4>
                        <div class="value" id="gastoInsumosMes">R$ 0,00</div>
                    </div>
                <div class="summary-cards" id="gastosResumoCards">
                    <div class="summary-card">
                        <h4>Total de Gastos com Insumos (geral)</h4>
                        <div class="value" id="totalGastosInsumos">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h4>Total de Gastos com Despesas (geral)</h4>
                        <div class="value" id="totalGastosDespesas">R$ 0,00</div>
                    </div>
                </div>

                    <div class="summary-card">
                        <h4>Custo de Cirurgias (per√≠odo)</h4>
                        <div class="value" id="custoCirurgiasMes">R$ 0,00</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Ultimas Transacoes</h3>
                    <div class="transactions-list" id="ultimasTransacoes">
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div>Sistema iniciado com sucesso!</div>
                                <div class="transaction-date">Adicione receitas e despesas para comecar</div>
                            </div>
                <div class="grid" id="miniRelatorios">
                    <div class="card">
                        <h3>Resumo por Categoria (M√™s)</h3>
                        <table class="table" id="tabelaCategoriasMes">
                            <thead>
                                <tr><th>Categoria</th><th>Total do M√™s</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>‚Äî</td><td>R$ 0,00</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="card">
                        <h3>Evolu√ß√£o Mensal (6 meses)</h3>
                        <div id="graficoEvolucao" style="width: 100%; height: 260px;"></div>
                        <div style="font-size: 12px; color: #666; margin-top: 6px;">Receitas vs. Despesas (√∫ltimos 6 meses)</div>
                    </div>
                </div>

                        </div>
                    </div>
                </div>
            </div>


                <div class="card">
                    <h3>Produ√ß√£o por M√©dico (per√≠odo)</h3>
                    <table class="table" id="tabelaMedicosMes">
                        <thead>
                            <tr><th>M√©dico</th><th>Cirurgias</th><th>Gasto de Insumos</th><th>Comiss√£o do M√©dico</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>‚Äî</td><td>0</td><td>R$ 0,00</td></tr>
                        </tbody>
                    </table>
                    <div style="font-size: 12px; color: #666; margin-top: 6px;">Respeita o per√≠odo selecionado no filtro do Dashboard.</div>
                </div>


            <div id="receitas" class="tab-content">
                <div class="card">
                    <h3>Registrar Receita</h3>
                    <form id="formReceita">
                        <div class="form-group">
                            <label>Fonte da Receita</label>
                            <select name="fonte" required>
                                <option value="">Selecione...</option>
                                <option value="consultorio-particular">Consultorio Particular</option>
                                <option value="mutiroes">Mutiroes</option>
                                <option value="sus">Servico SUS</option>
                                <option value="cirurgias">Cirurgias</option>
                                <option value="consultas">Consultas</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descricao</label>
                            <input type="text" name="descricao" placeholder="Ex: Consultas dia 15/05" required>
                        </div>
                        <div class="form-group">
                            <label>Valor (R$)</label>
                            <input type="number" step="0.01" name="valor" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label>Data</label>
                            <input type="date" name="data" required>
                        </div>
                        <button type="submit" class="btn">Adicionar Receita</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Receitas Registradas</h3>
                    <div class="transactions-list" id="listaReceitas">
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div>Nenhuma receita registrada ainda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="despesas" class="tab-content">
                <div class="card">
                    <h3>Registrar Despesa</h3>
                    <form id="formDespesa">
                        <div class="form-group">
                            <label>Categoria</label>
                            <select name="categoria" required>
                                <option value="">Selecione...</option>
                                <option value="insumos">Insumos M√©dicos</option>
                                <option value="gasolina">Gasolina</option>
                                <option value="alimentacao">Alimenta√ß√£o</option>
                                <option value="manutencao">Manuten√ß√£o</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <input type="text" name="descricao" placeholder="Ex: Combust√≠vel para viagem" required>
                        </div>
                        <div class="form-group">
                            <label>Valor (R$)</label>
                            <input type="number" step="0.01" name="valor" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label>Data</label>
                            <input type="date" name="data" required>
                        </div>
                        <button type="submit" class="btn">Adicionar Despesa</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Despesas Registradas</h3>
                    <div class="transactions-list" id="listaDespesas">
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div>Nenhuma despesa registrada ainda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="financeiro" class="tab-content">
                <div class="card">
                    <h3>Controle de Saldo</h3>
                    <div class="form-group">
                        <label>Saldo Atual da Conta (R$) - Calculado Automaticamente</label>
                        <input type="number" step="0.01" id="inputSaldo" placeholder="0,00">
                    </div>
                    <button type="button" class="btn" onclick="atualizarSaldo()">Atualizar Saldo</button>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <h4>Situacao Financeira:</h4>
                        <div class="valor-detalhado">
                            <span>Saldo Atual:</span>
                            <span id="displaySaldo">R$ 0,00</span>
                        </div>
                        <div class="valor-detalhado">
                            <span>Gastos Fixos Mensais:</span>
                            <span>R$ 43.183,01</span>
                        </div>
                        <hr>
                        <div class="valor-detalhado">
                            <span><strong>Saldo Projetado:</strong></span>
                            <span id="saldoProjetado"><strong>R$ -43.183,01</strong></span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="cirurgias" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h3>Registrar Cirurgia</h3>
                        <form id="formCirurgia">
                            <div class="form-group">
                                <label>Tipo de Cirurgia</label>
                                <select name="tipo" required>
                                    <option value="">Selecione...</option>
                                    <option value="catarata">Catarata</option>
                                    <option value="retina">Retina</option>
                                    <option value="glaucoma">Glaucoma</option>
                                    <option value="refrativa">Refrativa</option>
                                    <option value="pter√≠gio">Pter√≠gio</option>
                                    <option value="outras">Outras</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Paciente</label>
                                <input type="text" name="paciente" placeholder="Nome do paciente" required>
                            </div>
                            <div class="form-group">
                                <label>M√©dico</label>
                                <select name="medico" required>
                                    <option value="">Selecione...</option>
                                    <option>Dr Leonardo Schiochet</option>
                                    <option>Dr Gustavo Coninck</option>
                                    <option>Dr Gustavo Almeida</option>
                                    <option>Dr Jean</option>
                                    <option>Dra Simone</option>
                                    <option>Outros</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Valor Bruto (R$)</label>
                                <input type="number" step="0.01" name="valorBruto" placeholder="0,00" required id="valorBrutoCirurgia">
                            </div>
                            <div class="form-group">
                                <label>Forma de Pagamento</label>
                                <select name="formaPagamento" required id="formaPagamentoCirurgia">
                                    <option value="">Selecione...</option>
                                    <option value="dinheiro">Dinheiro/PIX</option>
                                    <option value="cartao-debito">Cart√£o D√©bito</option>
                                    <option value="cartao-credito-vista">Cart√£o Cr√©dito √† Vista</option>
                                    <option value="cartao-credito-parcelado">Cart√£o Cr√©dito Parcelado</option>
                                </select>
                            </div>
                            <div class="form-group" id="taxaCartaoGroup" style="display: none;">
                                <label>Taxa da M√°quina (%)</label>
                                <input type="number" step="0.01" name="taxaCartao" placeholder="Ex: 3.5" id="taxaCartaoCirurgia">
                            </div>
                            <div class="form-group">
                                <label>Data da Cirurgia</label>
                                <input type="date" name="data" required>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select name="status" required>
                                    <option value="agendada">Agendada</option>
                                    <option value="realizada">Realizada</option>
                                    <option value="cancelada">Cancelada</option>
                                </select>
                            </div>

                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin: 15px 0;">
                                <h4>Custos Operacionais</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label>Comiss√£o Orientadora (%)</label>
                                        <input type="number" step="0.01" name="comissaoOrientadora" placeholder="3.0" value="3.0" id="comissaoOrientadora">
                                    </div>
                                    <div class="form-group">
                                        <label>Comiss√£o do M√©dico (%)</label>
                                        <div style="display:block;">
                                          <input type="text" inputmode="decimal" name="comissaoMedico" placeholder="Ex: 10.0" value="0.00" id="comissaoMedico" style="flex:1;">
                                          <button type="button" class="btn" id="salvarPadraoComissaoMedicoBtn" style="padding:8px 12px; margin-top:6px;">Salvar padr√£o</button>
                                        </div>
                                        <div style="font-size:12px; color:#666; margin-top:4px;">Dica: selecione o M√©dico acima e clique em "Salvar padr√£o" para guardar o % padr√£o deste m√©dico.</div>
                                    </div>

                                    <div class="form-group">
                                        <label>Instrumentadora (R$)</label>
                                        <input type="number" step="0.01" name="valorInstrumentadora" placeholder="00.00" value="00.00" id="valorInstrumentadora">
                                    </div>
                                    <div class="form-group">
                                        <label>Outros Custos (R$)</label>
                                        <input type="number" step="0.01" name="outrosCustos" placeholder="0.00" id="outrosCustos">
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                    <div class="valor-detalhado">
                                        <span>Comiss√£o Orientadora:</span>
                                        <span id="valorComissaoOrientadora"><strong>R$ 0,00</strong></span>
                                    </div>
                                    <div class="valor-detalhado">
                                        <span>Funcion√°rios por Dia:</span>
                                        <span id="custoFuncionariosDia"><strong>R$ 0,00</strong></span>
                                    </div>
                                    <div class="valor-detalhado">
                                        <span>Total Custos Operacionais:</span>
                                        <span id="totalCustosOperacionais"><strong>R$ 0,00</strong></span>
                                    </div>
                                </div>
                            </div>

                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin: 15px 0;">
                                <h4>Insumos Utilizados</h4>
                                <div id="insumosUtilizados">
                                    <div class="insumo-item" style="display: flex; gap: 10px; margin: 10px 0; align-items: center;">
    <input type="text" class="codigo-barras-insumo" placeholder="Escaneie o c√≥digo" style="flex: 2;">
    <select class="insumo-select" style="flex: 2;">
        <option value="">Selecione um insumo...</option>
    </select>
    <input type="number" class="quantidade-insumo" placeholder="Qtd" style="width: 80px;" min="1">
    <span class="preco-insumo" style="width: 100px; font-weight: bold;"></span>
    <button type="button" class="btn-remover-insumo" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; flex-shrink: 0; margin-left: 5px;">Remover</button>
</div>
                                </div>
                                <button type="button" id="adicionarInsumo" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px;">+ Adicionar Insumo</button>
                                
                                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                    <div class="valor-detalhado">
                                        <span>Total Insumos:</span>
                                        <span id="totalInsumos"><strong>R$ 0,00</strong></span>
                                    </div>
                                </div>
                            </div>

                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin: 15px 0; background: #f8f9fa;">
                                <h4>Resumo Financeiro Completo</h4>
                                <div class="valor-detalhado">
                                    <span>Valor Bruto:</span>
                                    <span id="resumoValorBruto">R$ 0,00</span>
                                </div>
                                <div class="valor-detalhado">
                                    <span>(-) Taxa Cart√£o:</span>
                                    <span id="resumoTaxaCartao">R$ 0,00</span>
                                </div>
                                <div class="valor-detalhado">
                                    <span>(-) Impostos (18%):</span>
                                    <span id="resumoImpostos">R$ 0,00</span>
                                </div>
                                <div class="valor-detalhado">
                                    <span>(-) Comiss√£o Orientadora:</span>
                                    <span id="resumoComissaoOrientadora">R$ 0,00</span>
                                </div>
                                <div class="valor-detalhado">
                                    <span>(-) Comiss√£o do M√©dico:</span>
                                    <span id="resumoComissaoMedico">R$ 0,00</span>
                                </div>

                                <div class="valor-detalhado">
                                    <span>(-) Instrumentadora:</span>
                                    <span id="resumoInstrumentadora">R$ 0,00</span>
                                </div>
                                <div class="valor-detalhado">
                                    <span>(-) Funcion√°rios/Dia:</span>
                                    <span id="resumoFuncionarios">R$ 0,00</span>
                                </div>
                                <div class="valor-detalhado">
                                    <span>(-) Custo Insumos:</span>
                                    <span id="resumoCustoInsumos">R$ 0,00</span>
                                </div>
                                <div class="valor-detalhado">
                                    <span>(-) Outros Custos:</span>
                                    <span id="resumoOutrosCustos">R$ 0,00</span>
                                </div>
                                <hr>
                                <div class="valor-detalhado">
                                    <span><strong>Valor L√≠quido Final:</strong></span>
                                    <span id="resumoValorLiquido" style="color: #28a745;"><strong>R$ 0,00</strong></span>
                                </div>
                                <div class="valor-detalhado">
                                    <span><strong>Margem (%):</strong></span>
                                    <span id="resumoMargem" style="color: #28a745;"><strong>0%</strong></span>
                                </div>
                                <div class="valor-detalhado">
                                    <span><strong>Total de Custos:</strong></span>
                                    <span id="resumoTotalCustos" style="color: #dc3545;"><strong>R$ 0,00</strong></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Observa√ß√µes</label>
                                <textarea name="observacoes" placeholder="Observa√ß√µes adicionais" rows="3"></textarea>
                            </div>
                            <button type="submit" class="btn">Registrar Cirurgia</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Resumo de Cirurgias</h3>
                        <div class="summary-cards">
                            <div class="summary-card">
                                <h4>Total Realizadas</h4>
                                <div class="value" id="cirurgiasRealizadas">0</div>
                            </div>
                            <div class="summary-card">
                                <h4>Agendadas</h4>
                                <div class="value" id="cirurgiasAgendadas">0</div>
                            </div>
                            <div class="summary-card">
                                <h4>Faturamento Bruto</h4>
                                <div class="value" id="faturamentoBruto">R$ 0,00</div>
                            </div>
                            <div class="summary-card">
                                <h4>Faturamento L√≠quido</h4>
                                <div class="value" id="faturamentoLiquido">R$ 0,00</div>
                            </div>
                            <div class="summary-card">
                                <h4>Margem M√©dia</h4>
                                <div class="value" id="margemMedia">0%</div>
                                <style>
                                    /* === AJUSTE PARA MOVER LISTA DE CIRURGIAS PARA ESQUERDA === */
                                    #cirurgias .card:last-child {
                                   grid-column: 1 / -1; /* Ocupa toda a largura */
                                   margin-left: 0; /* Remove margem √† esquerda */
                                 margin-right: 0; /* Remove margem √† direita */
                                max-width: none; /* Remove limite m√°ximo de largura */
                                                                                       }

                                 /* Ajuste espec√≠fico para o grid de cirurgias */
                                        #cirurgias .grid {
    margin-bottom: 0; /* Remove margem inferior do grid */
                                                                 }

                                /* Garantir que a lista ocupe toda a largura dispon√≠vel */
                                            #listaCirurgias {
                            width: 100%;
                          max-width: none;
                                        }
                              </style>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Lista de Cirurgias</h3>
                    <div class="transactions-list" id="listaCirurgias">
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div>Nenhuma cirurgia registrada ainda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="funcionarios" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h3>Registrar Funcion√°rio</h3>
                        <form id="formFuncionario">
                            <div class="form-group">
                                <label>Nome</label>
                                <input type="text" name="nome" placeholder="Nome completo" required>
                            </div>
                            <div class="form-group">
                                <label>Cargo</label>
                                <select name="cargo" required>
                                    <option value="">Selecione...</option>
                                    <option value="enfermeiro">Enfermeiro(a)</option>
                                    <option value="tecnico">T√©cnico(a)</option>
                                    <option value="recepcionista">Recepcionista</option>
                                    <option value="auxiliar">Auxiliar</option>
                                    <option value="limpeza">Limpeza</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Pagamento</label>
                                <select name="tipoPagamento" required id="tipoPagamentoFuncionario">
                                    <option value="">Selecione...</option>
                                    <option value="mensal">Sal√°rio Mensal</option>
                                    <option value="diario">Por Dia de Cirurgia</option>
                                    <option value="por-dia">Por Dia</option>
                                </select>
                            </div>
                            <div class="form-group" id="salarioMensalGroup">
                                <label>Sal√°rio Mensal (R$)</label>
                                <input type="number" step="0.01" name="salario" placeholder="0,00" id="salarioMensal">
                            </div>
                            <div class="form-group" id="valorDiarioGroup" style="display: none;">
                                <label>Valor por Dia de Cirurgia (R$)</label>
                                <input type="number" step="0.01" name="valorDiario" placeholder="0,00" id="valorDiario">
                            </div>
                            <div class="form-group">
                                <label>Data de Admiss√£o</label>
                                <input type="date" name="dataAdmissao" required>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select name="status" required>
                                    <option value="ativo">Ativo</option>
                                    <option value="inativo">Inativo</option>
                                    <option value="ferias">F√©rias</option>
                                </select>
                            </div>
                            <button type="submit" class="btn">Registrar Funcion√°rio</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Resumo da Folha</h3>
                        <div class="summary-cards">
                            <div class="summary-card">
                                <h4>Funcion√°rios Ativos</h4>
                                <div class="value" id="funcionariosAtivos">0</div>
                            </div>
                            <div class="summary-card">
                                <h4>Folha Mensal</h4>
                                <div class="value" id="totalFolha">R$ 0,00</div>
                            </div>
                            <div class="summary-card">
                                <h4>Custo por Cirurgia</h4>
                                <div class="value" id="custoPorCirurgia">R$ 0,00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Lista de Funcion√°rios</h3>
                    <div class="transactions-list" id="listaFuncionarios">
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div>Nenhum funcion√°rio registrado ainda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="gastosFixos" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h3>Registrar Gasto Fixo</h3>
                        <form id="formGastoFixo">
                            <div class="form-group">
                                <label>Descri√ß√£o</label>
                                <input type="text" name="descricao" placeholder="Ex: Aluguel consult√≥rio" required>
                            </div>
                            <div class="form-group">
                                <label>Categoria</label>
                                <select name="categoria" required>
                                    <option value="">Selecione...</option>
                                    <option value="aluguel">Aluguel</option>
                                    <option value="salarios">Sal√°rios</option>
                                    <option value="encargos">Encargos</option>
                                    <option value="energia">Energia El√©trica</option>
                                    <option value="agua">√Ågua</option>
                                    <option value="telefone">Telefone/Internet</option>
                                    <option value="seguros">Seguros</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Valor Mensal (R$)</label>
                                <input type="number" step="0.01" name="valor" placeholder="0,00" required>
                            </div>
                            <div class="form-group">
                                <label>Dia do Vencimento</label>
                                <input type="number" min="1" max="31" name="diaVencimento" placeholder="Ex: 5" required>
                            </div>
                            <button type="submit" class="btn">Adicionar Gasto Fixo</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Resumo dos Gastos</h3>
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 5px;">
                            <div class="valor-detalhado">
                                <span><strong>Total de Gastos Fixos:</strong></span>
                                <span id="totalGastosFixosDetalhado"><strong>R$ 0,00</strong></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Lista de Gastos Fixos</h3>
                    <div class="transactions-list" id="listaGastosFixos">
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div>Nenhum gasto fixo registrado ainda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="parcelas" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h3>Registrar Parcela</h3>
                        <form id="formParcela">
                            <div class="form-group">
                                <label>Tipo</label>
                                <select name="tipo" required>
                                    <option value="">Selecione...</option>
                                    <option value="pagar">A Pagar</option>
                                    <option value="receber">A Receber</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Descri√ß√£o</label>
                                <input type="text" name="descricao" placeholder="Ex: Financiamento equipamento" required>
                            </div>
                            <div class="form-group">
                                <label>Valor da Parcela (R$)</label>
                                <input type="number" step="0.01" name="valor" placeholder="0,00" required>
                            </div>
                            <div class="form-group">
                                <label>N√∫mero de Parcelas</label>
                                <input type="number" name="numeroParcelas" placeholder="Ex: 12" min="1" required>
                            </div>
                            <div class="form-group">
                                <label>Data de Vencimento</label>
                                <input type="date" name="dataVencimento" required>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select name="status" required>
                                    <option value="pendente">Pendente</option>
                                    <option value="pago">Pago</option>
                                    <option value="vencido">Vencido</option>
                                </select>
                            </div>
                            <button type="submit" class="btn">Registrar Parcela</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Resumo de Parcelas</h3>
                        <div class="summary-cards">
                            <div class="summary-card">
                                <h4>A Pagar</h4>
                                <div class="value" id="totalAPagar">R$ 0,00</div>
                            </div>
                            <div class="summary-card">
                                <h4>A Receber</h4>
                                <div class="value" id="totalAReceber">R$ 0,00</div>
                            </div>
                            <div class="summary-card">
                                <h4>Total de Parcelas</h4>
                                <div class="value" id="totalParcelasRegistradas">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Lista de Parcelas</h3>
                    <div class="transactions-list" id="listaParcelas">
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div>Nenhuma parcela registrada ainda</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
<div id="insumos" class="tab-content">
  <div class="grid" style="grid-template-columns: 1.2fr 2fr;">
    <div class="card">
      <h3>Cadastrar / Editar Insumo</h3>
      <form id="formInsumo">
        <input type="hidden" name="id" id="insumoId">
        <div class="form-group">
          <label>Nome do Insumo</label>
          <input type="text" name="nome" id="insumoNome" placeholder="Ex: Seringa 5ml" required>
        </div>
        <div class="form-group">
          <label>Categoria</label>
          <select name="categoria" id="insumoCategoria" required>
            <option value="">Selecione...</option>
            <option value="descartaveis">Descart√°veis</option>
            <option value="medicamentos">Medicamentos</option>
            <option value="equipamentos">Equipamentos</option>
            <option value="limpeza">Limpeza</option>
            <option value="outros">Outros</option>
          </select>
        </div>
        <div class="form-group">
          <label>Unidade</label>
          <select name="unidade" id="insumoUnidade" required>
            <option value="unidade">Unidade</option>
            <option value="caixa">Caixa</option>
            <option value="frasco">Frasco</option>
            <option value="pacote">Pacote</option>
            <option value="litro">Litro</option>
          </select>
        </div>
        <div class="form-group">
          <label>Pre√ßo Unit√°rio (R$)</label>
          <input type="number" step="0.01" name="preco" id="insumoPreco" placeholder="0,00" required>
        </div>
        <div class="form-group">
          <label>Quantidade em Estoque</label>
          <input type="number" name="quantidade" id="insumoQuantidade" placeholder="Ex: 100" min="0" required>
        </div>
        <div class="form-group">
          <label>Estoque M√≠nimo</label>
          <input type="number" name="estoqueMinimo" id="insumoMinimo" placeholder="Ex: 10" min="0" required>
        </div>
        <div class="form-group">
          <label>C√≥digo de Barras</label>
          <input type="text" name="codigoBarras" id="insumoCodigoBarras" placeholder="Escaneie o c√≥digo" required>
        </div>
        <div class="form-group">
          <button type="submit" class="btn" id="btnSalvarInsumo">Salvar Insumo</button>
          <button type="button" class="btn" id="btnLimparInsumo" style="background:#6c757d;">Limpar</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h3>Estoque & Filtros</h3>
      <div class="grid" style="grid-template-columns: 2fr 1fr 1fr 1fr;">
        <div class="form-group">
          <label>Buscar</label>
          <input type="text" id="filtroBuscaInsumo" placeholder="Nome ou c√≥digo de barras">
        </div>
        <div class="form-group">
          <label>Categoria</label>
          <select id="filtroCategoriaInsumo">
            <option value="">Todas</option>
            <option value="descartaveis">Descart√°veis</option>
            <option value="medicamentos">Medicamentos</option>
            <option value="equipamentos">Equipamentos</option>
            <option value="limpeza">Limpeza</option>
            <option value="outros">Outros</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="filtroStatusInsumo">
            <option value="">Todos</option>
            <option value="baixo-estoque">Apenas baixo estoque</option>
          </select>
        </div>
        <div class="form-group">
          <label>&nbsp;</label>
          <div>
            <button class="btn" type="button" id="btnExportarInsumos">Exportar CSV</button>
            <button class="btn" type="button" id="btnImportarInsumos" style="background:#17a2b8;">Importar JSON</button>
            <input type="file" id="inputImportarInsumos" accept=".json" style="display:none;">
          </div>
        </div>
      </div>

      <div style="margin-top:10px;">
        <table class="table" id="tabelaInsumosOrganizada">
          <thead>
            <tr>
              <th data-sort="codigoBarras">C√≥digo</th>
              <th data-sort="nome">Nome</th>
              <th data-sort="categoria">Categoria</th>
              <th data-sort="unidade">Unid.</th>
              <th data-sort="preco">Pre√ßo</th>
              <th data-sort="quantidade">Qtd</th>
              <th data-sort="estoqueMinimo">M√≠n.</th>
              <th>Estoque</th>
              <th style="width:220px;">A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="9">Nenhum insumo cadastrado</td></tr>
          </tbody>
        </table>
        <div style="font-size:12px; color:#666; margin-top:6px;">Clique nos t√≠tulos para ordenar. Itens com baixo estoque ficam destacados.</div>
      </div>
    </div>
  </div>
</div>
<!-- end insumos -->
</div>

            <div id="relatorios" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h3>Filtros de Relat√≥rio</h3>
                        <div class="form-group">
                            <label>Per√≠odo</label>
                            <select id="periodoRelatorio">
                                <option value="mes-atual">M√™s Atual</option>
                                <option value="mes-anterior">M√™s Anterior</option>
                                <option value="trimestre">√öltimos 3 Meses</option>
                                <option value="semestre">√öltimos 6 Meses</option>
                                <option value="ano">√öltimo Ano</option>
                                <option value="personalizado">Per√≠odo Personalizado</option>
                            </select>
                        </div>
                        <div class="form-group" id="periodoPersonalizado" style="display: none;">
                            <label>Data Inicial</label>
                            <input type="date" id="dataInicial">
                            <label>Data Final</label>
                            <input type="date" id="dataFinal">
                        </div>
                        <button type="button" class="btn" onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
                    </div>

                    <div class="card">
                        <h3>A√ß√µes R√°pidas</h3>
                        <button type="button" class="btn" onclick="exportarDados('receitas')">Exportar Receitas</button>
                        <button type="button" class="btn" onclick="exportarDados('despesas')">Exportar Despesas</button>
                        <button type="button" class="btn" onclick="exportarDados('cirurgias')">Exportar Cirurgias</button>
                        <button type="button" class="btn" onclick="exportarDados('completo')">Relat√≥rio Completo</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Relat√≥rio Financeiro</h3>
                    <div id="relatorioConteudo">
                        <p>Selecione um per√≠odo e clique em "Gerar Relat√≥rio" para visualizar os dados.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURA√á√ïES DE LOGIN ===
        const USUARIO_VALIDO = 'leosht';
        const SENHA_VALIDA = 'mda12345';

        // === DADOS DO SISTEMA ===
        let dados = {
            receitas: [],
            despesas: [],
            cirurgias: [],
            parcelas: [],
            insumos: [],
            saldoAtual: 0 // Este valor n√£o √© mais a fonte da verdade, mas √© mantido por compatibilidade.
        };

        let usuarioLogado = false;

        // === FUN√á√ïES DE SALVAMENTO ===
        function salvarDados() {
            try {
                const dadosParaSalvar = {
                    ...dados,
                    dataUltimaSalvamento: new Date().toISOString(),
                    versaoSistema: '1.0'
                };
                
                localStorage.setItem('sistemaFinanceiro_dados', JSON.stringify(dadosParaSalvar));
                localStorage.setItem('sistemaFinanceiro_ultimoSalvamento', new Date().toLocaleString('pt-BR'));
                
                mostrarNotificacao('üíæ Dados salvos com sucesso!', 'success');
                atualizarStatusSalvamento();
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                mostrarNotificacao('‚ùå Erro ao salvar dados!', 'error');
            }
        }

        function carregarDados() {
            try {
                const dadosSalvos = localStorage.getItem('sistemaFinanceiro_dados');
                if (dadosSalvos) {
                    const dadosCarregados = JSON.parse(dadosSalvos);
                    
                    // Manter compatibilidade com vers√µes antigas
                    dados = {
                        receitas: dadosCarregados.receitas || [],
                        despesas: dadosCarregados.despesas || [],
                        cirurgias: dadosCarregados.cirurgias || [],
                        parcelas: dadosCarregados.parcelas || [],
                        insumos: dadosCarregados.insumos || [],
                        saldoAtual: dadosCarregados.saldoAtual || 0 // Carrega o saldo antigo, mas ser√° recalculado
                    };
                    
                    mostrarNotificacao('üìÇ Dados carregados com sucesso!', 'success');
                    atualizarStatusSalvamento();
                    return true;
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                mostrarNotificacao('‚ùå Erro ao carregar dados salvos!', 'error');
            }
            return false;
        }

        function salvarAutomatico() {
            if (usuarioLogado) {
                salvarDados();
            }
        }

        function exportarBackup() {
            try {
                const backup = {
                    ...dados,
                    metadados: {
                        dataExportacao: new Date().toISOString(),
                        dataUltimaSalvamento: localStorage.getItem('sistemaFinanceiro_ultimoSalvamento'),
                        versaoSistema: '1.0',
                        nomeClinica: 'Cl√≠nica Oftalmol√≥gica Dr. Leonardo'
                    }
                };
                
                const dataStr = JSON.stringify(backup, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `backup_clinica_${new Date().toISOString().slice(0, 10)}.json`;
                link.click();
                
                mostrarNotificacao('üì• Backup baixado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao exportar backup:', error);
                mostrarNotificacao('‚ùå Erro ao gerar backup!', 'error');
            }
        }

        function importarBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.json')) {
                mostrarNotificacao('‚ùå Arquivo deve ser .json!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    // Validar estrutura do backup
                    if (!backup.receitas && !backup.despesas && !backup.metadados) {
                        throw new Error('Arquivo de backup inv√°lido');
                    }
                    
                    // Confirmar importa√ß√£o
                    if (confirm('‚ö†Ô∏è Importar backup substituir√° todos os dados atuais. Deseja continuar?')) {
                        dados = {
                            receitas: backup.receitas || [],
                            despesas: backup.despesas || [],
                            cirurgias: backup.cirurgias || [],
                            parcelas: backup.parcelas || [],
                            insumos: backup.insumos || [],
                            saldoAtual: backup.saldoAtual || 0
                        };
                        
                        salvarDados();
                        atualizarTodasAsVisualizacoes();
                        mostrarNotificacao('üì§ Backup importado com sucesso!', 'success');
                    }
                } catch (error) {
                    console.error('Erro ao importar backup:', error);
                    mostrarNotificacao('‚ùå Erro ao importar backup! Arquivo pode estar corrompido.', 'error');
                }
                
                // Limpar input
                event.target.value = '';
            };
            reader.readAsText(file);
        }

        function mostrarNotificacao(mensagem, tipo = 'info') {
            // Remover notifica√ß√£o anterior se existir
            const notificacaoExistente = document.querySelector('.notificacao-sistema');
            if (notificacaoExistente) {
                notificacaoExistente.remove();
            }
            
            const notificacao = document.createElement('div');
            notificacao.className = 'notificacao-sistema';
            notificacao.textContent = mensagem;
            
            // Estilos baseados no tipo
            const cores = {
                success: '#28a745',
                error: '#dc3545',
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            notificacao.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${cores[tipo] || cores.info};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 500;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notificacao);
            
            // Remover ap√≥s 4 segundos
            setTimeout(() => {
                if (notificacao.parentNode) {
                    notificacao.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => notificacao.remove(), 300);
                }
            }, 4000);
        }

        function atualizarStatusSalvamento() {
            const ultimoSalvamento = localStorage.getItem('sistemaFinanceiro_ultimoSalvamento');
            let statusElement = document.getElementById('statusSalvamento');
            
            if (!statusElement) {
                statusElement = document.createElement('div');
                statusElement.id = 'statusSalvamento';
                statusElement.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(0,0,0,0.7);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 5px;
                    font-size: 12px;
                    z-index: 1000;
                `;
                document.body.appendChild(statusElement);
            }
            
            if (ultimoSalvamento) {
                statusElement.textContent = `üíæ √öltimo salvamento: ${ultimoSalvamento}`;
                statusElement.style.display = 'block';
            } else {
                statusElement.style.display = 'none';
            }
        }

        function atualizarTodasAsVisualizacoes() {
            if (!usuarioLogado) return;
            
            atualizarDashboard();
            atualizarListaReceitas();
            atualizarListaDespesas();
            atualizarListaCirurgias();
            atualizarResumoCirurgias();
            atualizarListaParcelas();
            atualizarResumoParcelas();
            atualizarListaInsumos();
            atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
            atualizarFinanceiro();
        }

        // === FUN√á√ïES DE LOGIN ===
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const passwordToggle = document.querySelector('.password-toggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordToggle.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                passwordToggle.textContent = 'üëÅÔ∏è';
            }
        }

        function mostrarRecuperacao() {
            alert('Para recuperar sua senha, entre em contato com o Dr. Leonardo.\n\nTelefone: (42) 99999-9999\nEmail: contato@drleonardo.com.br');
        }

        function realizarLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!username || !password) {
                mostrarErro('Por favor, preencha todos os campos!');
                return;
            }

            mostrarLoading(true);

            setTimeout(() => {
                if (username === USUARIO_VALIDO && password === SENHA_VALIDA) {
                    mostrarSucesso('Login realizado com sucesso! Carregando sistema...');
                    
                    if (document.getElementById('rememberMe').checked) {
                        // Removido localStorage para funcionar nos artifacts
                    }

                    usuarioLogado = true;
                    
                    setTimeout(() => {
                        mostrarSistema();
                    }, 1500);

                } else {
                    mostrarErro('Usu√°rio ou senha incorretos! Verifique suas credenciais.');
                    mostrarLoading(false);
                    document.getElementById('password').value = '';
                }
            }, 1000);
        }

        function fazerLogout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                usuarioLogado = false;
                mostrarLogin();
            }
        }

        function mostrarLogin() {
            // CORRIGIDO: Usar classes em vez de style.display
            document.getElementById('telaLogin').className = 'visible';
            document.getElementById('telaSistema').className = 'hidden';
            document.getElementById('loginForm').reset();
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        function mostrarSistema() {
            // CORRIGIDO: Usar classes em vez de style.display
            document.getElementById('telaLogin').className = 'hidden';
            document.getElementById('telaSistema').className = 'visible';
            
            // Carregar dados salvos
            carregarDados();
            
            atualizarTodasAsVisualizacoes();
            atualizarStatusSalvamento();
        }

        function mostrarErro(mensagem) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = mensagem;
            errorMessage.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function mostrarSucesso(mensagem) {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = mensagem;
            successMessage.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function mostrarLoading(mostrar) {
            const loading = document.getElementById('loading');
            const loginBtn = document.getElementById('loginBtn');
            
            if (mostrar) {
                loading.style.display = 'block';
                loginBtn.disabled = true;
                loginBtn.textContent = 'Verificando...';
            } else {
                loading.style.display = 'none';
                loginBtn.disabled = false;
                loginBtn.textContent = 'Entrar no Sistema';
            }
        }

        
        // === FUN√á√ïES AUXILIARES PARA ESTAT√çSTICAS ===
        function num(n){ const x = parseFloat(n); return isNaN(x) ? 0 : x; }

        // C√°lculo abrangente de custos de uma cirurgia (defensivo para campos ausentes)
        function custoTotalCirurgia(c){
            const valorBruto = num(c.valorBruto);
            const taxaCartao = c.taxaCartao ? valorBruto * num(c.taxaCartao)/100 : 0;
            const impostos = valorBruto * 0.18; // padr√£o do formul√°rio
            const comissao = valorBruto * num(c.comissaoOrientadora)/100;
            const instrumentadora = num(c.valorInstrumentadora);
            const funcionariosDia = num(c.custoFuncionariosDia); // se n√£o existir, vira 0
            const custoInsumos = num(c.totalInsumos || c.custoInsumos); // tenta ambos
            const outros = num(c.outrosCustos);
            return taxaCartao + impostos + comissao + instrumentadora + funcionariosDia + custoInsumos + outros;
        }
        
        // Soma despesas (por categoria, opcional) do m√™s atual
        function somaDespesasMes(categoria) {
            const mesAtual = new Date().toISOString().slice(0,7);
            return dados.despesas.reduce((acc, d) => {
                if (!d.data || typeof d.data !== 'string') return acc;
                if (d.data.startsWith(mesAtual) && (!categoria || d.categoria === categoria)) {
                    return acc + num(d.valor);
                }
                return acc;
            }, 0);
        }

        
        // === MINI RELAT√ìRIO POR CATEGORIA E GR√ÅFICO ===
        function categoriasDespesasMesAtual() {
            const mesAtual = new Date().toISOString().slice(0,7);
            const mapa = {};
            (dados.despesas || []).forEach(d => {
                if (!d || !d.data || typeof d.data !== 'string') return;
                if (!d.categoria) return;
                if (d.data.startsWith(mesAtual)) {
                    mapa[d.categoria] = (mapa[d.categoria] || 0) + (parseFloat(d.valor) || 0);
                }
            });
            // Ordena por total desc e pega top 5
            const arr = Object.entries(mapa).map(([categoria, total]) => ({categoria, total}));
            arr.sort((a,b) => b.total - a.total);
            return arr.slice(0,5);
        }

        function atualizarTabelaCategoriasMes() {
            const corpo = document.querySelector('#tabelaCategoriasMes tbody');
            if (!corpo) return;
            const top = categoriasDespesasMesAtual();
            corpo.innerHTML = '';
            if (!top.length) {
                corpo.innerHTML = '<tr><td>Sem despesas neste m√™s</td><td>R$ 0,00</td></tr>';
                return;
            }
            top.forEach(linha => {
                const tr = document.createElement('tr');
                const tdCat = document.createElement('td');
                const tdTot = document.createElement('td');
                tdCat.textContent = linha.categoria;
                tdTot.textContent = formatarMoeda(linha.total);
                tr.appendChild(tdCat);
                tr.appendChild(tdTot);
                corpo.appendChild(tr);
            });
        }

        function mesesPassados(n) {
            // retorna array de strings 'YYYY-MM' dos √∫ltimos n meses (inclui m√™s atual)
            const res = [];
            const hoje = new Date();
            const base = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            for (let i = n - 1; i >= 0; i--) {
                const dt = new Date(base.getFullYear(), base.getMonth() - i, 1);
                const y = dt.getFullYear();
                const m = String(dt.getMonth() + 1).padStart(2,'0');
                res.push(`${y}-${m}`);
            }
            return res;
        }

        function agruparPorMes(registros) {
            const map = {};
            (registros || []).forEach(r => {
                if (!r || !r.data || typeof r.data !== 'string') return;
                const ym = r.data.slice(0,7);
                map[ym] = (map[ym] || 0) + (parseFloat(r.valor) || 0);
            });
            return map;
        }

        function dadosEvolucao6m() {
            const meses = mesesPassados(6);
            const recPorMes = agruparPorMes(dados.receitas || []);
            const desPorMes = agruparPorMes(dados.despesas || []);
            return meses.map(ym => ({
                mes: ym,
                receitas: recPorMes[ym] || 0,
                despesas: desPorMes[ym] || 0
            }));
        }

        function renderBarChartSVG(containerId, series) {
            const el = document.getElementById(containerId);
            if (!el) return;
            const width = el.clientWidth || 600;
            const height = el.clientHeight || 260;
            const padding = {top: 20, right: 20, bottom: 30, left: 50};
            const innerW = width - padding.left - padding.right;
            const innerH = height - padding.top - padding.bottom;

            const maxVal = Math.max(1, ...series.flatMap(d => [d.receitas, d.despesas]));
            const meses = series.map(d => d.mes);
            const groupCount = series.length;
            const barGroupWidth = innerW / groupCount;
            const barWidth = Math.max(8, (barGroupWidth - 20) / 2); // duas barras por grupo
            const gap = 6;

            function yScale(v){ return innerH - (v / maxVal) * innerH; }

            // Eixos e grades simples
            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Gr√°fico de barras de receitas e despesas">
                <rect x="0" y="0" width="${width}" height="${height}" fill="white" />
                <g transform="translate(${padding.left},${padding.top})">`;

            // Linhas de grade horizontais (4)
            for (let i = 0; i <= 4; i++) {
                const y = (innerH/4)*i;
                svg += `<line x1="0" y1="${y}" x2="${innerW}" y2="${y}" stroke="#e9ecef" stroke-width="1"/>`;
            }

            // Barras
            series.forEach((d, i) => {
                const x0 = i * barGroupWidth + 10;
                const hRec = innerH - yScale(d.receitas);
                const hDes = innerH - yScale(d.despesas);
                const xRec = x0;
                const xDes = x0 + barWidth + gap;
                const yRec = yScale(d.receitas);
                const yDes = yScale(d.despesas);
                // Receitas (sem cor fixa; usa cor padr√£o do SVG)
                svg += `<rect x="${xRec}" y="${yRec}" width="${barWidth}" height="${hRec}" />`;
                // Despesas
                svg += `<rect x="${xDes}" y="${yDes}" width="${barWidth}" height="${hDes}" opacity="0.7" />`;
                // R√≥tulo do m√™s
                const label = d.mes.slice(5,7) + '/' + d.mes.slice(2,4);
                svg += `<text x="${x0 + barWidth}" y="${innerH + 18}" text-anchor="middle" font-size="11" fill="#333">${label}</text>`;
            });

            // Eixo Y (valores)
            const ticks = 4;
            for (let t = 0; t <= ticks; t++) {
                const val = (maxVal / ticks) * t;
                const y = yScale(val);
                svg += `<text x="-8" y="${y+4}" text-anchor="end" font-size="11" fill="#666">${formatarMoeda(val)}</text>`;
            }

            // Legenda simples
            svg += `<g transform="translate(${innerW - 140}, -8)">
                        <rect x="0" y="0" width="10" height="10"></rect>
                        <text x="16" y="9" font-size="11">Receitas</text>
                        <rect x="90" y="0" width="10" height="10" opacity="0.7"></rect>
                        <text x="106" y="9" font-size="11">Despesas</text>
                    </g>`;

            svg += `</g></svg>`;
            el.innerHTML = svg;
        }

        
        // === GASTOS TOTAIS INSUMOS E DESPESAS ===
        function calcularGastosTotais() {
            let totalInsumos = 0;
            let totalDespesas = 0;

            (dados.despesas || []).forEach(d => {
                if (!d || !d.valor) return;
                const val = parseFloat(d.valor) || 0;
                if (d.categoria && d.categoria.toLowerCase().includes("insumo")) {
                    totalInsumos += val;
                } else {
                    totalDespesas += val;
                }
            });

            return { totalInsumos, totalDespesas };
        }

        
        // === REFRESH AUTOM√ÅTICO DO DASHBOARD AP√ìS SUBMISS√ïES ===
        document.addEventListener('DOMContentLoaded', function(){
            const forms = ['formDespesa','formReceita','formCirurgia','formParcela','formInsumo'];
            forms.forEach(id => {
                const f = document.getElementById(id);
                if (f) {
                    f.addEventListener('submit', function(){
                        // Aguarda o handler original inserir os dados em "dados.*"
                        setTimeout(function(){
                            try {
                                if (typeof atualizarTodasAsVisualizacoes === 'function') {
                                    atualizarTodasAsVisualizacoes();
                                } else if (typeof atualizarDashboard === 'function') {
                                    atualizarDashboard();
                                }
                                if (typeof salvarDados === 'function') salvarDados();
                            } catch(e){ console.warn('Auto-refresh dashboard falhou:', e); }
                        }, 300);
                    });
                }
            });
        });

        
        // === FILTRO DE PER√çODO DO DASHBOARD ===
        let filtroPeriodoSelecionado = '6m';
        let periodoPersonalizado = {inicio: null, fim: null};

        document.addEventListener('DOMContentLoaded', function(){
            const sel = document.getElementById('filtroPeriodo');
            const btn = document.getElementById('aplicarPeriodoBtn');
            const divIni = document.getElementById('rangePersonalizado');
            const divFim = document.getElementById('rangePersonalizado2');
            const di = document.getElementById('periodoDataInicial');
            const df = document.getElementById('periodoDataFinal');

            function togglePersonalizado(){
                const v = sel.value;
                const show = v === 'personalizado';
                divIni.style.display = show ? 'block' : 'none';
                divFim.style.display = show ? 'block' : 'none';
            }
            sel.addEventListener('change', togglePersonalizado);
            togglePersonalizado();

            btn.addEventListener('click', function(){
                filtroPeriodoSelecionado = sel.value;
                periodoPersonalizado.inicio = di.value || null;
                periodoPersonalizado.fim = df.value || null;
                try {
                    if (typeof atualizarTodasAsVisualizacoes === 'function') {
                        atualizarTodasAsVisualizacoes();
                    } else if (typeof atualizarDashboard === 'function') {
                        atualizarDashboard();
                    }
                } catch(e){ console.warn('Erro ao aplicar per√≠odo:', e); }
            });
        });

        function primeiroDiaMes(dt){ return new Date(dt.getFullYear(), dt.getMonth(), 1); }
        function ultimoDiaMes(dt){ return new Date(dt.getFullYear(), dt.getMonth()+1, 0); }
        function toISODate(d){ return d.toISOString().slice(0,10); }

        function getRangeDoFiltro(){
            const hoje = new Date();
            let inicio, fim;
            switch (filtroPeriodoSelecionado) {
                case 'mes-atual': {
                    inicio = primeiroDiaMes(hoje);
                    fim = ultimoDiaMes(hoje);
                    break;
                }
                case 'mes-anterior': {
                    const ref = new Date(hoje.getFullYear(), hoje.getMonth()-1, 1);
                    inicio = primeiroDiaMes(ref);
                    fim = ultimoDiaMes(ref);
                    break;
                }
                case '3m':
                case '6m':
                case '12m': {
                    const meses = parseInt(filtroPeriodoSelecionado.replace('m',''), 10);
                    const ref = new Date(hoje.getFullYear(), hoje.getMonth() - (meses-1), 1);
                    inicio = primeiroDiaMes(ref);
                    fim = ultimoDiaMes(hoje);
                    break;
                }
                case 'ano-atual': {
                    inicio = new Date(hoje.getFullYear(), 0, 1);
                    fim = new Date(hoje.getFullYear(), 11, 31);
                    break;
                }
                case 'personalizado': {
                    if (periodoPersonalizado.inicio && periodoPersonalizado.fim) {
                        inicio = new Date(periodoPersonalizado.inicio + 'T00:00:00');
                        fim = new Date(periodoPersonalizado.fim + 'T23:59:59');
                    } else {
                        // fallback: m√™s atual
                        inicio = primeiroDiaMes(hoje);
                        fim = ultimoDiaMes(hoje);
                    }
                    break;
                }
                default: {
                    // fallback: 6 meses
                    const ref = new Date(hoje.getFullYear(), hoje.getMonth() - 5, 1);
                    inicio = primeiroDiaMes(ref);
                    fim = ultimoDiaMes(hoje);
                }
            }
            return { inicio: toISODate(inicio), fim: toISODate(fim) };
        }

        function dataNoIntervalo(iso, inicio, fim){
            if (!iso || typeof iso !== 'string') return false;
            return iso >= inicio && iso <= fim;
        }

        function somaDespesasNoPeriodo(categoria){
            const {inicio, fim} = getRangeDoFiltro();
            return (dados.despesas || []).reduce((acc, d) => {
                if (!d || !d.data) return acc;
                if (dataNoIntervalo(d.data, inicio, fim) && (!categoria || d.categoria === categoria)) {
                    acc += parseFloat(d.valor) || 0;
                }
                return acc;
            }, 0);
        }

        function somaReceitasNoPeriodo(){
            const {inicio, fim} = getRangeDoFiltro();
            return (dados.receitas || []).reduce((acc, r) => {
                if (!r || !r.data) return acc;
                if (dataNoIntervalo(r.data, inicio, fim)) {
                    acc += parseFloat(r.valor) || 0;
                }
                return acc;
            }, 0);
        }

        function contarCirurgiasNoPeriodo(){
            const {inicio, fim} = getRangeDoFiltro();
            let n = 0;
            (dados.cirurgias || []).forEach(c => {
                if (!c || !c.data) return;
                if (dataNoIntervalo(c.data, inicio, fim)) n++;
            });
            return n;
        }

        function custoCirurgiasNoPeriodo(){
            const {inicio, fim} = getRangeDoFiltro();
            let total = 0;
            (dados.cirurgias || []).forEach(c => {
                if (!c || !c.data || c.status === 'cancelada') return;
                if (dataNoIntervalo(c.data, inicio, fim)) {
                    total += custoTotalCirurgia(c);
                }
            });
            return total;
        }

        // Ajustar fun√ß√µes do mini-relat√≥rio para considerar per√≠odo
        function categoriasDespesasPeriodo() {
            const {inicio, fim} = getRangeDoFiltro();
            const mapa = {};
            (dados.despesas || []).forEach(d => {
                if (!d || !d.data || !d.categoria) return;
                if (dataNoIntervalo(d.data, inicio, fim)) {
                    mapa[d.categoria] = (mapa[d.categoria] || 0) + (parseFloat(d.valor) || 0);
                }
            });
            const arr = Object.entries(mapa).map(([categoria, total]) => ({categoria, total}));
            arr.sort((a,b) => b.total - a.total);
            return arr.slice(0,5);
        }

        function atualizarTabelaCategoriasMes() {
            const corpo = document.querySelector('#tabelaCategoriasMes tbody');
            if (!corpo) return;
            const top = categoriasDespesasPeriodo();
            corpo.innerHTML = '';
            if (!top.length) {
                corpo.innerHTML = '<tr><td>Sem despesas no per√≠odo</td><td>R$ 0,00</td></tr>';
                return;
            }
            top.forEach(linha => {
                const tr = document.createElement('tr');
                const tdCat = document.createElement('td');
                const tdTot = document.createElement('td');
                tdCat.textContent = linha.categoria;
                tdTot.textContent = formatarMoeda(linha.total);
                tr.appendChild(tdCat);
                tr.appendChild(tdTot);
                corpo.appendChild(tr);
            });
        }

        // Evolu√ß√£o mensal: usa 3/6/12 meses conforme sele√ß√£o, sen√£o 6 meses por padr√£o
        function mesesPassadosNPorFiltro(){
            let n = 6;
            if (['3m','6m','12m'].includes(filtroPeriodoSelecionado)){
                n = parseInt(filtroPeriodoSelecionado,10);
            }
            return n;
        }
        function mesesPassados(n) {
            const res = [];
            const hoje = new Date();
            const base = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            for (let i = n - 1; i >= 0; i--) {
                const dt = new Date(base.getFullYear(), base.getMonth() - i, 1);
                const y = dt.getFullYear();
                const m = String(dt.getMonth() + 1).padStart(2,'0');
                res.push(`${y}-${m}`);
            }
            return res;
        }
        function agruparPorMes(registros) {
            const map = {};
            (registros || []).forEach(r => {
                if (!r || !r.data || typeof r.data !== 'string') return;
                const ym = r.data.slice(0,7);
                map[ym] = (map[ym] || 0) + (parseFloat(r.valor) || 0);
            });
            return map;
        }
        function dadosEvolucaoPorFiltro() {
            const meses = mesesPassados(mesesPassadosNPorFiltro());
            const recPorMes = agruparPorMes(dados.receitas || []);
            const desPorMes = agruparPorMes(dados.despesas || []);
            return meses.map(ym => ({
                mes: ym,
                receitas: recPorMes[ym] || 0,
                despesas: desPorMes[ym] || 0
            }));
        }

        
        // === HOOK: enriquecer INSUMOS com dataCadastro e custo total no submit ===
        document.addEventListener('DOMContentLoaded', function(){
            const formInsumo = document.getElementById('formInsumo');
            if (formInsumo) {
                formInsumo.addEventListener('submit', function(){
                    setTimeout(function(){
                        try {
                            if (!Array.isArray(dados.insumos) || dados.insumos.length === 0) return;
                            // Pega o √∫ltimo insumo inserido (assumindo que o handler original faz push no final)
                            const item = dados.insumos[dados.insumos.length - 1];
                            if (item && !item.dataCadastro) {
                                item.dataCadastro = new Date().toISOString().slice(0,10); // YYYY-MM-DD
                            }
                            // Custo total de compra (se n√£o existir)
                            const preco = parseFloat(item?.preco) || 0;
                            const qtd = parseFloat(item?.quantidade) || 0;
                            const custo = preco * qtd;
                            if (!isNaN(custo)) item.custoCompraTotal = custo;
                            // Salva e atualiza pain√©is
                            if (typeof salvarDados === 'function') salvarDados();
                            if (typeof atualizarTodasAsVisualizacoes === 'function') atualizarTodasAsVisualizacoes();
                            else if (typeof atualizarDashboard === 'function') atualizarDashboard();
                        } catch(e){ console.warn('Hook formInsumo falhou:', e); }
                    }, 250);
                });
            }
        });

        
        // Soma o valor das COMPRAS de insumos (cadastros de INSUMOS) no per√≠odo selecionado
        function comprasInsumosNoPeriodo(){
            const {inicio, fim} = getRangeDoFiltro();
            let total = 0;
            (dados.insumos || []).forEach(it => {
                if (!it) return;
                // Se n√£o houver dataCadastro, assume dentro do per√≠odo apenas se n√£o for utilizado (fallback conservador: considerar)
                const data = it.dataCadastro || it.data || null;
                const dentro = data ? dataNoIntervalo(data, inicio, fim) : true;
                if (dentro) {
                    const preco = parseFloat(it.preco) || 0;
                    const qtd = parseFloat(it.quantidade) || 0;
                    total += (it.custoCompraTotal != null ? parseFloat(it.custoCompraTotal)||0 : preco*qtd);
                }
            });
            return total;
        }

        // === FUN√á√ïES DO SISTEMA FINANCEIRO ===
        function abrirAba(nomeAba) {
            if (!usuarioLogado) return;
            
            // Esconder todas as abas
            var todasAbas = document.querySelectorAll('.tab-content');
            for (var i = 0; i < todasAbas.length; i++) {
                todasAbas[i].classList.remove('active');
            }
            
            // Remover active de todos os botoes
            var todosBotoes = document.querySelectorAll('.tab');
            for (var i = 0; i < todosBotoes.length; i++) {
                todosBotoes[i].classList.remove('active');
            }
            
            // Mostrar a aba selecionada
            document.getElementById(nomeAba).classList.add('active');
            
            // Ativar o botao clicado
            event.target.classList.add('active');
            
            // Carregar conteudo da aba
            setTimeout(function() {
                if (nomeAba === 'dashboard') {
                    atualizarDashboard();
                } else if (nomeAba === 'receitas') {
                    atualizarListaReceitas();
                } else if (nomeAba === 'despesas') {
                    atualizarListaDespesas();
                } else if (nomeAba === 'cirurgias') {
                    atualizarListaCirurgias();
                    atualizarResumoCirurgias();
                    carregarInsumosNoSelect();
                } else if (nomeAba === 'parcelas') {
                    atualizarListaParcelas();
                    atualizarResumoParcelas();
                } else if (nomeAba === 'insumos') {
                    atualizarListaInsumos();
                    atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
                } else if (nomeAba === 'financeiro') {
                    atualizarFinanceiro();
                }
            }, 100);
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function formatarData(data) {
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        
function atualizarDashboard() {
    if (!usuarioLogado) return;

    // === C√°lculos com base no per√≠odo selecionado ===
    var totalReceitas = (typeof somaReceitasNoPeriodo==='function') ? somaReceitasNoPeriodo() : 0;
    var totalDespesas = (typeof somaDespesasNoPeriodo==='function') ? somaDespesasNoPeriodo() : 0;
    var totalCirurgias = (typeof contarCirurgiasNoPeriodo==='function') ? contarCirurgiasNoPeriodo() : 0;
    var gastoInsumosMes = (typeof somaDespesasNoPeriodo==='function') ? somaDespesasNoPeriodo('insumos') : 0; // via Despesas
    if (typeof comprasInsumosNoPeriodo === 'function') {
        gastoInsumosMes += comprasInsumosNoPeriodo(); // + cadastros em Insumos
    }
    var custoCirurgiasMes = (typeof custoCirurgiasNoPeriodo==='function') ? custoCirurgiasNoPeriodo() : 0;

    var resultado = totalReceitas - totalDespesas;

    // Cards principais (per√≠odo)
    var el;
    el = document.getElementById('saldoAtual'); if (el) el.textContent = formatarMoeda(calcularSaldoAtualGlobal());
    el = document.getElementById('totalReceitas'); if (el) el.textContent = formatarMoeda(totalReceitas);
    el = document.getElementById('totalDespesas'); if (el) el.textContent = formatarMoeda(totalDespesas);
    el = document.getElementById('resultado'); if (el) el.textContent = formatarMoeda(resultado);
    el = document.getElementById('totalCirurgias'); if (el) el.textContent = totalCirurgias;

    el = document.getElementById('gastoInsumosMes'); if (el) el.textContent = formatarMoeda(gastoInsumosMes);
    el = document.getElementById('custoCirurgiasMes'); if (el) el.textContent = formatarMoeda(custoCirurgiasMes);

    // Totais gerais
    try {
        const gastos = (typeof calcularGastosTotais==='function') ? calcularGastosTotais() : {totalInsumos:0,totalDespesas:0};
        var elTotalInsumos = document.getElementById('totalGastosInsumos');
        var elTotalDespesas = document.getElementById('totalGastosDespesas');
        if (elTotalDespesas) elTotalDespesas.textContent = formatarMoeda(gastos.totalDespesas);
        // Somar compras gerais de insumos cadastrados
        let comprasGerais = 0;
        (dados.insumos || []).forEach(it => {
            const preco = parseFloat(it?.preco) || 0;
            const qtd = parseFloat(it?.quantidade) || 0;
            comprasGerais += (it?.custoCompraTotal != null ? parseFloat(it.custoCompraTotal)||0 : preco*qtd);
        });
        if (elTotalInsumos) elTotalInsumos.textContent = formatarMoeda(gastos.totalInsumos + comprasGerais);
    } catch (e) {
        console.warn('Falha ao atualizar totais gerais:', e);
    }

    // Mini-relat√≥rio por categoria (per√≠odo) e gr√°fico
    try {
        if (typeof atualizarTabelaCategoriasMes === 'function') atualizarTabelaCategoriasMes();
        if (typeof atualizarTabelaMedicosMes === 'function') atualizarTabelaMedicosMes();
    } catch(e){ console.warn('Falha ao atualizar tabela de categorias:', e); }

    try {
        if (typeof dadosEvolucaoPorFiltro === 'function' && typeof renderBarChartSVG === 'function') {
            const serie = dadosEvolucaoPorFiltro();
            renderBarChartSVG('graficoEvolucao', serie);
        }
    } catch(e) { console.warn('Falha ao renderizar gr√°fico:', e); }
}


        function atualizarUltimasTransacoes() {
            var container = document.getElementById('ultimasTransacoes');
            if (dados.receitas.length === 0 && dados.despesas.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhuma transacao registrada ainda</div><div class="transaction-date">Adicione receitas e despesas para comecar</div></div></div>';
            } else {
                var html = '';
                var todasTransacoes = [];
                
                // Combinar receitas e despesas
                dados.receitas.forEach(function(receita) {
                    todasTransacoes.push({
                        tipo: 'receita',
                        descricao: receita.descricao,
                        valor: receita.valor,
                        data: receita.data
                    });
                });
                
                dados.despesas.forEach(function(despesa) {
                    todasTransacoes.push({
                        tipo: 'despesa',
                        descricao: despesa.descricao,
                        valor: despesa.valor,
                        data: despesa.data
                    });
                });
                
                // Ordenar por data (mais recentes primeiro)
                todasTransacoes.sort(function(a, b) {
                    return new Date(b.data) - new Date(a.data);
                });
                
                // Mostrar apenas as 5 mais recentes
                todasTransacoes.slice(0, 5).forEach(function(transacao) {
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div>' + transacao.descricao + '</div>';
                    html += '<div class="transaction-date">' + formatarData(transacao.data) + '</div>';
                    html += '</div>';
                    html += '<div class="transaction-value ' + transacao.tipo + '">';
                    html += (transacao.tipo === 'receita' ? '+' : '-') + formatarMoeda(transacao.valor);
                    html += '</div>';
                    html += '</div>';
                });
                
                container.innerHTML = html;
            }
        }

        function atualizarListaReceitas() {
            var container = document.getElementById('listaReceitas');
            if (dados.receitas.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhuma receita registrada ainda</div></div></div>';
            } else {
                var html = '';
                dados.receitas.forEach(function(receita) {
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div><strong>' + receita.descricao + '</strong></div>';
                    html += '<div class="transaction-date">' + formatarData(receita.data) + ' | ' + receita.fonte + '</div>';
                    html += '</div>';
                    html += '<div class="transaction-value receita">' + formatarMoeda(receita.valor) + '</div>';
                    html += '<button class="delete-btn" onclick="excluirReceita(' + receita.id + ')">Excluir</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            }
        }

        function atualizarListaDespesas() {
            var container = document.getElementById('listaDespesas');
            if (dados.despesas.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhuma despesa registrada ainda</div></div></div>';
            } else {
                var html = '';
                dados.despesas.forEach(function(despesa) {
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div><strong>' + despesa.descricao + '</strong></div>';
                    html += '<div class="transaction-date">' + formatarData(despesa.data) + ' | ' + despesa.categoria + '</div>';
                    html += '</div>';
                    html += '<div class="transaction-value despesa">' + formatarMoeda(despesa.valor) + '</div>';
                    html += '<button class="delete-btn" onclick="excluirDespesa(' + despesa.id + ')">Excluir</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            }
        }
        
        // NOVA FUN√á√ÉO: Calcula o saldo total com base em TODAS as receitas e despesas
        function calcularSaldoAtualGlobal() {
            const totalReceitas = dados.receitas.reduce((acc, receita) => acc + parseFloat(receita.valor), 0);
            const totalDespesas = dados.despesas.reduce((acc, despesa) => acc + parseFloat(despesa.valor), 0);
            return totalReceitas - totalDespesas;
        }

        function atualizarFinanceiro() {
            if (!usuarioLogado) return;
            
            // Calcula o saldo atual dinamicamente
            const saldoCalculado = calcularSaldoAtualGlobal();
            
            // Atualiza a interface da aba "Financeiro"
            document.getElementById('inputSaldo').value = saldoCalculado.toFixed(2);
            document.getElementById('displaySaldo').textContent = formatarMoeda(saldoCalculado);
            
            // O campo de input agora √© apenas para visualiza√ß√£o
            document.getElementById('inputSaldo').readOnly = true; 
            document.getElementById('inputSaldo').style.background = '#e9ecef';

            // A proje√ß√£o continua funcionando
            const totalGastosFixos = dados.gastosFixos.reduce((total, g) => total + parseFloat(g.valor), 0);
            var saldoProjetado = saldoCalculado - totalGastosFixos;
            document.getElementById('saldoProjetado').innerHTML = '<strong>' + formatarMoeda(saldoProjetado) + '</strong>';

            // Desabilita o bot√£o que n√£o √© mais necess√°rio
            const btnAtualizar = document.querySelector('#financeiro .btn');
            if(btnAtualizar) {
                btnAtualizar.textContent = 'Saldo Autom√°tico';
                btnAtualizar.disabled = true;
            }
        }

        function atualizarSaldo() {
            // Esta fun√ß√£o agora est√° obsoleta, mas √© mantida para n√£o quebrar o bot√£o onclick.
            // A l√≥gica real est√° em `atualizarFinanceiro`.
            mostrarNotificacao('‚ÑπÔ∏è O saldo √© atualizado automaticamente.', 'info');
        }

        function adicionarDadosExemplo() {
            if (!usuarioLogado) return;
            
            if (confirm('Deseja adicionar alguns dados de exemplo para testar o sistema?')) {
                // Receitas
                dados.receitas.push({
                    id: 1001,
                    fonte: 'cirurgias',
                    descricao: 'Cirurgia de Retina - Joao Silva',
                    valor: 8500,
                    data: '2024-06-15'
                });
                
                dados.receitas.push({
                    id: 1002,
                    fonte: 'consultas',
                    descricao: 'Consultas da semana',
                    valor: 2400,
                    data: '2024-06-20'
                });
                
                // Despesas
                dados.despesas.push({
                    id: 2001,
                    categoria: 'insumos',
                    descricao: 'Materiais cirurgicos',
                    valor: 1200,
                    data: '2024-06-16'
                });

                dados.despesas.push({
                    id: 2002,
                    categoria: 'gasolina',
                    descricao: 'Combustivel do mes',
                    valor: 800,
                    data: '2024-06-18'
                });

                // Insumos (PRIMEIRO para poder usar nas cirurgias)
                dados.insumos.push({
                    id: 7001,
                    nome: 'Seringa 5ml',
                    categoria: 'descartaveis',
                    quantidade: 50,
                    unidade: 'unidade',
                    preco: 0.85,
                    estoqueMinimo: 20
                });

                dados.insumos.push({
                    id: 7002,
                    nome: 'Lubrificante Ocular',
                    categoria: 'medicamentos',
                    quantidade: 15,
                    unidade: 'frasco',
                    preco: 15.50,
                    estoqueMinimo: 10
                });

                dados.insumos.push({
                    id: 7003,
                    nome: 'Gaze Est√©ril',
                    categoria: 'descartaveis',
                    quantidade: 30,
                    unidade: 'pacote',
                    preco: 3.20,
                    estoqueMinimo: 15
                });

                dados.insumos.push({
                    id: 7004,
                    nome: 'Lente Intraocular',
                    categoria: 'equipamentos',
                    quantidade: 8,
                    unidade: 'unidade',
                    preco: 450.00,
                    estoqueMinimo: 5
                });

                // Cirurgias (com insumos e c√°lculos completos)
                dados.cirurgias.push({
                    id: 3001,
                    tipo: 'catarata',
                    paciente: 'Maria Santos',
                    valorBruto: 4000,
                    formaPagamento: 'cartao-credito-vista',
                    taxaCartao: 3.5,
                    taxaCartaoValor: 140, // 4000 * 3.5%
                    impostos: 720, // 4000 * 18%
                    comissaoOrientadora: 120, // 4000 * 3%
                    valorInstrumentadora: 0,
                    custoFuncionarios: 150,
                    outrosCustos: 0,
                    custoInsumos: 470.40,
                    totalCustosOperacionais: 470, // 120 + 200 + 150
                    totalCustos: 1800.40, // 140 + 720 + 120 + 200 + 150 + 470.40
                    valorLiquido: 2199.60, // 4000 - 1800.40
                    margem: 54.99, // (2199.60 / 4000) * 100
                    data: '2024-06-15',
                    status: 'realizada',
                    observacoes: 'Cirurgia sem complica√ß√µes',
                    insumosUtilizados: [
                        { id: 7004, nome: 'Lente Intraocular', quantidade: 1, preco: 450.00, unidade: 'unidade', total: 450.00 },
                        { id: 7001, nome: 'Seringa 5ml', quantidade: 4, preco: 0.85, unidade: 'unidade', total: 3.40 },
                        { id: 7002, nome: 'Lubrificante Ocular', quantidade: 1, preco: 15.50, unidade: 'frasco', total: 15.50 },
                        { id: 7003, nome: 'Gaze Est√©ril', quantidade: 1, preco: 3.20, unidade: 'pacote', total: 1.50 }
                    ]
                });

                dados.cirurgias.push({
                    id: 3002,
                    tipo: 'retina',
                    paciente: 'Jos√© Oliveira',
                    valorBruto: 6000,
                    formaPagamento: 'dinheiro',
                    taxaCartao: 0,
                    taxaCartaoValor: 0,
                    impostos: 1080, // 6000 * 18%
                    comissaoOrientadora: 180, // 6000 * 3%
                    valorInstrumentadora: 0,
                    custoFuncionarios: 150,
                    outrosCustos: 50, // Taxa extra anestesista
                    custoInsumos: 35.20,
                    totalCustosOperacionais: 580, // 180 + 200 + 150 + 50
                    totalCustos: 1845.20, // 0 + 1080 + 180 + 200 + 150 + 35.20 + 50
                    valorLiquido: 4154.80, // 6000 - 1845.20
                    margem: 69.25, // (4154.80 / 6000) * 100
                    data: '2024-06-25',
                    status: 'agendada',
                    observacoes: 'Paciente em jejum - Anestesista extra',
                    insumosUtilizados: [
                        { id: 7001, nome: 'Seringa 5ml', quantidade: 6, preco: 0.85, unidade: 'unidade', total: 5.10 },
                        { id: 7002, nome: 'Lubrificante Ocular', quantidade: 2, preco: 15.50, unidade: 'frasco', total: 31.00 },
                        { id: 7003, nome: 'Gaze Est√©ril', quantidade: 2, preco: 3.20, unidade: 'pacote', total: 6.40 }
                    ]
                });

                dados.cirurgias.push({
                    id: 3003,
                    tipo: 'pter√≠gio',
                    paciente: 'Ana Costa',
                    valorBruto: 1500,
                    formaPagamento: 'cartao-debito',
                    taxaCartao: 1.5,
                    taxaCartaoValor: 22.50, // 1500 * 1.5%
                    impostos: 270, // 1500 * 18%
                    comissaoOrientadora: 45, // 1500 * 3%
                    valorInstrumentadora: 0,
                    custoFuncionarios: 150,
                    outrosCustos: 0,
                    custoInsumos: 8.90,
                    totalCustosOperacionais: 395, // 45 + 200 + 150
                    totalCustos: 696.40, // 22.50 + 270 + 45 + 200 + 150 + 8.90
                    valorLiquido: 803.60, // 1500 - 696.40
                    margem: 53.57, // (803.60 / 1500) * 100
                    data: '2024-06-20',
                    status: 'realizada',
                    observacoes: 'Procedimento simples - r√°pido',
                    insumosUtilizados: [
                        { id: 7001, nome: 'Seringa 5ml', quantidade: 2, preco: 0.85, unidade: 'unidade', total: 1.70 },
                        { id: 7003, nome: 'Gaze Est√©ril', quantidade: 2, preco: 3.20, unidade: 'pacote', total: 6.40 },
                        { id: 7002, nome: 'Lubrificante Ocular', quantidade: 1, preco: 0.80, unidade: 'frasco', total: 0.80 }
                    ]
                });
                
                // Adicionar receitas para as cirurgias realizadas de exemplo
                dados.receitas.push({
                    id: 300101,
                    fonte: 'cirurgias',
                    descricao: 'L√≠quido da Cirurgia: Maria Santos (catarata)',
                    valor: 2199.60,
                    data: '2024-06-15'
                });
                 dados.receitas.push({
                    id: 300301,
                    fonte: 'cirurgias',
                    descricao: 'L√≠quido da Cirurgia: Ana Costa (pter√≠gio)',
                    valor: 803.60,
                    data: '2024-06-20'
                });


                // Funcion√°rios (ANTES das cirurgias para calcular custos)
                dados.funcionarios.push({
                    id: 4001,
                    nome: 'Ana Paula Enfermeira',
                    cargo: 'enfermeiro',
                    tipoPagamento: 'mensal',
                    salario: 3500,
                    dataAdmissao: '2023-01-15',
                    status: 'ativo'
                });

                dados.funcionarios.push({
                    id: 4002,
                    nome: 'Carlos Recepcionista',
                    cargo: 'recepcionista',
                    tipoPagamento: 'mensal',
                    salario: 2800,
                    dataAdmissao: '2023-03-01',
                    status: 'ativo'
                });

                dados.funcionarios.push({
                    id: 4003,
                    nome: 'Jo√£o Auxiliar Cirurgia',
                    cargo: 'auxiliar',
                    tipoPagamento: 'diario',
                    valorDiario: 80,
                    dataAdmissao: '2024-01-10',
                    status: 'ativo'
                });

                dados.funcionarios.push({
                    id: 4004,
                    nome: 'Maria T√©cnica',
                    cargo: 'tecnico',
                    tipoPagamento: 'diario',
                    valorDiario: 70,
                    dataAdmissao: '2024-02-15',
                    status: 'ativo'
                });

                // Gastos Fixos
                dados.gastosFixos.push({
                    id: 5001,
                    descricao: 'Aluguel Consult√≥rio',
                    categoria: 'aluguel',
                    valor: 4500,
                    diaVencimento: 10
                });

                dados.gastosFixos.push({
                    id: 5002,
                    descricao: 'Energia El√©trica',
                    categoria: 'energia',
                    valor: 800,
                    diaVencimento: 15
                });

                // Parcelas
                dados.parcelas.push({
                    id: 6001,
                    tipo: 'pagar',
                    descricao: 'Financiamento Equipamento',
                    valor: 1200,
                    numeroParcelas: 12, // Exemplo
                    dataVencimento: '2024-06-30',
                    status: 'pendente'
                });

                dados.parcelas.push({
                    id: 6002,
                    tipo: 'receber',
                    descricao: 'Plano de Sa√∫de - Consultas',
                    valor: 2500,
                    numeroParcelas: 3, // Exemplo
                    dataVencimento: '2024-06-28',
                    status: 'pendente'
                });

                // Ajustar estoque ap√≥s cirurgias realizadas
                // Subtrair insumos usados na cirurgia da Maria Santos (realizada)
                dados.insumos[0].quantidade -= 4; // Seringa 5ml: 50 - 4 = 46
                dados.insumos[1].quantidade -= 1; // Lubrificante: 15 - 1 = 14  
                dados.insumos[2].quantidade -= 1; // Gaze: 30 - 1 = 29
                dados.insumos[3].quantidade -= 1; // Lente: 8 - 1 = 7

                // Subtrair insumos da Ana Costa (realizada)
                dados.insumos[0].quantidade -= 2; // Seringa: 46 - 2 = 44
                dados.insumos[2].quantidade -= 2; // Gaze: 29 - 2 = 27
                
                // Atualizar todas as visualiza√ß√µes
                atualizarTodasAsVisualizacoes();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üéØ Dados de exemplo adicionados com sucesso! Explore todas as abas para ver as funcionalidades.', 'success');
            }
        }
                      function editarCirurgia(id) {
    var cirurgia = dados.cirurgias.find(c => c.id === id);
    if (!cirurgia) return;

    // Preencher os campos do formul√°rio com os dados da cirurgia
    document.querySelector('input[name="tipo"]').value = cirurgia.tipo;
    document.querySelector('input[name="paciente"]').value = cirurgia.paciente;
    document.querySelector('input[name="valorBruto"]').value = cirurgia.valorBruto;
    document.querySelector('select[name="formaPagamento"]').value = cirurgia.formaPagamento;
    document.querySelector('input[name="taxaCartao"]').value = cirurgia.taxaCartao || '';
    document.querySelector('input[name="data"]').value = cirurgia.data;
    document.querySelector('select[name="status"]').value = cirurgia.status;
    document.querySelector('textarea[name="observacoes"]').value = cirurgia.observacoes || '';

    // Custos operacionais
    document.getElementById('comissaoOrientadora').value = cirurgia.comissaoOrientadora || 3.0;
    document.getElementById('valorInstrumentadora').value = cirurgia.valorInstrumentadora || 200.00;
    document.getElementById('outrosCustos').value = cirurgia.outrosCustos || 0;

    // Limpar e carregar insumos utilizados
    document.getElementById('insumosUtilizados').innerHTML = '';
    if (cirurgia.insumosUtilizados && cirurgia.insumosUtilizados.length > 0) {
        cirurgia.insumosUtilizados.forEach(insumo => {
            adicionarLinhaInsumoEditavel(insumo);
        });
    } else {
        adicionarLinhaInsumo();
    }

    // Mostrar/ocultar taxa de cart√£o
    var taxaGroup = document.getElementById('taxaCartaoGroup');
    taxaGroup.style.display = cirurgia.formaPagamento.includes('cartao') ? 'block' : 'none';

    // Atualizar c√°lculos
    calcularResumoFinanceiro();

    // Rolar para o topo e alterar bot√£o para "Atualizar"
    document.getElementById('formCirurgia').scrollIntoView({ behavior: 'smooth' });
    var submitBtn = document.querySelector('#formCirurgia button[type="submit"]');
    submitBtn.textContent = 'Atualizar Cirurgia';
    submitBtn.onclick = function(e) {
        e.preventDefault();
        atualizarCirurgia(id);
    };

    // Adicionar bot√£o "Cancelar edi√ß√£o"
    adicionarBotaoCancelarEdicao();

    mostrarNotificacao('‚úèÔ∏è Editando cirurgia de ' + cirurgia.paciente, 'info');
}

     // === FUN√á√ïES PARA CIRURGIAS ===
        function atualizarListaCirurgias() {
            var container = document.getElementById('listaCirurgias');
            if (dados.cirurgias.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhuma cirurgia registrada ainda</div></div></div>';
            } else {
                var html = '';
                dados.cirurgias.forEach(function(cirurgia) {
                    var statusClass = cirurgia.status === 'realizada' ? 'status-pago' : 
                                    cirurgia.status === 'agendada' ? 'status-pendente' : 'status-cancelada';
                    var margemClass = cirurgia.margem >= 50 ? 'margem-alta' : 
                                    cirurgia.margem >= 30 ? 'margem-media' : 'margem-baixa';
                    
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div><strong>' + cirurgia.paciente + '</strong> - ' + cirurgia.tipo + '</div>';
                    html += '<div class="transaction-date">' + formatarData(cirurgia.data) + ' | ' + (cirurgia.formaPagamento || 'N/A') + '</div>';
                    html += '<div style="font-size: 0.85em; color: #666; margin-top: 3px;">';
                    html += 'Bruto: ' + formatarMoeda(cirurgia.valorBruto || cirurgia.valor || 0) + ' | ';
                    html += 'Custos: ' + formatarMoeda(cirurgia.totalCustos || 0) + ' | ';
                    html += 'L√≠quido: ' + formatarMoeda(cirurgia.valorLiquido || cirurgia.valor || 0);
                    html += '</div>';
                    html += '<div style="font-size: 0.85em; margin-top: 2px;">';
                    html += '<span class="' + margemClass + '">Margem: ' + ((cirurgia.margem || 0).toFixed(1)) + '%</span>';
                    html += '</div>';
                    html += '<div style="margin-top: 5px;"><span class="' + statusClass + '">' + cirurgia.status.toUpperCase() + '</span></div>';
                    html += '</div>';
                    html += '<div style="text-align: right;">';
                    html += '<div class="transaction-value receita">' + formatarMoeda(cirurgia.valorLiquido || cirurgia.valor || 0) + '</div>';
                    html += '<button class="btn" style="font-size: 10px; padding: 3px 8px; margin: 2px;" onclick="verDetalhesCirurgia(' + cirurgia.id + ')">Ver Detalhes</button>';
                    html += '</div>';
                    html += '<button class="delete-btn" onclick="excluirCirurgia(' + cirurgia.id + ')">Excluir</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            }
        }

        function atualizarResumoCirurgias() {
            var realizadas = dados.cirurgias.filter(c => c.status === 'realizada').length;
            var agendadas = dados.cirurgias.filter(c => c.status === 'agendada').length;
            var faturamentoBruto = dados.cirurgias.filter(c => c.status === 'realizada').reduce((total, c) => total + parseFloat(c.valorBruto || c.valor || 0), 0);
            var faturamentoLiquido = dados.cirurgias.filter(c => c.status === 'realizada').reduce((total, c) => total + parseFloat(c.valorLiquido || c.valor || 0), 0);
            var margemMedia = realizadas > 0 ? dados.cirurgias.filter(c => c.status === 'realizada').reduce((total, c) => total + (c.margem || 0), 0) / realizadas : 0;
            
            document.getElementById('cirurgiasRealizadas').textContent = realizadas;
            document.getElementById('cirurgiasAgendadas').textContent = agendadas;
            document.getElementById('faturamentoBruto').textContent = formatarMoeda(faturamentoBruto);
            document.getElementById('faturamentoLiquido').textContent = formatarMoeda(faturamentoLiquido);
            document.getElementById('margemMedia').textContent = margemMedia.toFixed(1) + '%';
            
            // Manter compatibilidade com o dashboard
            if (document.getElementById('faturamentoCirurgias')) {
                document.getElementById('faturamentoCirurgias').textContent = formatarMoeda(faturamentoLiquido);
            }
        }

        function verDetalhesCirurgia(id) {
            var cirurgia = dados.cirurgias.find(c => c.id === id);
            if (!cirurgia) return;
            
            var detalhes = 'DETALHES COMPLETOS DA CIRURGIA\n\n';
            detalhes += 'Paciente: ' + cirurgia.paciente + '\n';
            detalhes += 'Tipo: ' + cirurgia.tipo + '\n';
            detalhes += 'Data: ' + formatarData(cirurgia.data) + '\n';
            detalhes += 'Status: ' + cirurgia.status + '\n\n';
            
            detalhes += 'RECEITA:\n';
            detalhes += 'Valor Bruto: ' + formatarMoeda(cirurgia.valorBruto || cirurgia.valor || 0) + '\n';
            detalhes += 'Forma Pagamento: ' + (cirurgia.formaPagamento || 'N/A') + '\n\n';
            
            detalhes += 'CUSTOS DETALHADOS:\n';
            detalhes += '‚Ä¢ Taxa Cart√£o: ' + formatarMoeda(cirurgia.taxaCartaoValor || 0) + '\n';
            detalhes += '‚Ä¢ Impostos (18%): ' + formatarMoeda(cirurgia.impostos || 0) + '\n';
            detalhes += '‚Ä¢ Comiss√£o Orientadora: ' + formatarMoeda(cirurgia.comissaoOrientadora || 0) + '\n';
            detalhes += '‚Ä¢ Instrumentadora: ' + formatarMoeda(cirurgia.valorInstrumentadora || 0) + '\n';
            detalhes += '‚Ä¢ Funcion√°rios/Dia: ' + formatarMoeda(cirurgia.custoFuncionarios || 0) + '\n';
            detalhes += '‚Ä¢ Custo Insumos: ' + formatarMoeda(cirurgia.custoInsumos || 0) + '\n';
            if (cirurgia.outrosCustos && cirurgia.outrosCustos > 0) {
                detalhes += '‚Ä¢ Outros Custos: ' + formatarMoeda(cirurgia.outrosCustos) + '\n';
            }
            detalhes += '-----------------------------------\n';
            detalhes += 'TOTAL DE CUSTOS: ' + formatarMoeda(cirurgia.totalCustos || 0) + '\n\n';
            
            detalhes += 'RESULTADO:\n';
            detalhes += 'Valor L√≠quido: ' + formatarMoeda(cirurgia.valorLiquido || cirurgia.valor || 0) + '\n';
            detalhes += 'Margem: ' + ((cirurgia.margem || 0).toFixed(1)) + '%\n\n';
            
            if (cirurgia.insumosUtilizados && cirurgia.insumosUtilizados.length > 0) {
                detalhes += 'INSUMOS UTILIZADOS:\n';
                cirurgia.insumosUtilizados.forEach(function(insumo) {
                    detalhes += '‚Ä¢ ' + insumo.nome + ': ' + insumo.quantidade + ' x ' + formatarMoeda(insumo.preco) + ' = ' + formatarMoeda(insumo.total) + '\n';
                });
                detalhes += '\n';
            }
            
            if (cirurgia.observacoes) {
                detalhes += 'OBSERVA√á√ïES:\n' + cirurgia.observacoes;
            }
            
            alert(detalhes);
        }

        function carregarInsumosNoSelect() {
            var selects = document.querySelectorAll('.insumo-select');
            selects.forEach(function(select) {
                select.innerHTML = '<option value="">Selecione um insumo...</option>';
                dados.insumos.forEach(function(insumo) {
                    var option = document.createElement('option');
                    option.value = insumo.id;
                    option.textContent = insumo.nome + ' - ' + formatarMoeda(insumo.preco) + '/' + insumo.unidade + ' (Estoque: ' + insumo.quantidade + ')';
                    option.dataset.preco = insumo.preco;
                    option.dataset.nome = insumo.nome;
                    option.dataset.unidade = insumo.unidade;
                    option.dataset.estoque = insumo.quantidade;
                    select.appendChild(option);
                });
            });
        }

        function adicionarLinhaInsumo() {
            var container = document.getElementById('insumosUtilizados');
            var novaLinha = document.createElement('div');
            novaLinha.className = 'insumo-item';
            novaLinha.style.cssText = 'display: flex; gap: 10px; margin: 10px 0; align-items: center;';
            
            novaLinha.innerHTML = `
                <input type="text" class="codigo-barras-insumo" placeholder="Escaneie o c√≥digo" style="flex: 2;">
                <select class="insumo-select" style="flex: 2;">
                    <option value="">Selecione um insumo...</option>
                </select>
                <input type="number" class="quantidade-insumo" placeholder="Qtd" style="width: 80px;" min="1">
                <span class="preco-insumo" style="width: 100px; font-weight: bold;"></span>
                <button type="button" class="btn-remover-insumo" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; flex-shrink: 0; margin-left: 5px;">Remover</button>
            `;
            
            container.appendChild(novaLinha);
            carregarInsumosNoSelect();
            configurarEventosInsumo(novaLinha);
        }

        function configurarEventosInsumo(linha) {
            var select = linha.querySelector('.insumo-select');
            var quantidade = linha.querySelector('.quantidade-insumo');
            var preco = linha.querySelector('.preco-insumo');
            var btnRemover = linha.querySelector('.btn-remover-insumo');
            
            
            
            var codigoInput = linha.querySelector('.codigo-barras-insumo');
            if (codigoInput) {
                codigoInput.addEventListener('input', function(e) {
                    var codigo = e.target.value.trim();
                    if (codigo.length > 2) {
                        carregarInsumosNoSelect();
                        var match = dados.insumos.find(function(i){ return String(i.codigoBarras || '') === String(codigo); });
                        if (match) {
                            select.value = match.id;
                            quantidade.value = quantidade.value || 1;
                            select.dispatchEvent(new Event('change'));
                        }
                    }
                });
                codigoInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        var codigo = e.target.value.trim();
                        if (codigo) {
                            carregarInsumosNoSelect();
                            var match = dados.insumos.find(function(i){ return String(i.codigoBarras || '') === String(codigo); });
                            if (match) {
                                select.value = match.id;
                                quantidade.value = quantidade.value || 1;
                                select.dispatchEvent(new Event('change'));
                            }
                        }
                    }
                });
            }
function atualizarPreco() {
                var option = select.options[select.selectedIndex];
                var qtd = parseInt(quantidade.value) || 0;
                var precoUnit = parseFloat(option.dataset.preco) || 0;
                var total = qtd * precoUnit;
                
                if (qtd > 0 && precoUnit > 0) {
                    preco.textContent = formatarMoeda(total);
                } else {
                    preco.textContent = '';
                }
                
                calcularResumoFinanceiro();
            }
            
            select.addEventListener('change', atualizarPreco);
            quantidade.addEventListener('input', atualizarPreco);
            
            btnRemover.addEventListener('click', function() {
                linha.remove();
                calcularResumoFinanceiro();
            });
        }

        function calcularResumoFinanceiro() {
            var valorBruto = parseFloat(document.getElementById('valorBrutoCirurgia').value) || 0;
            var formaPagamento = document.getElementById('formaPagamentoCirurgia').value;
            var taxaCartao = parseFloat(document.getElementById('taxaCartaoCirurgia').value) || 0;
            
            // Custos operacionais
            var comissaoPerc = parseFloat(document.getElementById('comissaoOrientadora').value) || 0;
            var valorInstrumentadora = parseFloat(document.getElementById('valorInstrumentadora').value) || 0;
            var outrosCustos = parseFloat(document.getElementById('outrosCustos').value) || 0;
            
            // Calcular custo dos funcion√°rios por dia (autom√°tico da aba funcion√°rios)
            var custoFuncionariosDia = calcularCustoFuncionariosDia();
            
            // Calcular total de insumos
            var totalInsumos = 0;
            var linhasInsumos = document.querySelectorAll('.insumo-item');
            linhasInsumos.forEach(function(linha) {
                var select = linha.querySelector('.insumo-select');
                var quantidade = linha.querySelector('.quantidade-insumo');
                
                if (select.value && quantidade.value) {
                    var option = select.options[select.selectedIndex];
                    var precoUnit = parseFloat(option.dataset.preco) || 0;
                    var qtd = parseInt(quantidade.value) || 0;
                    totalInsumos += precoUnit * qtd;
                }
            });
            
            // Calcular descontos e custos
            var taxaCartaoValor = 0;
            if (formaPagamento.includes('cartao') && taxaCartao > 0) {
                taxaCartaoValor = valorBruto * (taxaCartao / 100);
            }
            
            var impostos = valorBruto * 0.18; // 18% fixo
            var comissaoOrientadora = valorBruto * (comissaoPerc / 100);
            var totalCustosOperacionais = comissaoOrientadora + valorInstrumentadora + custoFuncionariosDia + outrosCustos;
            var totalCustos = taxaCartaoValor + impostos + comissaoOrientadora + valorInstrumentadora + custoFuncionariosDia + totalInsumos + outrosCustos;
            var valorLiquido = valorBruto - totalCustos;
            var margem = valorBruto > 0 ? ((valorLiquido / valorBruto) * 100) : 0;
            
            // Atualizar interface
            document.getElementById('totalInsumos').innerHTML = '<strong>' + formatarMoeda(totalInsumos) + '</strong>';
            document.getElementById('valorComissaoOrientadora').innerHTML = '<strong>' + formatarMoeda(comissaoOrientadora) + '</strong>';
            document.getElementById('custoFuncionariosDia').innerHTML = '<strong>' + formatarMoeda(custoFuncionariosDia) + '</strong>';
            document.getElementById('totalCustosOperacionais').innerHTML = '<strong>' + formatarMoeda(totalCustosOperacionais) + '</strong>';
            
            document.getElementById('resumoValorBruto').textContent = formatarMoeda(valorBruto);
            document.getElementById('resumoTaxaCartao').textContent = formatarMoeda(taxaCartaoValor);
            document.getElementById('resumoImpostos').textContent = formatarMoeda(impostos);
            document.getElementById('resumoComissaoOrientadora').textContent = formatarMoeda(comissaoOrientadora);
            document.getElementById('resumoInstrumentadora').textContent = formatarMoeda(valorInstrumentadora);
            document.getElementById('resumoFuncionarios').textContent = formatarMoeda(custoFuncionariosDia);
            document.getElementById('resumoCustoInsumos').textContent = formatarMoeda(totalInsumos);
            document.getElementById('resumoOutrosCustos').textContent = formatarMoeda(outrosCustos);
            document.getElementById('resumoTotalCustos').innerHTML = '<strong>' + formatarMoeda(totalCustos) + '</strong>';
            document.getElementById('resumoValorLiquido').innerHTML = '<strong>' + formatarMoeda(valorLiquido) + '</strong>';
            document.getElementById('resumoMargem').innerHTML = '<strong>' + margem.toFixed(1) + '%</strong>';
            
            // Aplicar cores baseadas na margem (ajustado para custos reais)
            var corMargem = margem >= 50 ? '#28a745' : margem >= 30 ? '#ffc107' : '#dc3545';
            document.getElementById('resumoValorLiquido').style.color = valorLiquido >= 0 ? '#28a745' : '#dc3545';
            document.getElementById('resumoMargem').style.color = corMargem;
        }

        function calcularCustoFuncionariosDia() {
            // Calcular automaticamente o custo dos funcion√°rios que trabalham por dia
            var custoTotal = 0;
            dados.funcionarios.forEach(function(funcionario) {
                if (funcionario.status === 'ativo' && funcionario.tipoPagamento === 'diario') {
                    custoTotal += parseFloat(funcionario.valorDiario || 0);
                }
            });
            return custoTotal;
        }

        function processarCirurgia(dadosCirurgia) {
            // Coletar insumos utilizados
            var insumosUtilizados = [];
            var totalInsumos = 0;
            
            var linhasInsumos = document.querySelectorAll('.insumo-item');
            linhasInsumos.forEach(function(linha) {
                var select = linha.querySelector('.insumo-select');
                var quantidade = linha.querySelector('.quantidade-insumo');
                
                if (select.value && quantidade.value) {
                    var option = select.options[select.selectedIndex];
                    var insumoId = parseInt(select.value);
                    var qtd = parseInt(quantidade.value);
                    var precoUnit = parseFloat(option.dataset.preco);
                    var total = precoUnit * qtd;
                    
                    insumosUtilizados.push({
                        id: insumoId,
                        nome: option.dataset.nome,
                        quantidade: qtd,
                        preco: precoUnit,
                        unidade: option.dataset.unidade,
                        total: total
                    });
                    
                    totalInsumos += total;
                    
                    // Descontar do estoque se a cirurgia foi realizada
                    if (dadosCirurgia.status === 'realizada') {
                        var insumo = dados.insumos.find(i => i.id === insumoId);
                        if (insumo) {
                            insumo.quantidade = Math.max(0, insumo.quantidade - qtd);
                        }
                    }
                }
            });
            
            // Calcular valores
            var valorBruto = dadosCirurgia.valorBruto;
            var taxaCartaoValor = 0;
            
            if (dadosCirurgia.formaPagamento.includes('cartao') && dadosCirurgia.taxaCartao > 0) {
                taxaCartaoValor = valorBruto * (dadosCirurgia.taxaCartao / 100);
            }
            
            var impostos = valorBruto * 0.18;
            var comissaoOrientadora = valorBruto * ((dadosCirurgia.comissaoOrientadora || 3) / 100);
            var comissaoMedicoPerc = (parseFloat(dadosCirurgia.comissaoMedico) || 0);
            var comissaoMedicoValor = valorBruto * (comissaoMedicoPerc / 100);
            var valorInstrumentadora = dadosCirurgia.valorInstrumentadora || 0;
            var custoFuncionarios = calcularCustoFuncionariosDia(); // C√°lculo autom√°tico
            var outrosCustos = dadosCirurgia.outrosCustos || 0;
            
            var totalCustosOperacionais = comissaoOrientadora + comissaoMedicoValor + valorInstrumentadora + custoFuncionarios + outrosCustos;
            var totalCustos = taxaCartaoValor + impostos + comissaoOrientadora + comissaoMedicoValor + valorInstrumentadora + custoFuncionarios + totalInsumos + outrosCustos;
            var valorLiquido = valorBruto - totalCustos;
            var margem = valorBruto > 0 ? ((valorLiquido / valorBruto) * 100) : 0;
            
            // Estrutura completa da cirurgia
            return {
                ...dadosCirurgia,
                comissaoMedicoPerc: comissaoMedicoPerc,
                comissaoMedicoValor: comissaoMedicoValor,
                insumosUtilizados: insumosUtilizados,
                custoInsumos: totalInsumos,
                comissaoOrientadora: comissaoOrientadora,
                valorInstrumentadora: valorInstrumentadora,
                custoFuncionarios: custoFuncionarios,
                outrosCustos: outrosCustos,
                totalCustosOperacionais: totalCustosOperacionais,
                taxaCartaoValor: taxaCartaoValor,
                impostos: impostos,
                totalCustos: totalCustos,
                valorLiquido: valorLiquido,
                margem: margem
            };
        }

        function excluirCirurgia(id) {
            if (!usuarioLogado) return;
            if (confirm('Tem certeza que deseja excluir esta cirurgia? Esta a√ß√£o tamb√©m remover√° a receita associada a ela, se houver.')) {
                // Restaurar estoque se necess√°rio
                var cirurgia = dados.cirurgias.find(c => c.id === id);
                if (cirurgia && cirurgia.status === 'realizada' && cirurgia.insumosUtilizados) {
                    cirurgia.insumosUtilizados.forEach(function(insumoUtilizado) {
                        var insumo = dados.insumos.find(i => i.id === insumoUtilizado.id);
                        if (insumo) {
                            insumo.quantidade += insumoUtilizado.quantidade;
                        }
                    });
                }
                
                // Excluir a receita correspondente
                const descReceita = `L√≠quido da Cirurgia: ${cirurgia.paciente} (${cirurgia.tipo})`;
                dados.receitas = dados.receitas.filter(r => r.descricao !== descReceita);

                // Excluir a cirurgia
                dados.cirurgias = dados.cirurgias.filter(c => c.id !== id);

                atualizarTodasAsVisualizacoes();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üóëÔ∏è Cirurgia e sua receita foram exclu√≠das!', 'warning');
            }
        }

        // === FUN√á√ïES PARA FUNCION√ÅRIOS ===
        function atualizarListaFuncionarios() {
            var container = document.getElementById('listaFuncionarios');
            if (dados.funcionarios.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhum funcion√°rio registrado ainda</div></div></div>';
            } else {
                var html = '';
                dados.funcionarios.forEach(function(funcionario) {
                    var statusClass = funcionario.status === 'ativo' ? 'status-pago' : 
                                    funcionario.status === 'ferias' ? 'status-pendente' : 'status-cancelada';
                    var tipoTexto = funcionario.tipoPagamento === 'mensal' ? 'Mensal' : 'Por Dia';
                    var valorTexto = funcionario.tipoPagamento === 'mensal' ? 
                                   formatarMoeda(funcionario.salario || 0) : 
                                   formatarMoeda(funcionario.valorDiario || 0) + '/dia';
                    
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div><strong>' + funcionario.nome + '</strong> - ' + funcionario.cargo + '</div>';
                    html += '<div class="transaction-date">Admiss√£o: ' + formatarData(funcionario.dataAdmissao) + ' | ' + tipoTexto + '</div>';
                    html += '<div style="margin-top: 5px;"><span class="' + statusClass + '">' + funcionario.status.toUpperCase() + '</span></div>';
                    html += '</div>';
                    html += '<div class="transaction-value ' + (funcionario.tipoPagamento === 'mensal' ? 'despesa' : 'receita') + '">' + valorTexto + '</div>';
                    html += '<button class="delete-btn" onclick="excluirFuncionario(' + funcionario.id + ')">Excluir</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            }
        }

        function atualizarResumoFuncionarios() {
            var ativos = dados.funcionarios.filter(f => f.status === 'ativo').length;
            var totalFolhaMensal = dados.funcionarios.filter(f => f.status === 'ativo' && f.tipoPagamento === 'mensal').reduce((total, f) => total + parseFloat(f.salario || 0), 0);
            var custoPorCirurgia = dados.funcionarios.filter(f => f.status === 'ativo' && f.tipoPagamento === 'diario').reduce((total, f) => total + parseFloat(f.valorDiario || 0), 0);
            
            document.getElementById('funcionariosAtivos').textContent = ativos;
            document.getElementById('totalFolha').textContent = formatarMoeda(totalFolhaMensal);
            document.getElementById('custoPorCirurgia').textContent = formatarMoeda(custoPorCirurgia);
        }

        function excluirFuncionario(id) {
            if (!usuarioLogado) return;
            if (confirm('Tem certeza que deseja excluir este funcion√°rio?')) {
                dados.funcionarios = dados.funcionarios.filter(f => f.id !== id);
                atualizarListaFuncionarios();
                atualizarResumoFuncionarios();
                // Recalcular cirurgias se necess√°rio
                calcularResumoFinanceiro();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üóëÔ∏è Funcion√°rio exclu√≠do com sucesso!', 'warning');
            }
        }

        // === FUN√á√ïES PARA GASTOS FIXOS ===
        function atualizarListaGastosFixos() {
            var container = document.getElementById('listaGastosFixos');
            if (dados.gastosFixos.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhum gasto fixo registrado ainda</div></div></div>';
            } else {
                var html = '';
                dados.gastosFixos.forEach(function(gasto) {
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div><strong>' + gasto.descricao + '</strong></div>';
                    html += '<div class="transaction-date">' + gasto.categoria + ' - Vencimento dia ' + gasto.diaVencimento + '</div>';
                    html += '</div>';
                    html += '<div class="transaction-value despesa">' + formatarMoeda(gasto.valor) + '</div>';
                    html += '<button class="delete-btn" onclick="excluirGastoFixo(' + gasto.id + ')">Excluir</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            }
        }

        function atualizarResumoGastosFixos() {
            var total = dados.gastosFixos.reduce((total, g) => total + parseFloat(g.valor), 0);
            document.getElementById('totalGastosFixosDetalhado').innerHTML = '<strong>' + formatarMoeda(total) + '</strong>';
            document.getElementById('totalGastosFixos').textContent = formatarMoeda(total);
        }

        function excluirGastoFixo(id) {
            if (!usuarioLogado) return;
            if (confirm('Tem certeza que deseja excluir este gasto fixo?')) {
                dados.gastosFixos = dados.gastosFixos.filter(g => g.id !== id);
                atualizarListaGastosFixos();
                atualizarResumoGastosFixos();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üóëÔ∏è Gasto fixo exclu√≠do com sucesso!', 'warning');
            }
        }

        // === FUN√á√ïES PARA PARCELAS ===
        function atualizarListaParcelas() {
            var container = document.getElementById('listaParcelas');
            if (dados.parcelas.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhuma parcela registrada ainda</div></div></div>';
            } else {
                var html = '';
                dados.parcelas.forEach(function(parcela) {
                    var statusClass = parcela.status === 'pago' ? 'status-pago' : 
                                    parcela.status === 'pendente' ? 'status-pendente' : 'status-cancelada';
                    var tipoClass = parcela.tipo === 'receber' ? 'receita' : 'despesa';
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div><strong>' + parcela.descricao + '</strong></div>';
                    html += '<div class="transaction-date">Vencimento: ' + formatarData(parcela.dataVencimento) + ' | ' + parcela.tipo.toUpperCase();
                    // Adicionar n√∫mero de parcelas se existir
                    if (parcela.numeroParcelas) {
                        html += ' | Parcelas: ' + parcela.numeroParcelas;
                    }
                    html += '</div>';
                    html += '<div style="margin-top: 5px;"><span class="' + statusClass + '">' + parcela.status.toUpperCase() + '</span></div>';
                    html += '</div>';
                    html += '<div class="transaction-value ' + tipoClass + '">' + formatarMoeda(parcela.valor) + '</div>';
                    html += '<button class="delete-btn" onclick="excluirParcela(' + parcela.id + ')">Excluir</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            }
        }

        function atualizarResumoParcelas() {
            var totalAPagar = dados.parcelas.filter(p => p.tipo === 'pagar' && p.status === 'pendente').reduce((total, p) => total + parseFloat(p.valor), 0);
            var totalAReceber = dados.parcelas.filter(p => p.tipo === 'receber' && p.status === 'pendente').reduce((total, p) => total + parseFloat(p.valor), 0);
            var totalParcelasRegistradas = dados.parcelas.length; // Novo: Contagem total de parcelas
            
            document.getElementById('totalAPagar').textContent = formatarMoeda(totalAPagar);
            document.getElementById('totalAReceber').textContent = formatarMoeda(totalAReceber);
            document.getElementById('totalParcelasRegistradas').textContent = totalParcelasRegistradas; // Atualiza o novo elemento
        }

        function excluirParcela(id) {
            if (!usuarioLogado) return;
            if (confirm('Tem certeza que deseja excluir esta parcela?')) {
                dados.parcelas = dados.parcelas.filter(p => p.id !== id);
                atualizarListaParcelas();
                atualizarResumoParcelas();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üóëÔ∏è Parcela exclu√≠da com sucesso!', 'warning');
            }
        }

        // === FUN√á√ïES PARA INSUMOS ===
        function atualizarListaInsumos() {
            var container = document.getElementById('listaInsumos');
            if (dados.insumos.length === 0) {
                container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhum insumo registrado ainda</div></div></div>';
            } else {
                var html = '';
                dados.insumos.forEach(function(insumo) {
                    var alertaEstoque = insumo.quantidade <= insumo.estoqueMinimo ? ' ‚ö†Ô∏è' : '';
                    html += '<div class="transaction-item">';
                    html += '<div class="transaction-info">';
                    html += '<div><strong>' + insumo.nome + '</strong>' + alertaEstoque + '</div>';
                    html += '<div class="transaction-date">' + insumo.categoria + ' | Estoque: ' + insumo.quantidade + ' ' + insumo.unidade + '</div>';
                    html += '</div>';
                    html += '<div class="transaction-value">' + formatarMoeda(insumo.preco) + '/' + insumo.unidade + '</div>';
                    html += '<button class="delete-btn" onclick="excluirInsumo(' + insumo.id + ')">Excluir</button>';
                    html += '</div>';
                });
                container.innerHTML = html;
            }
        }

        function atualizarResumoInsumos() {
            var totalItens = dados.insumos.length;
            var itensEmFalta = dados.insumos.filter(i => i.quantidade <= i.estoqueMinimo).length;
            
            document.getElementById('totalItens').textContent = totalItens;
            document.getElementById('itensEmFalta').textContent = itensEmFalta;
        }

        function excluirInsumo(id) {
            if (!usuarioLogado) return;
            if (confirm('Tem certeza que deseja excluir este insumo?')) {
                dados.insumos = dados.insumos.filter(i => i.id !== id);
                atualizarListaInsumos();
                atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üóëÔ∏è Insumo exclu√≠do com sucesso!', 'warning');
            }
        }

        // === FUN√á√ïES PARA RELAT√ìRIOS ===
        function gerarRelatorio() {
            if (!usuarioLogado) return;
            
            var periodo = document.getElementById('periodoRelatorio').value;
            var dataInicial, dataFinal;
            var hoje = new Date();
            
            switch(periodo) {
                case 'mes-atual':
                    dataInicial = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                    dataFinal = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
                    break;
                case 'mes-anterior':
                    dataInicial = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1);
                    dataFinal = new Date(hoje.getFullYear(), hoje.getMonth(), 0);
                    break;
                case 'trimestre':
                    dataInicial = new Date(hoje.getFullYear(), hoje.getMonth() - 2, 1);
                    dataFinal = hoje;
                    break;
                case 'semestre':
                    dataInicial = new Date(hoje.getFullYear(), hoje.getMonth() - 5, 1);
                    dataFinal = hoje;
                    break;
                case 'ano':
                    dataInicial = new Date(hoje.getFullYear() - 1, hoje.getMonth(), hoje.getDate());
                    dataFinal = hoje;
                    break;
                case 'personalizado':
                    dataInicial = new Date(document.getElementById('dataInicial').value);
                    dataFinal = new Date(document.getElementById('dataFinal').value);
                    break;
            }
            
            var relatorio = gerarRelatorioDetalhado(dataInicial, dataFinal);
            document.getElementById('relatorioConteudo').innerHTML = relatorio;
        }

        function gerarRelatorioDetalhado(dataInicial, dataFinal) {
            var formatoData = dataInicial.toISOString().slice(0, 10);
            var formatoDataFinal = dataFinal.toISOString().slice(0, 10);
            
            // Filtrar dados por per√≠odo
            var receitasPeriodo = dados.receitas.filter(r => r.data >= formatoData && r.data <= formatoDataFinal);
            var despesasPeriodo = dados.despesas.filter(d => d.data >= formatoData && d.data <= formatoDataFinal);
            var cirurgiasPeriodo = dados.cirurgias.filter(c => c.data >= formatoData && c.data <= formatoDataFinal && c.status === 'realizada');
            
            var totalReceitas = receitasPeriodo.reduce((total, r) => total + parseFloat(r.valor), 0);
            var totalDespesas = despesasPeriodo.reduce((total, d) => total + parseFloat(d.valor), 0);
            var faturamentoBrutoCirurgias = cirurgiasPeriodo.reduce((total, c) => total + parseFloat(c.valorBruto), 0);
            var faturamentoLiquidoCirurgias = cirurgiasPeriodo.reduce((total, c) => total + parseFloat(c.valorLiquido), 0);
            var resultado = totalReceitas - totalDespesas;
            
            var html = '<h4>Relat√≥rio Financeiro - ' + formatarData(formatoData) + ' a ' + formatarData(formatoDataFinal) + '</h4>';
            html += '<div class="valor-detalhado"><span><strong>Total de Receitas (Geral):</strong></span><span><strong>' + formatarMoeda(totalReceitas) + '</strong></span></div>';
            html += '<div class="valor-detalhado"><span><strong>Total de Despesas (Geral):</strong></span><span><strong>' + formatarMoeda(totalDespesas) + '</strong></span></div>';
            html += '<hr>';
            html += '<div class="valor-detalhado"><span><strong>Resultado L√≠quido (Receitas - Despesas):</strong></span><span style="color: ' + (resultado >= 0 ? '#28a745' : '#dc3545') + ';"><strong>' + formatarMoeda(resultado) + '</strong></span></div>';
            
            html += '<h5 style="margin-top: 20px;">Resumo de Cirurgias no Per√≠odo</h5>';
            html += '<div class="valor-detalhado"><span>N¬∫ de Cirurgias Realizadas:</span><span>' + cirurgiasPeriodo.length + '</span></div>';
            html += '<div class="valor-detalhado"><span>Faturamento Bruto (Cirurgias):</span><span>' + formatarMoeda(faturamentoBrutoCirurgias) + '</span></div>';
            html += '<div class="valor-detalhado"><span>Faturamento L√≠quido (Cirurgias):</span><span>' + formatarMoeda(faturamentoLiquidoCirurgias) + '</span></div>';
    
            html += '<h5 style="margin-top: 20px;">Resumo por Categoria:</h5>';
            
            
            // Agrupar receitas por fonte
            var receitasPorFonte = {};
            receitasPeriodo.forEach(r => {
                receitasPorFonte[r.fonte] = (receitasPorFonte[r.fonte] || 0) + parseFloat(r.valor);
            });
            
            html += '<strong>Receitas:</strong><br>';
            for(var fonte in receitasPorFonte) {
                html += '<div class="valor-detalhado"><span>' + fonte + ':</span><span>' + formatarMoeda(receitasPorFonte[fonte]) + '</span></div>';
            }
            
            // Agrupar despesas por categoria
            var despesasPorCategoria = {};
            despesasPeriodo.forEach(d => {
                despesasPorCategoria[d.categoria] = (despesasPorCategoria[d.categoria] || 0) + parseFloat(d.valor);
            });
            
            html += '<br><strong>Despesas:</strong><br>';
            for(var categoria in despesasPorCategoria) {
                html += '<div class="valor-detalhado"><span>' + categoria + ':</span><span>' + formatarMoeda(despesasPorCategoria[categoria]) + '</span></div>';
            }
            
            return html;
        }

        function exportarDados(tipo) {
            if (!usuarioLogado) return;
            alert('Funcionalidade de exporta√ß√£o em desenvolvimento. Dados de ' + tipo + ' seriam exportados aqui.');
        }

        // Fun√ß√£o para mostrar/ocultar per√≠odo personalizado
        document.addEventListener('change', function(e) {
            if (e.target.id === 'periodoRelatorio') {
                var personalizado = document.getElementById('periodoPersonalizado');
                if (e.target.value === 'personalizado') {
                    personalizado.style.display = 'block';
                } else {
                    personalizado.style.display = 'none';
                }
            }
        });

        function limparTodosDados() {
            if (!usuarioLogado) return;
            
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° excluir todos os dados salvos permanentemente!\n\nDeseja continuar?')) {
                if (confirm('üö® √öLTIMA CONFIRMA√á√ÉO: Todos os dados ser√£o perdidos. Tem certeza absoluta?')) {
                    dados = {
                        receitas: [],
                        despesas: [],
                        cirurgias: [],
                        funcionarios: [],
                        gastosFixos: [],
                        parcelas: [],
                        insumos: [],
                        saldoAtual: 0
                    };
                    
                    // Limpar dados salvos
                    localStorage.removeItem('sistemaFinanceiro_dados');
                    localStorage.removeItem('sistemaFinanceiro_ultimoSalvamento');
                    
                    atualizarTodasAsVisualizacoes();
                    atualizarStatusSalvamento();
                    mostrarNotificacao('üóëÔ∏è Todos os dados foram limpos!', 'warning');
                }
            }
        }

        function excluirReceita(id) {
            if (!usuarioLogado) return;
            
            const receita = dados.receitas.find(r => r.id === id);
            if (receita && receita.descricao.includes('L√≠quido da Cirurgia')) {
                alert('Esta receita foi gerada por uma cirurgia. Para remov√™-la, por favor, exclua a cirurgia correspondente na aba "Cirurgias".');
                return;
            }

            if (confirm('Tem certeza que deseja excluir esta receita?')) {
                dados.receitas = dados.receitas.filter(function(receita) {
                    return receita.id !== id;
                });
                atualizarTodasAsVisualizacoes();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üóëÔ∏è Receita exclu√≠da com sucesso!', 'warning');
            }
        }

        function excluirDespesa(id) {
            if (!usuarioLogado) return;
            
            if (confirm('Tem certeza que deseja excluir esta despesa?')) {
                dados.despesas = dados.despesas.filter(function(despesa) {
                    return despesa.id !== id;
                });
                atualizarTodasAsVisualizacoes();
                
                // Salvamento autom√°tico
                salvarAutomatico();
                mostrarNotificacao('üóëÔ∏è Despesa exclu√≠da com sucesso!', 'warning');
            }
        }

        // === EVENT LISTENERS ===
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            realizarLogin();
        });

        // Form de receitas
        document.getElementById('formReceita').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!usuarioLogado) return;
            
            var formData = new FormData(e.target);
            
            var receita = {
                id: Date.now(),
                fonte: formData.get('fonte'),
                descricao: formData.get('descricao'),
                valor: parseFloat(formData.get('valor')),
                data: formData.get('data')
            };

            dados.receitas.push(receita);
            
            e.target.reset();
            e.target.querySelector('input[type="date"]').value = new Date().toISOString().slice(0, 10);
            atualizarTodasAsVisualizacoes();
            
            // Salvamento autom√°tico
            salvarAutomatico();
            mostrarNotificacao('üí∞ Receita adicionada com sucesso!', 'success');
        });

        // Form de despesas
        document.getElementById('formDespesa').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!usuarioLogado) return;
            
            var formData = new FormData(e.target);
            
            var despesa = {
                id: Date.now(),
                categoria: formData.get('categoria'),
                descricao: formData.get('descricao'),
                valor: parseFloat(formData.get('valor')),
                data: formData.get('data')
            };

            dados.despesas.push(despesa);
            
            e.target.reset();
            e.target.querySelector('input[type="date"]').value = new Date().toISOString().slice(0, 10);
            atualizarTodasAsVisualizacoes();
            
            // Salvamento autom√°tico
            salvarAutomatico();
            mostrarNotificacao('üí∏ Despesa adicionada com sucesso!', 'success');
        });

        // Form de cirurgias
        document.getElementById('formCirurgia').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!usuarioLogado) return;
            
            var formData = new FormData(e.target);
            
            var dadosBasicos = {
                id: Date.now(),
                tipo: formData.get('tipo'),
                paciente: formData.get('paciente'),
                medico: formData.get('medico'),
                valorBruto: parseFloat(formData.get('valorBruto')),
                formaPagamento: formData.get('formaPagamento'),
                taxaCartao: parseFloat(formData.get('taxaCartao')) || 0,
                comissaoOrientadora: parseFloat(formData.get('comissaoOrientadora')) || 3,
                comissaoMedico: parseFloat(formData.get('comissaoMedico')) || 0,
                valorInstrumentadora: parseFloat(formData.get('valorInstrumentadora')) || 0,
                outrosCustos: parseFloat(formData.get('outrosCustos')) || 0,
                data: formData.get('data'),
                status: formData.get('status'),
                observacoes: formData.get('observacoes')
            };
            
            // Processar cirurgia com c√°lculos autom√°ticos
            var cirurgia = processarCirurgia(dadosBasicos);
            dados.cirurgias.push(cirurgia);

            // ================================================================
            // === NOVO C√ìDIGO ADICIONADO AQUI ===
            // Se a cirurgia foi realizada, adiciona o valor l√≠quido como receita
            if (cirurgia.status === 'realizada' && cirurgia.valorLiquido > 0) {
                const receitaCirurgia = {
                    id: Date.now() + 1, // id ligeiramente diferente para evitar colis√£o
                    fonte: 'cirurgias',
                    descricao: `L√≠quido da Cirurgia: ${cirurgia.paciente} (${cirurgia.tipo})`,
                    valor: cirurgia.valorLiquido,
                    data: cirurgia.data
                };
                dados.receitas.push(receitaCirurgia);
                mostrarNotificacao('‚úÖ Receita da cirurgia lan√ßada automaticamente!', 'success');
            }
            // ================================================================
            
            e.target.reset();
            e.target.querySelector('input[type="date"]').value = new Date().toISOString().slice(0, 10);
            
            // Restaurar valores padr√£o
            document.getElementById('comissaoOrientadora').value = '3.0';
            document.getElementById('valorInstrumentadora').value = '0,00';
            
            // Limpar insumos
            document.getElementById('insumosUtilizados').innerHTML = `
                <div class="insumo-item" style="display: flex; gap: 10px; margin: 10px 0; align-items: center;">
                    <select class="insumo-select" style="flex: 2;">
                        <option value="">Selecione um insumo...</option>
                    </select>
                    <input type="number" class="quantidade-insumo" placeholder="Qtd" style="width: 80px;" min="1">
                    <span class="preco-insumo" style="width: 100px; font-weight: bold;"></span>
                    <button type="button" class="btn-remover-insumo" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-none: 3px;">Remover</button>
                </div>
            `;
            
            // Reconfigurar eventos
            configurarEventosInsumo(document.querySelector('.insumo-item'));
            carregarInsumosNoSelect();
            
            // Resetar c√°lculos
            calcularResumoFinanceiro();
            
            atualizarTodasAsVisualizacoes();
            
            // Salvamento autom√°tico
            salvarAutomatico();
            mostrarNotificacao('üè• Cirurgia registrada com sucesso!', 'success');
        });

        // Form de funcion√°rios
        document.getElementById('formFuncionario').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!usuarioLogado) return;
            
            var formData = new FormData(e.target);
            var tipoPagamento = formData.get('tipoPagamento');
            
            var funcionario = {
                id: Date.now(),
                nome: formData.get('nome'),
                cargo: formData.get('cargo'),
                tipoPagamento: tipoPagamento,
                dataAdmissao: formData.get('dataAdmissao'),
                status: formData.get('status')
            };
            
            if (tipoPagamento === 'mensal') {
                funcionario.salario = parseFloat(formData.get('salario')) || 0;
            } else {
                funcionario.valorDiario = parseFloat(formData.get('valorDiario')) || 0;
            }

            dados.funcionarios.push(funcionario);
            
            e.target.reset();
            e.target.querySelector('input[type="date"]').value = new Date().toISOString().slice(0, 10);
            
            // Resetar campos de pagamento
            document.getElementById('salarioMensalGroup').style.display = 'block';
            document.getElementById('valorDiarioGroup').style.display = 'none';
            
            atualizarListaFuncionarios();
            atualizarResumoFuncionarios();
            
            // Recalcular custos de cirurgias se houver funcion√°rios por dia
            calcularResumoFinanceiro();
            
            // Salvamento autom√°tico
            salvarAutomatico();
            mostrarNotificacao('üë§ Funcion√°rio registrado com sucesso!', 'success');
        });

        // Form de gastos fixos
        document.getElementById('formGastoFixo').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!usuarioLogado) return;
            
            var formData = new FormData(e.target);
            
            var gastoFixo = {
                id: Date.now(),
                descricao: formData.get('descricao'),
                categoria: formData.get('categoria'),
                valor: parseFloat(formData.get('valor')),
                diaVencimento: parseInt(formData.get('diaVencimento'))
            };

            dados.gastosFixos.push(gastoFixo);
            
            e.target.reset();
            atualizarListaGastosFixos();
            atualizarResumoGastosFixos();
            
            // Salvamento autom√°tico
            salvarAutomatico();
            mostrarNotificacao('üìã Gasto fixo adicionado com sucesso!', 'success');
        });

        // Form de parcelas
        document.getElementById('formParcela').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!usuarioLogado) return;
            
            var formData = new FormData(e.target);
            
            var parcela = {
                id: Date.now(),
                tipo: formData.get('tipo'),
                descricao: formData.get('descricao'),
                valor: parseFloat(formData.get('valor')),
                numeroParcelas: parseInt(formData.get('numeroParcelas')), // Captura o novo campo
                dataVencimento: formData.get('dataVencimento'),
                status: formData.get('status')
            };

            dados.parcelas.push(parcela);
            
            e.target.reset();
            e.target.querySelector('input[type="date"]').value = new Date().toISOString().slice(0, 10);
            atualizarListaParcelas();
            atualizarResumoParcelas();
            
            // Salvamento autom√°tico
            salvarAutomatico();
            mostrarNotificacao('üìù Parcela registrada com sucesso!', 'success');
        });

        // Form de insumos
        document.getElementById('formInsumo').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!usuarioLogado) return;
            
            var formData = new FormData(e.target);
            
            var insumo = {
                id: Date.now(),
                nome: formData.get('nome'),
                categoria: formData.get('categoria'),
                quantidade: parseInt(formData.get('quantidade')),
                unidade: formData.get('unidade'),
                preco: parseFloat(formData.get('preco')),
                estoqueMinimo: parseInt(formData.get('estoqueMinimo')),
                codigoBarras: formData.get('codigoBarras')
            };

            dados.insumos.push(insumo);
            
            e.target.reset();
            atualizarListaInsumos();
            atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
            
            // Salvamento autom√°tico
            salvarAutomatico();
            mostrarNotificacao('üì¶ Insumo adicionado com sucesso!', 'success');
        });

        // Atalhos de teclado
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('telaLogin').classList.contains('hidden')) {
                e.preventDefault();
                realizarLogin();
            }
        });

        // === INICIALIZA√á√ÉO ===
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data padr√£o nos campos
            var hoje = new Date().toISOString().slice(0, 10);
            var camposData = document.querySelectorAll('input[type="date"]');
            for (var i = 0; i < camposData.length; i++) {
                if (camposData[i].value === '') {
                    camposData[i].value = hoje;
                }
            }
            
            // Configurar eventos para cirurgias
            configurarEventosCirurgia();
            
            // Configurar eventos para funcion√°rios
            configurarEventosFuncionarios();
            
            // Tentar carregar dados salvos na inicializa√ß√£o
            carregarDados();
            
            // Inicializar na tela de login
            mostrarLogin();
            
            // Atualizar status de salvamento
            atualizarStatusSalvamento();
        });

            function editarCirurgia(id) {
    var cirurgia = dados.cirurgias.find(c => c.id === id);
    if (!cirurgia) return;
    
    // Preencher formul√°rio com dados existentes
    document.querySelector('input[name="tipo"]').value = cirurgia.tipo;
    document.querySelector('input[name="paciente"]').value = cirurgia.paciente;
    document.querySelector('input[name="valorBruto"]').value = cirurgia.valorBruto;
    document.querySelector('select[name="formaPagamento"]').value = cirurgia.formaPagamento;
    document.querySelector('input[name="taxaCartao"]').value = cirurgia.taxaCartao || '';
    document.querySelector('input[name="data"]').value = cirurgia.data;
    document.querySelector('select[name="status"]').value = cirurgia.status;
    document.querySelector('textarea[name="observacoes"]').value = cirurgia.observacoes || '';
    
    // Custos operacionais
    document.getElementById('comissaoOrientadora').value = cirurgia.comissaoOrientadora || 3.0;
    document.getElementById('valorInstrumentadora').value = cirurgia.valorInstrumentadora || 200.00;
    document.getElementById('outrosCustos').value = cirurgia.outrosCustos || 0;
    
    // Limpar e preencher insumos
    document.getElementById('insumosUtilizados').innerHTML = '';
    
    if (cirurgia.insumosUtilizados && cirurgia.insumosUtilizados.length > 0) {
        cirurgia.insumosUtilizados.forEach(function(insumo) {
            adicionarLinhaInsumoEditavel(insumo);
        });
    } else {
        adicionarLinhaInsumo();
    }
    
    // Mostrar/ocultar taxa de cart√£o
    var taxaGroup = document.getElementById('taxaCartaoGroup');
    if (cirurgia.formaPagamento.includes('cartao')) {
        taxaGroup.style.display = 'block';
    } else {
        taxaGroup.style.display = 'none';
    }
    
    // Atualizar c√°lculos
    calcularResumoFinanceiro();
    
    // Rolar para o topo do formul√°rio
    document.getElementById('formCirurgia').scrollIntoView({ behavior: 'smooth' });
    
    // Alterar bot√£o para modo edi√ß√£o
    var submitBtn = document.querySelector('#formCirurgia button[type="submit"]');
    submitBtn.textContent = 'Atualizar Cirurgia';
    submitBtn.onclick = function(e) {
        e.preventDefault();
        atualizarCirurgia(id);
    };
    
    // Adicionar bot√£o cancelar edi√ß√£o
    adicionarBotaoCancelarEdicao();
    
    mostrarNotificacao('‚úèÔ∏è Editando cirurgia de ' + cirurgia.paciente, 'info');
}

function adicionarLinhaInsumoEditavel(insumoUtilizado) {
    var container = document.getElementById('insumosUtilizados');
    var novaLinha = document.createElement('div');
    novaLinha.className = 'insumo-item';
    novaLinha.style.cssText = 'display: flex; gap: 10px; margin: 10px 0; align-items: center;';
    
    novaLinha.innerHTML = `
        <input type="text" class="codigo-barras-insumo" placeholder="Escaneie o c√≥digo" style="flex: 2;" value="${insumoUtilizado.codigoBarras || ''}">
        <select class="insumo-select" style="flex: 2;">
            <option value="">Selecione um insumo...</option>
        </select>
        <input type="number" class="quantidade-insumo" placeholder="Qtd" style="width: 80px;" min="1" value="${insumoUtilizado.quantidade || 1}">
        <span class="preco-insumo" style="width: 100px; font-weight: bold;">${formatarMoeda(insumoUtilizado.total || 0)}</span>
        <button type="button" class="btn-remover-insumo" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; flex-shrink: 0; margin-left: 5px;">Remover</button>
    `;
    
    container.appendChild(novaLinha);
    carregarInsumosNoSelect();
    
    // Selecionar o insumo correto
    setTimeout(function() {
        var select = novaLinha.querySelector('.insumo-select');
        select.value = insumoUtilizado.id;
        select.dispatchEvent(new Event('change'));
    }, 100);
    
    configurarEventosInsumo(novaLinha);
}

function atualizarCirurgia(id) {
    if (!usuarioLogado) return;
    
    var formData = new FormData(document.getElementById('formCirurgia'));
    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    
    if (cirurgiaIndex === -1) return;
    
    var dadosBasicos = {
        id: id, // Mant√©m o mesmo ID
        tipo: formData.get('tipo'),
        paciente: formData.get('paciente'),
                medico: formData.get('medico'),
        valorBruto: parseFloat(formData.get('valorBruto')),
        formaPagamento: formData.get('formaPagamento'),
        taxaCartao: parseFloat(formData.get('taxaCartao')) || 0,
        comissaoOrientadora: parseFloat(formData.get('comissaoOrientadora')) || 3,
                comissaoMedico: parseFloat(formData.get('comissaoMedico')) || 0,
        valorInstrumentadora: parseFloat(formData.get('valorInstrumentadora')) || 200,
        outrosCustos: parseFloat(formData.get('outrosCustos')) || 0,
        data: formData.get('data'),
        status: formData.get('status'),
        observacoes: formData.get('observacoes')
    };
    
    // Processar cirurgia com c√°lculos atualizados
    var cirurgiaAtualizada = processarCirurgia(dadosBasicos);
    
    // Atualizar a cirurgia no array
    dados.cirurgias[cirurgiaIndex] = cirurgiaAtualizada;
    
    // Atualizar receita correspondente se necess√°rio
    atualizarReceitaCirurgia(cirurgiaAtualizada);
    
    // Restaurar formul√°rio para modo normal
    cancelarEdicao();
    
    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('‚úÖ Cirurgia atualizada com sucesso!', 'success');
}

function atualizarReceitaCirurgia(cirurgia) {
    if (cirurgia.status === 'realizada' && cirurgia.valorLiquido > 0) {
        const descricaoReceita = `L√≠quido da Cirurgia: ${cirurgia.paciente} (${cirurgia.tipo})`;
        
        // Remove receita antiga se existir
        dados.receitas = dados.receitas.filter(r => !r.descricao.includes(`L√≠quido da Cirurgia: ${cirurgia.paciente}`));
        
        // Adiciona nova receita
        const novaReceita = {
            id: Date.now(),
            fonte: 'cirurgias',
            descricao: descricaoReceita,
            valor: cirurgia.valorLiquido,
            data: cirurgia.data
        };
        dados.receitas.push(novaReceita);
    }
}

function adicionarBotaoCancelarEdicao() {
    // Remove bot√£o existente se houver
    var botaoExistente = document.getElementById('cancelarEdicao');
    if (botaoExistente) botaoExistente.remove();
    
    var botaoCancelar = document.createElement('button');
    botaoCancelar.id = 'cancelarEdicao';
    botaoCancelar.type = 'button';
    botaoCancelar.textContent = '‚ùå Cancelar Edi√ß√£o';
    botaoCancelar.style.cssText = 'background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px;';
    botaoCancelar.onclick = cancelarEdicao;
    
    document.getElementById('formCirurgia').appendChild(botaoCancelar);
}

function cancelarEdicao() {
    // Restaurar formul√°rio
    document.getElementById('formCirurgia').reset();
    document.querySelector('input[type="date"]').value = new Date().toISOString().slice(0, 10);
    
    // Restaurar bot√£o original
    var submitBtn = document.querySelector('#formCirurgia button[type="submit"]');
    submitBtn.textContent = 'Registrar Cirurgia';
    submitBtn.onclick = null;
    
    // Remover bot√£o cancelar
    var botaoCancelar = document.getElementById('cancelarEdicao');
    if (botaoCancelar) botaoCancelar.remove();
    
    // Limpar insumos
    document.getElementById('insumosUtilizados').innerHTML = `
        <div class="insumo-item" style="display: flex; gap: 10px; margin: 10px 0; align-items: center;">
            <select class="insumo-select" style="flex: 2;">
                <option value="">Selecione um insumo...</option>
            </select>
            <input type="number" class="quantidade-insumo" placeholder="Qtd" style="width: 80px;" min="1">
            <span class="preco-insumo" style="width: 100px; font-weight: bold;"></span>
            <button type="button" class="btn-remover-insumo" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px;">Remover</button>
        </div>
    `;
    
    // Restaurar valores padr√£o
    document.getElementById('comissaoOrientadora').value = '3.0';
    document.getElementById('valorInstrumentadora').value = '200.00';
    document.getElementById('taxaCartaoGroup').style.display = 'none';
    
    carregarInsumosNoSelect();
    configurarEventosInsumo(document.querySelector('.insumo-item'));
    calcularResumoFinanceiro();
}
               function atualizarListaCirurgias() {
    var container = document.getElementById('listaCirurgias');
    if (dados.cirurgias.length === 0) {
        container.innerHTML = '<div class="transaction-item"><div class="transaction-info"><div>Nenhuma cirurgia registrada ainda</div></div></div>';
    } else {
        var html = '';
        dados.cirurgias.forEach(function(cirurgia) {
            var statusClass = cirurgia.status === 'realizada' ? 'status-pago' : 
                            cirurgia.status === 'agendada' ? 'status-pendente' : 'status-cancelada';
            var margemClass = cirurgia.margem >= 50 ? 'margem-alta' : 
                            cirurgia.margem >= 30 ? 'margem-media' : 'margem-baixa';
            
            html += '<div class="transaction-item">';
            html += '<div class="transaction-info">';
            html += '<div><strong>' + cirurgia.paciente + '</strong> - ' + cirurgia.tipo + '</div>';
            html += '<div class="transaction-date">' + formatarData(cirurgia.data) + ' | ' + (cirurgia.formaPagamento || 'N/A') + '</div>';
            html += '<div style="font-size: 0.85em; color: #666; margin-top: 3px;">';
            html += 'Bruto: ' + formatarMoeda(cirurgia.valorBruto || cirurgia.valor || 0) + ' | ';
            html += 'Custos: ' + formatarMoeda(cirurgia.totalCustos || 0) + ' | ';
            html += 'L√≠quido: ' + formatarMoeda(cirurgia.valorLiquido || cirurgia.valor || 0);
            html += '</div>';
            html += '<div style="font-size: 0.85em; margin-top: 2px;">';
            html += '<span class="' + margemClass + '">Margem: ' + ((cirurgia.margem || 0).toFixed(1)) + '%</span>';
            html += '</div>';
            html += '<div style="margin-top: 5px;"><span class="' + statusClass + '">' + cirurgia.status.toUpperCase() + '</span></div>';
            html += '</div>';
            html += '<div style="text-align: right;">';
            html += '<div class="transaction-value receita">' + formatarMoeda(cirurgia.valorLiquido || cirurgia.valor || 0) + '</div>';
            html += '<button class="btn" style="font-size: 10px; padding: 3px 8px; margin: 2px;" onclick="editarCirurgia(' + cirurgia.id + ')">‚úèÔ∏è Editar</button>';
            html += '<button class="btn" style="font-size: 10px; padding: 3px 8px; margin: 2px; background: #17a2b8;" onclick="verDetalhesCirurgia(' + cirurgia.id + ')">üëÅÔ∏è Detalhes</button>';
            html += '</div>';
            html += '<button class="delete-btn" onclick="excluirCirurgia(' + cirurgia.id + ')">Excluir</button>';
            html += '</div>';
        });
        container.innerHTML = html;
    }
}
             function configurarEventosCirurgia() {
            // Event listeners para c√°lculo autom√°tico
            document.getElementById('valorBrutoCirurgia').addEventListener('input', calcularResumoFinanceiro);
            document.getElementById('comissaoOrientadora').addEventListener('input', calcularResumoFinanceiro);
            document.getElementById('valorInstrumentadora').addEventListener('input', calcularResumoFinanceiro);
            document.getElementById('outrosCustos').addEventListener('input', calcularResumoFinanceiro);
            document.getElementById('taxaCartaoCirurgia').addEventListener('input', calcularResumoFinanceiro);
            
            document.getElementById('formaPagamentoCirurgia').addEventListener('change', function() {
                var taxaGroup = document.getElementById('taxaCartaoGroup');
                var taxaInput = document.getElementById('taxaCartaoCirurgia');
                
                if (this.value.includes('cartao')) {
                    taxaGroup.style.display = 'block';
                    // Definir taxa padr√£o baseada no tipo de cart√£o
                    if (this.value === 'cartao-debito') {
                        taxaInput.value = '1.5';
                    } else if (this.value === 'cartao-credito-vista') {
                        taxaInput.value = '3.5';
                    } else if (this.value === 'cartao-credito-parcelado') {
                        taxaInput.value = '5.5';
                    }
                } else {
                    taxaGroup.style.display = 'none';
                    taxaInput.value = '';
                }
                calcularResumoFinanceiro();
            });
            
            // Configurar bot√£o adicionar insumo
            document.getElementById('adicionarInsumo').addEventListener('click', adicionarLinhaInsumo);
            
            // Configurar eventos da primeira linha de insumo
            configurarEventosInsumo(document.querySelector('.insumo-item'));
        }

        function configurarEventosFuncionarios() {
            // Event listener para tipo de pagamento
            document.getElementById('tipoPagamentoFuncionario').addEventListener('change', function() {
                var salarioGroup = document.getElementById('salarioMensalGroup');
                var diarioGroup = document.getElementById('valorDiarioGroup');
                var salarioInput = document.getElementById('salarioMensal');
                var diarioInput = document.getElementById('valorDiario');
                
                if (this.value === 'mensal') {
                    salarioGroup.style.display = 'block';
                    diarioGroup.style.display = 'none';
                    salarioInput.required = true;
                    diarioInput.required = false;
                } else if (this.value === 'diario') {
                    salarioGroup.style.display = 'none';
                    diarioGroup.style.display = 'block';
                    salarioInput.required = false;
                    diarioInput.required = true;
                } else {
                    salarioGroup.style.display = 'block';
                    diarioGroup.style.display = 'none';
                    salarioInput.required = false;
                    diarioInput.required = false;
                }
            });
        }
    
    // === Busca por C√≥digo de Barras (escaneamento) ===
    function buscarInsumoPorCodigo(codigo) {
        const display = document.getElementById('resultadoBusca');
        if (!codigo) {
            display.innerHTML = '';
            return;
        }
        const insumo = dados.insumos.find(item => String(item.codigoBarras || '') === String(codigo));
        if (insumo) {
            display.innerHTML = `
                <p><strong>Produto:</strong> ${insumo.nome}</p>
                <p><strong>Categoria:</strong> ${insumo.categoria}</p>
                <p><strong>Quantidade:</strong> ${insumo.quantidade} ${insumo.unidade}</p>
                <p><strong>Pre√ßo Unit√°rio:</strong> ${formatarMoeda(parseFloat(insumo.preco || 0))}</p>
                <p><strong>C√≥digo:</strong> ${insumo.codigoBarras || ''}</p>
            `;
        } else {
            display.innerHTML = "<p style='color:red'>Produto n√£o encontrado</p>";
        }
    }

    (function() {
        var buscarInput = document.getElementById('buscarCodigoBarras');
        if (!buscarInput) return;
        buscarInput.addEventListener('input', function(e) {
            buscarInsumoPorCodigo(e.target.value.trim());
        });
        buscarInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscarInsumoPorCodigo(e.target.value.trim());
            }
        });
    })();


// === Fun√ß√£o para editar cirurgia ===
function editarCirurgia(id) {
    var cirurgia = dados.cirurgias.find(c => c.id === id);
    if (!cirurgia) return;

    // Preencher formul√°rio com os dados da cirurgia selecionada
    document.querySelector('#formCirurgia select[name="tipo"]').value = cirurgia.tipo;
    document.querySelector('#formCirurgia input[name="paciente"]').value = cirurgia.paciente;
    document.querySelector('#formCirurgia input[name="valorBruto"]').value = cirurgia.valorBruto;
    document.querySelector('#formCirurgia select[name="formaPagamento"]').value = cirurgia.formaPagamento;
    document.querySelector('#formCirurgia input[name="taxaCartao"]').value = cirurgia.taxaCartao;
    document.querySelector('#formCirurgia input[name="comissaoOrientadora"]').value = cirurgia.comissaoOrientadora;
    document.querySelector('#formCirurgia input[name="valorInstrumentadora"]').value = cirurgia.valorInstrumentadora;
    document.querySelector('#formCirurgia input[name="outrosCustos"]').value = cirurgia.outrosCustos;
    document.querySelector('#formCirurgia input[name="data"]').value = cirurgia.data;
    document.querySelector('#formCirurgia select[name="status"]').value = cirurgia.status;
    document.querySelector('#formCirurgia textarea[name="observacoes"]').value = cirurgia.observacoes;

    // Alterar bot√£o principal para modo edi√ß√£o
    var submitBtn = document.querySelector('#formCirurgia button[type="submit"]');
    submitBtn.textContent = 'üíæ Salvar Altera√ß√µes';
    submitBtn.onclick = function(e) {
        e.preventDefault();
        atualizarCirurgia(id);
    };

    adicionarBotaoCancelarEdicao();
}


// === Fun√ß√£o para atualizar cirurgia ===
function atualizarCirurgia(id) {
    var formData = new FormData(document.getElementById('formCirurgia'));
    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var cirurgiaAntiga = dados.cirurgias[cirurgiaIndex];

    // 1. Devolver insumos antigos ao estoque
    if (cirurgiaAntiga.insumos && cirurgiaAntiga.insumos.length > 0) {
        cirurgiaAntiga.insumos.forEach(item => {
            var insumoEstoque = dados.insumos.find(i => i.codigoBarras === item.codigoBarras);
            if (insumoEstoque) {
                insumoEstoque.quantidade += item.quantidade; // devolve ao estoque
            }
        });
    }

    // 2. Montar dados novos
    var dadosBasicos = {
        id: id,
        tipo: formData.get('tipo'),
        paciente: formData.get('paciente'),
                medico: formData.get('medico'),
        valorBruto: parseFloat(formData.get('valorBruto')),
        formaPagamento: formData.get('formaPagamento'),
        taxaCartao: parseFloat(formData.get('taxaCartao')) || 0,
        comissaoOrientadora: parseFloat(formData.get('comissaoOrientadora')) || 3,
                comissaoMedico: parseFloat(formData.get('comissaoMedico')) || 0,
        valorInstrumentadora: parseFloat(formData.get('valorInstrumentadora')) || 0,
        outrosCustos: parseFloat(formData.get('outrosCustos')) || 0,
        data: formData.get('data'),
        status: formData.get('status'),
        observacoes: formData.get('observacoes'),
        insumos: []
    };

    // 3. Ler insumos atuais do formul√°rio e descontar do estoque
    document.querySelectorAll('#insumosUtilizados .insumo-item').forEach(div => {
        var codigo = div.querySelector('.codigo-barras-insumo').value;
        var qtd = parseInt(div.querySelector('.quantidade-insumo').value) || 0;
        if (codigo && qtd > 0) {
            dadosBasicos.insumos.push({ codigoBarras: codigo, quantidade: qtd });
            var insumoEstoque = dados.insumos.find(i => i.codigoBarras === codigo);
            if (insumoEstoque) {
                insumoEstoque.quantidade -= qtd;
            }
        }
    });

    // 4. Reprocessar cirurgia
    var cirurgiaAtualizada = processarCirurgia(dadosBasicos);
    dados.cirurgias[cirurgiaIndex] = cirurgiaAtualizada;

    atualizarReceitaCirurgia(cirurgiaAtualizada);
    cancelarEdicao();
    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('‚úÖ Cirurgia atualizada com sucesso!', 'success');
}

// === Fun√ß√£o para cancelar edi√ß√£o ===
function cancelarEdicao() {
    var form = document.getElementById('formCirurgia');
    form.reset();

    var submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Registrar Cirurgia';
    submitBtn.onclick = null;

    var cancelarBtn = document.getElementById('cancelarEdicaoBtn');
    if (cancelarBtn) cancelarBtn.remove();
}

// === Adiciona bot√£o cancelar ===
function adicionarBotaoCancelarEdicao() {
    if (document.getElementById('cancelarEdicaoBtn')) return;
    var form = document.getElementById('formCirurgia');
    var cancelarBtn = document.createElement('button');
    cancelarBtn.id = 'cancelarEdicaoBtn';
    cancelarBtn.type = 'button';
    cancelarBtn.textContent = '‚ùå Cancelar';
    cancelarBtn.className = 'btn';
    cancelarBtn.style.background = '#dc3545';
    cancelarBtn.onclick = cancelarEdicao;
    form.appendChild(cancelarBtn);
}


// === Fun√ß√£o para excluir cirurgia ===
function excluirCirurgia(id) {
    if (!confirm('Tem certeza que deseja excluir esta cirurgia?')) return;

    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var cirurgiaRemovida = dados.cirurgias[cirurgiaIndex];

    // 1. Devolver insumos ao estoque
    if (cirurgiaRemovida.insumos && cirurgiaRemovida.insumos.length > 0) {
        cirurgiaRemovida.insumos.forEach(item => {
            var insumoEstoque = dados.insumos.find(i => i.codigoBarras === item.codigoBarras);
            if (insumoEstoque) {
                insumoEstoque.quantidade += item.quantidade;
            }
        });
    }

    // 2. Remover cirurgia da lista
    dados.cirurgias.splice(cirurgiaIndex, 1);

    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('üóëÔ∏è Cirurgia exclu√≠da com sucesso!', 'success');
}


    // === Tabela: Produ√ß√£o por M√©dico (respeita per√≠odo do Dashboard) ===
    function atualizarTabelaMedicosMes(){
        try {
            const corpo = document.querySelector('#tabelaMedicosMes tbody');
            if (!corpo) return;
            corpo.innerHTML = '';
            const range = (typeof getRangeDoFiltro==='function') ? getRangeDoFiltro() : null;
            const inicio = range ? range.inicio : '0000-01-01';
            const fim    = range ? range.fim    : '9999-12-31';

            const mapa = {};
            (dados.cirurgias || []).forEach(c => {
                if (!c || !c.data || c.status !== 'realizada') return;
                if (c.data >= inicio && c.data <= fim) {
                    const medico = (c.medico && String(c.medico).trim()) ? c.medico : 'N√£o informado';
                    if (!mapa[medico]) {
                        mapa[medico] = { cirurgias:0, insumos:0, comissao:0 };
                    }
                    mapa[medico].cirurgias += 1;
                    // custo de insumos
                    const custoInsumos = parseFloat(c.custoInsumos || c.totalInsumos || 0) || 0;
                    mapa[medico].insumos += custoInsumos;
                    // comiss√£o do m√©dico (se salvo) ou calcula na hora a partir do %
                    const valorBruto = parseFloat(c.valorBruto || 0) || 0;
                    const comPerc = (c.comissaoMedicoPerc != null) ? parseFloat(c.comissaoMedicoPerc) : parseFloat(c.comissaoMedico || 0);
                    const comVal = (c.comissaoMedicoValor != null) ? parseFloat(c.comissaoMedicoValor) : (valorBruto * ((parseFloat(comPerc)||0)/100));
                    mapa[medico].comissao += (isNaN(comVal) ? 0 : comVal);
                }
            });

            const medicos = Object.keys(mapa);
            if (!medicos.length){
                corpo.innerHTML = '<tr><td colspan="4">Sem cirurgias no per√≠odo selecionado</td></tr>';
                return;
            }
            medicos.sort((a,b)=> mapa[b].cirurgias - mapa[a].cirurgias || a.localeCompare(b));
            medicos.forEach(nome => {
                const tr = document.createElement('tr');
                const tdM = document.createElement('td'); tdM.textContent = nome;
                const tdC = document.createElement('td'); tdC.textContent = mapa[nome].cirurgias;
                const tdI = document.createElement('td'); tdI.textContent = formatarMoeda(mapa[nome].insumos);
                const tdK = document.createElement('td'); tdK.textContent = formatarMoeda(mapa[nome].comissao);
                tr.appendChild(tdM); tr.appendChild(tdC); tr.appendChild(tdI); tr.appendChild(tdK);
                corpo.appendChild(tr);
            });
        } catch(e){
            console.warn('Falha ao atualizar tabela de m√©dicos:', e);
        }
    }
    

// === INSUMOS: UI organizada, filtros, ordena√ß√£o e opera√ß√µes ===
let estadoInsumos = {
  sortKey: 'nome',
  sortDir: 'asc',
  busca: '',
  categoria: '',
  status: ''
};

function comparar(a, b, key){
  const va = (a[key] ?? '').toString().toLowerCase();
  const vb = (b[key] ?? '').toString().toLowerCase();
  if (!isNaN(parseFloat(a[key])) && !isNaN(parseFloat(b[key]))){
    return (parseFloat(a[key]) - parseFloat(b[key]));
  }
  return va.localeCompare(vb, 'pt-BR');
}

function aplicarFiltrosInsumos(lista){
  let arr = [...lista];
  const {busca, categoria, status} = estadoInsumos;
  if (busca){
    const q = busca.toLowerCase();
    arr = arr.filter(i => (i.nome||'').toLowerCase().includes(q) || (i.codigoBarras||'').toLowerCase().includes(q));
  }
  if (categoria){
    arr = arr.filter(i => i.categoria === categoria);
  }
  if (status === 'baixo-estoque'){
    arr = arr.filter(i => (parseFloat(i.quantidade)||0) <= (parseFloat(i.estoqueMinimo)||0));
  }
  return arr;
}

function renderizarTabelaInsumos(){
  try{
    const tbody = document.querySelector('#tabelaInsumosOrganizada tbody');
    if (!tbody) return;
    tbody.innerHTML = '';
    if (!dados.insumos) dados.insumos = [];
    let lista = aplicarFiltrosInsumos(dados.insumos);

    // Ordena√ß√£o
    const {sortKey, sortDir} = estadoInsumos;
    lista.sort((a,b)=>{
      const r = comparar(a,b,sortKey);
      return sortDir === 'asc' ? r : -r;
    });

    if (lista.length === 0){
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 9;
      td.textContent = 'Nenhum insumo encontrado';
      tr.appendChild(td);
      tbody.appendChild(tr);
      return;
    }

    lista.forEach(ins => {
      const tr = document.createElement('tr');
      const baixo = (parseFloat(ins.quantidade)||0) <= (parseFloat(ins.estoqueMinimo)||0);
      if (baixo) tr.style.background = '#fff3cd'; // destaque baixo estoque

      tr.innerHTML = `
        <td>${ins.codigoBarras||''}</td>
        <td>${ins.nome||''}</td>
        <td>${ins.categoria||''}</td>
        <td>${ins.unidade||''}</td>
        <td>${formatarMoeda(parseFloat(ins.preco)||0)}</td>
        <td>${ins.quantidade||0}</td>
        <td>${ins.estoqueMinimo||0}</td>
        <td>${baixo ? 'Baixo' : 'OK'}</td>
        <td>
          <button class="btn" type="button" onclick="editarInsumo(${ins.id})">Editar</button>
          <button class="btn" type="button" style="background:#dc3545" onclick="excluirInsumo(${ins.id})">Excluir</button>
          <button class="btn" type="button" style="background:#28a745" onclick="registrarEntradaPrompt(${ins.id})">+Entrada</button>
          <button class="btn" type="button" style="background:#ffc107;color:#212529" onclick="registrarSaidaPrompt(${ins.id})">-Sa√≠da</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch(e){
    console.warn('Falha ao renderizar tabela de insumos', e);
  }
}

function editarInsumo(id){
  const ins = dados.insumos.find(i=>i.id===id);
  if (!ins) return;
  document.getElementById('insumoId').value = ins.id;
  document.getElementById('insumoNome').value = ins.nome||'';
  document.getElementById('insumoCategoria').value = ins.categoria||'';
  document.getElementById('insumoUnidade').value = ins.unidade||'unidade';
  document.getElementById('insumoPreco').value = ins.preco||0;
  document.getElementById('insumoQuantidade').value = ins.quantidade||0;
  document.getElementById('insumoMinimo').value = ins.estoqueMinimo||0;
  document.getElementById('insumoCodigoBarras').value = ins.codigoBarras||'';
  mostrarNotificacao('‚úèÔ∏è Editando insumo: ' + (ins.nome||''), 'info');
}

function limparFormInsumo(){
  document.getElementById('formInsumo').reset();
  document.getElementById('insumoId').value = '';
}

function excluirInsumo(id){
  if (!confirm('Excluir este insumo?')) return;
  dados.insumos = (dados.insumos||[]).filter(i=>i.id!==id);
  salvarDados();
  atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
  renderizarTabelaInsumos();
  mostrarNotificacao('üóëÔ∏è Insumo exclu√≠do', 'success');
}

function registrarEntradaPrompt(id){
  const qtd = parseFloat(prompt('Quantidade de ENTRADA:','0'))||0;
  if (qtd<=0) return;
  const preco = prompt('Atualizar pre√ßo unit√°rio? (opcional)','');
  registrarEntrada(id, qtd, preco ? parseFloat(preco) : null);
}

function registrarSaidaPrompt(id){
  const qtd = parseFloat(prompt('Quantidade de SA√çDA:','0'))||0;
  if (qtd<=0) return;
  registrarSaida(id, qtd);
}

function registrarEntrada(id, quantidade, novoPreco=null){
  const ins = dados.insumos.find(i=>i.id===id);
  if (!ins) return;
  ins.quantidade = (parseFloat(ins.quantidade)||0) + quantidade;
  if (novoPreco!==null && !Number.isNaN(novoPreco)) ins.preco = novoPreco;
  salvarDados();
  atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
  renderizarTabelaInsumos();
  mostrarNotificacao('‚úÖ Entrada registrada', 'success');
}

function registrarSaida(id, quantidade){
  const ins = dados.insumos.find(i=>i.id===id);
  if (!ins) return;
  ins.quantidade = Math.max(0, (parseFloat(ins.quantidade)||0) - quantidade);
  salvarDados();
  atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
  renderizarTabelaInsumos();
  mostrarNotificacao('‚úÖ Sa√≠da registrada', 'success');
}

function exportarInsumosCSV(){
  const cab = ['id','codigoBarras','nome','categoria','unidade','preco','quantidade','estoqueMinimo'];
  const rows = [cab.join(';')];
  (dados.insumos||[]).forEach(i=>{
    rows.push([i.id,i.codigoBarras,i.nome,i.categoria,i.unidade,i.preco,i.quantidade,i.estoqueMinimo].map(v=> (v == null ? '' : String(v))).join(';'));
  });
  const blob = new Blob([rows.join('\n')], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'insumos.csv';
  a.click();
}

function importarInsumosJSON(file){
  const reader = new FileReader();
  reader.onload = (e)=>{
    try{
      const arr = JSON.parse(e.target.result);
      if (!Array.isArray(arr)) throw new Error('JSON deve ser um array');
      const agora = Date.now();
      arr.forEach((i,idx)=>{
        if (!i.id) i.id = agora + idx;
        if (typeof i.quantidade==='undefined') i.quantidade = 0;
        if (typeof i.estoqueMinimo==='undefined') i.estoqueMinimo = 0;
      });
      dados.insumos = (dados.insumos||[]).concat(arr);
      salvarDados();
      atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
      renderizarTabelaInsumos();
      mostrarNotificacao('üì• Importa√ß√£o conclu√≠da', 'success');
    }catch(err){
      console.error(err);
      mostrarNotificacao('‚ùå JSON inv√°lido', 'error');
    }
  };
  reader.readAsText(file);
}

// Eventos de UI da aba
document.addEventListener('click', function(e){
  if (e.target && e.target.matches('#btnExportarInsumos')) exportarInsumosCSV();
  if (e.target && e.target.matches('#btnImportarInsumos')) document.getElementById('inputImportarInsumos').click();
});

document.addEventListener('change', function(e){
  if (e.target && e.target.matches('#inputImportarInsumos')){
    if (e.target.files && e.target.files[0]) importarInsumosJSON(e.target.files[0]);
  }
});

document.addEventListener('input', function(e){
  if (e.target && e.target.matches('#filtroBuscaInsumo')){
    estadoInsumos.busca = e.target.value.trim();
    renderizarTabelaInsumos();
  }
});

document.addEventListener('change', function(e){
  if (e.target && e.target.matches('#filtroCategoriaInsumo')){
    estadoInsumos.categoria = e.target.value;
    renderizarTabelaInsumos();
  }
  if (e.target && e.target.matches('#filtroStatusInsumo')){
    estadoInsumos.status = e.target.value;
    renderizarTabelaInsumos();
  }
});

// Sort por cabe√ßalho
document.addEventListener('click', function(e){
  const th = e.target.closest('#tabelaInsumosOrganizada thead th[data-sort]');
  if (!th) return;
  const key = th.getAttribute('data-sort');
  if (estadoInsumos.sortKey === key){
    estadoInsumos.sortDir = (estadoInsumos.sortDir === 'asc') ? 'desc' : 'asc';
  } else {
    estadoInsumos.sortKey = key;
    estadoInsumos.sortDir = 'asc';
  }
  renderizarTabelaInsumos();
});

// Submit do formul√°rio de insumos
document.addEventListener('submit', function(e){
  if (e.target && e.target.matches('#formInsumo')){
    e.preventDefault();
    const id = parseInt(document.getElementById('insumoId').value) || null;
    const novo = {
      id: id || Date.now(),
      nome: document.getElementById('insumoNome').value.trim(),
      categoria: document.getElementById('insumoCategoria').value,
      unidade: document.getElementById('insumoUnidade').value,
      preco: parseFloat(document.getElementById('insumoPreco').value) || 0,
      quantidade: parseFloat(document.getElementById('insumoQuantidade').value) || 0,
      estoqueMinimo: parseFloat(document.getElementById('insumoMinimo').value) || 0,
      codigoBarras: document.getElementById('insumoCodigoBarras').value.trim()
    };
    if (!dados.insumos) dados.insumos = [];
    const idx = dados.insumos.findIndex(i=>i.id===novo.id);
    if (idx>=0) dados.insumos[idx] = novo;
    else dados.insumos.push(novo);
    salvarDados();
    atualizarResumoInsumos();
            renderizarTabelaInsumos && renderizarTabelaInsumos();
    renderizarTabelaInsumos();
    limparFormInsumo();
    mostrarNotificacao('üíæ Insumo salvo', 'success');
  }
});

// Bot√£o limpar
document.addEventListener('click', function(e){
  if (e.target && e.target.matches('#btnLimparInsumo')){
    limparFormInsumo();
  }
});

// Hookar render na abertura da aba
const _abrirAba_ref = window.abrirAba;
window.abrirAba = function(aba){
  if (typeof _abrirAba_ref === 'function') _abrirAba_ref(aba);
  if (aba === 'insumos'){
    renderizarTabelaInsumos();
  }
};

// Garantir chamadas dentro das rotinas globais
const _atualizarResumoInsumos_ref = window.atualizarResumoInsumos;
window.atualizarResumoInsumos = function(){
  if (typeof _atualizarResumoInsumos_ref === 'function') _atualizarResumoInsumos_ref();
  // Tamb√©m atualiza contadores e render
  renderizarTabelaInsumos();
};


// === Shims de compatibilidade (evita erros "Cannot set properties of null") ===
if (typeof window.atualizarListaInsumos !== 'function') {
  window.atualizarListaInsumos = function(){
    try { if (typeof renderizarTabelaInsumos === 'function') renderizarTabelaInsumos(); } catch(e){ console.warn(e); }
  };
}
if (typeof window.atualizarTabelaCategoriasMes !== 'function') {
  window.atualizarTabelaCategoriasMes = function(){};
}

</script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js">
    // === Busca por C√≥digo de Barras (escaneamento) ===
    function buscarInsumoPorCodigo(codigo) {
        const display = document.getElementById('resultadoBusca');
        if (!codigo) {
            display.innerHTML = '';
            return;
        }
        const insumo = dados.insumos.find(item => String(item.codigoBarras || '') === String(codigo));
        if (insumo) {
            display.innerHTML = `
                <p><strong>Produto:</strong> ${insumo.nome}</p>
                <p><strong>Categoria:</strong> ${insumo.categoria}</p>
                <p><strong>Quantidade:</strong> ${insumo.quantidade} ${insumo.unidade}</p>
                <p><strong>Pre√ßo Unit√°rio:</strong> ${formatarMoeda(parseFloat(insumo.preco || 0))}</p>
                <p><strong>C√≥digo:</strong> ${insumo.codigoBarras || ''}</p>
            `;
        } else {
            display.innerHTML = "<p style='color:red'>Produto n√£o encontrado</p>";
        }
    }

    (function() {
        var buscarInput = document.getElementById('buscarCodigoBarras');
        if (!buscarInput) return;
        buscarInput.addEventListener('input', function(e) {
            buscarInsumoPorCodigo(e.target.value.trim());
        });
        buscarInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscarInsumoPorCodigo(e.target.value.trim());
            }
        });
    })();


// === Fun√ß√£o para editar cirurgia ===
function editarCirurgia(id) {
    var cirurgia = dados.cirurgias.find(c => c.id === id);
    if (!cirurgia) return;

    // Preencher formul√°rio com os dados da cirurgia selecionada
    document.querySelector('#formCirurgia select[name="tipo"]').value = cirurgia.tipo;
    document.querySelector('#formCirurgia input[name="paciente"]').value = cirurgia.paciente;
    document.querySelector('#formCirurgia input[name="valorBruto"]').value = cirurgia.valorBruto;
    document.querySelector('#formCirurgia select[name="formaPagamento"]').value = cirurgia.formaPagamento;
    document.querySelector('#formCirurgia input[name="taxaCartao"]').value = cirurgia.taxaCartao;
    document.querySelector('#formCirurgia input[name="comissaoOrientadora"]').value = cirurgia.comissaoOrientadora;
    document.querySelector('#formCirurgia input[name="valorInstrumentadora"]').value = cirurgia.valorInstrumentadora;
    document.querySelector('#formCirurgia input[name="outrosCustos"]').value = cirurgia.outrosCustos;
    document.querySelector('#formCirurgia input[name="data"]').value = cirurgia.data;
    document.querySelector('#formCirurgia select[name="status"]').value = cirurgia.status;
    document.querySelector('#formCirurgia textarea[name="observacoes"]').value = cirurgia.observacoes;

    // Alterar bot√£o principal para modo edi√ß√£o
    var submitBtn = document.querySelector('#formCirurgia button[type="submit"]');
    submitBtn.textContent = 'üíæ Salvar Altera√ß√µes';
    submitBtn.onclick = function(e) {
        e.preventDefault();
        atualizarCirurgia(id);
    };

    adicionarBotaoCancelarEdicao();
}

// === Fun√ß√£o para atualizar cirurgia ===
function atualizarCirurgia(id) {
    var formData = new FormData(document.getElementById('formCirurgia'));
    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var dadosBasicos = {
        id: id,
        tipo: formData.get('tipo'),
        paciente: formData.get('paciente'),
                medico: formData.get('medico'),
        valorBruto: parseFloat(formData.get('valorBruto')),
        formaPagamento: formData.get('formaPagamento'),
        taxaCartao: parseFloat(formData.get('taxaCartao')) || 0,
        comissaoOrientadora: parseFloat(formData.get('comissaoOrientadora')) || 3,
                comissaoMedico: parseFloat(formData.get('comissaoMedico')) || 0,
        valorInstrumentadora: parseFloat(formData.get('valorInstrumentadora')) || 0,
        outrosCustos: parseFloat(formData.get('outrosCustos')) || 0,
        data: formData.get('data'),
        status: formData.get('status'),
        observacoes: formData.get('observacoes')
    };

    var cirurgiaAtualizada = processarCirurgia(dadosBasicos);
    dados.cirurgias[cirurgiaIndex] = cirurgiaAtualizada;

    atualizarReceitaCirurgia(cirurgiaAtualizada);
    cancelarEdicao();
    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('‚úÖ Cirurgia atualizada com sucesso!', 'success');
}

// === Fun√ß√£o para cancelar edi√ß√£o ===
function cancelarEdicao() {
    var form = document.getElementById('formCirurgia');
    form.reset();

    var submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Registrar Cirurgia';
    submitBtn.onclick = null;

    var cancelarBtn = document.getElementById('cancelarEdicaoBtn');
    if (cancelarBtn) cancelarBtn.remove();
}

// === Adiciona bot√£o cancelar ===
function adicionarBotaoCancelarEdicao() {
    if (document.getElementById('cancelarEdicaoBtn')) return;
    var form = document.getElementById('formCirurgia');
    var cancelarBtn = document.createElement('button');
    cancelarBtn.id = 'cancelarEdicaoBtn';
    cancelarBtn.type = 'button';
    cancelarBtn.textContent = '‚ùå Cancelar';
    cancelarBtn.className = 'btn';
    cancelarBtn.style.background = '#dc3545';
    cancelarBtn.onclick = cancelarEdicao;
    form.appendChild(cancelarBtn);
}


// === Fun√ß√£o para excluir cirurgia ===
function excluirCirurgia(id) {
    if (!confirm('Tem certeza que deseja excluir esta cirurgia?')) return;

    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var cirurgiaRemovida = dados.cirurgias[cirurgiaIndex];

    // 1. Devolver insumos ao estoque
    if (cirurgiaRemovida.insumos && cirurgiaRemovida.insumos.length > 0) {
        cirurgiaRemovida.insumos.forEach(item => {
            var insumoEstoque = dados.insumos.find(i => i.codigoBarras === item.codigoBarras);
            if (insumoEstoque) {
                insumoEstoque.quantidade += item.quantidade;
            }
        });
    }

    // 2. Remover cirurgia da lista
    dados.cirurgias.splice(cirurgiaIndex, 1);

    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('üóëÔ∏è Cirurgia exclu√≠da com sucesso!', 'success');
}

</script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js">
    // === Busca por C√≥digo de Barras (escaneamento) ===
    function buscarInsumoPorCodigo(codigo) {
        const display = document.getElementById('resultadoBusca');
        if (!codigo) {
            display.innerHTML = '';
            return;
        }
        const insumo = dados.insumos.find(item => String(item.codigoBarras || '') === String(codigo));
        if (insumo) {
            display.innerHTML = `
                <p><strong>Produto:</strong> ${insumo.nome}</p>
                <p><strong>Categoria:</strong> ${insumo.categoria}</p>
                <p><strong>Quantidade:</strong> ${insumo.quantidade} ${insumo.unidade}</p>
                <p><strong>Pre√ßo Unit√°rio:</strong> ${formatarMoeda(parseFloat(insumo.preco || 0))}</p>
                <p><strong>C√≥digo:</strong> ${insumo.codigoBarras || ''}</p>
            `;
        } else {
            display.innerHTML = "<p style='color:red'>Produto n√£o encontrado</p>";
        }
    }

    (function() {
        var buscarInput = document.getElementById('buscarCodigoBarras');
        if (!buscarInput) return;
        buscarInput.addEventListener('input', function(e) {
            buscarInsumoPorCodigo(e.target.value.trim());
        });
        buscarInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscarInsumoPorCodigo(e.target.value.trim());
            }
        });
    })();


// === Fun√ß√£o para editar cirurgia ===
function editarCirurgia(id) {
    var cirurgia = dados.cirurgias.find(c => c.id === id);
    if (!cirurgia) return;

    // Preencher formul√°rio com os dados da cirurgia selecionada
    document.querySelector('#formCirurgia select[name="tipo"]').value = cirurgia.tipo;
    document.querySelector('#formCirurgia input[name="paciente"]').value = cirurgia.paciente;
    document.querySelector('#formCirurgia input[name="valorBruto"]').value = cirurgia.valorBruto;
    document.querySelector('#formCirurgia select[name="formaPagamento"]').value = cirurgia.formaPagamento;
    document.querySelector('#formCirurgia input[name="taxaCartao"]').value = cirurgia.taxaCartao;
    document.querySelector('#formCirurgia input[name="comissaoOrientadora"]').value = cirurgia.comissaoOrientadora;
    document.querySelector('#formCirurgia input[name="valorInstrumentadora"]').value = cirurgia.valorInstrumentadora;
    document.querySelector('#formCirurgia input[name="outrosCustos"]').value = cirurgia.outrosCustos;
    document.querySelector('#formCirurgia input[name="data"]').value = cirurgia.data;
    document.querySelector('#formCirurgia select[name="status"]').value = cirurgia.status;
    document.querySelector('#formCirurgia textarea[name="observacoes"]').value = cirurgia.observacoes;

    // Alterar bot√£o principal para modo edi√ß√£o
    var submitBtn = document.querySelector('#formCirurgia button[type="submit"]');
    submitBtn.textContent = 'üíæ Salvar Altera√ß√µes';
    submitBtn.onclick = function(e) {
        e.preventDefault();
        atualizarCirurgia(id);
    };

    adicionarBotaoCancelarEdicao();
}

// === Fun√ß√£o para atualizar cirurgia ===
function atualizarCirurgia(id) {
    var formData = new FormData(document.getElementById('formCirurgia'));
    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var dadosBasicos = {
        id: id,
        tipo: formData.get('tipo'),
        paciente: formData.get('paciente'),
                medico: formData.get('medico'),
        valorBruto: parseFloat(formData.get('valorBruto')),
        formaPagamento: formData.get('formaPagamento'),
        taxaCartao: parseFloat(formData.get('taxaCartao')) || 0,
        comissaoOrientadora: parseFloat(formData.get('comissaoOrientadora')) || 3,
                comissaoMedico: parseFloat(formData.get('comissaoMedico')) || 0,
        valorInstrumentadora: parseFloat(formData.get('valorInstrumentadora')) || 0,
        outrosCustos: parseFloat(formData.get('outrosCustos')) || 0,
        data: formData.get('data'),
        status: formData.get('status'),
        observacoes: formData.get('observacoes')
    };

    var cirurgiaAtualizada = processarCirurgia(dadosBasicos);
    dados.cirurgias[cirurgiaIndex] = cirurgiaAtualizada;

    atualizarReceitaCirurgia(cirurgiaAtualizada);
    cancelarEdicao();
    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('‚úÖ Cirurgia atualizada com sucesso!', 'success');
}

// === Fun√ß√£o para cancelar edi√ß√£o ===
function cancelarEdicao() {
    var form = document.getElementById('formCirurgia');
    form.reset();

    var submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Registrar Cirurgia';
    submitBtn.onclick = null;

    var cancelarBtn = document.getElementById('cancelarEdicaoBtn');
    if (cancelarBtn) cancelarBtn.remove();
}

// === Adiciona bot√£o cancelar ===
function adicionarBotaoCancelarEdicao() {
    if (document.getElementById('cancelarEdicaoBtn')) return;
    var form = document.getElementById('formCirurgia');
    var cancelarBtn = document.createElement('button');
    cancelarBtn.id = 'cancelarEdicaoBtn';
    cancelarBtn.type = 'button';
    cancelarBtn.textContent = '‚ùå Cancelar';
    cancelarBtn.className = 'btn';
    cancelarBtn.style.background = '#dc3545';
    cancelarBtn.onclick = cancelarEdicao;
    form.appendChild(cancelarBtn);
}


// === Fun√ß√£o para excluir cirurgia ===
function excluirCirurgia(id) {
    if (!confirm('Tem certeza que deseja excluir esta cirurgia?')) return;

    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var cirurgiaRemovida = dados.cirurgias[cirurgiaIndex];

    // 1. Devolver insumos ao estoque
    if (cirurgiaRemovida.insumos && cirurgiaRemovida.insumos.length > 0) {
        cirurgiaRemovida.insumos.forEach(item => {
            var insumoEstoque = dados.insumos.find(i => i.codigoBarras === item.codigoBarras);
            if (insumoEstoque) {
                insumoEstoque.quantidade += item.quantidade;
            }
        });
    }

    // 2. Remover cirurgia da lista
    dados.cirurgias.splice(cirurgiaIndex, 1);

    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('üóëÔ∏è Cirurgia exclu√≠da com sucesso!', 'success');
}

</script>

<script>
  // Configuracao Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD1ruP7W5uYL185rOUnFqHd9GUlDp4VhXs",
    authDomain: "clinica-981e8.firebaseapp.com",
    databaseURL: "https://clinica-981e8-default-rtdb.firebaseio.com",
    projectId: "clinica-981e8",
    storageBucket: "clinica-981e8.firebasestorage.app",
    messagingSenderId: "766482530366",
    appId: "1:766482530366:web:31321baff2da7a8623916f"
  };

  // Inicializar Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Sobrescreve a funcao salvarDados para incluir Firebase
  function salvarDados() {
    try {
      const dadosParaSalvar = {
        ...dados,
        dataUltimaSalvamento: new Date().toISOString(),
        versaoSistema: '1.0'
      };

      // Tenta salvar na nuvem
      database.ref('sistemaFinanceiro').set(dadosParaSalvar)
        .then(() => {
          mostrarNotificacao('üíæ Dados salvos na nuvem com sucesso!', 'success');
          localStorage.setItem('sistemaFinanceiro_ultimoSalvamento', new Date().toLocaleString('pt-BR'));
          atualizarStatusSalvamento();
        })
        .catch((error) => {
          console.error('Erro ao salvar no Firebase:', error);
          mostrarNotificacao('‚ùå Erro ao salvar na nuvem! Salvando localmente...', 'error');
          salvarDadosLocal();
        });
    } catch (error) {
      console.error('Erro inesperado ao salvar dados:', error);
      mostrarNotificacao('‚ùå Erro inesperado!', 'error');
    }
  }

  function salvarDadosLocal() {
    try {
      const dadosParaSalvar = {
        ...dados,
        dataUltimaSalvamento: new Date().toISOString(),
        versaoSistema: '1.0'
      };
      localStorage.setItem('sistemaFinanceiro_dados', JSON.stringify(dadosParaSalvar));
      localStorage.setItem('sistemaFinanceiro_ultimoSalvamento', new Date().toLocaleString('pt-BR'));
      atualizarStatusSalvamento();
    } catch (error) {
      console.error('Erro ao salvar dados localmente:', error);
    }
  }

  function carregarDados() {
    database.ref('sistemaFinanceiro').once('value')
      .then((snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          dados = {
            receitas: data.receitas || [],
            despesas: data.despesas || [],
            cirurgias: data.cirurgias || [],
            funcionarios: data.funcionarios || [],
            gastosFixos: data.gastosFixos || [],
            parcelas: data.parcelas || [],
            insumos: data.insumos || [],
            saldoAtual: data.saldoAtual || 0
          };
          mostrarNotificacao('üìÇ Dados carregados da nuvem com sucesso!', 'success');
          atualizarTodasAsVisualizacoes();
        } else {
          mostrarNotificacao('‚ö†Ô∏è Nenhum dado encontrado na nuvem. Carregando localmente...', 'warning');
          carregarDadosLocal();
        }
      })
      .catch((error) => {
        console.error('Erro ao carregar do Firebase:', error);
        mostrarNotificacao('‚ùå Erro ao carregar da nuvem! Carregando localmente...', 'error');
        carregarDadosLocal();
      });
  }

  function carregarDadosLocal() {
    try {
      const dadosSalvos = localStorage.getItem('sistemaFinanceiro_dados');
      if (dadosSalvos) {
        const dadosCarregados = JSON.parse(dadosSalvos);
        dados = {
          receitas: dadosCarregados.receitas || [],
          despesas: dadosCarregados.despesas || [],
          cirurgias: dadosCarregados.cirurgias || [],
          funcionarios: dadosCarregados.funcionarios || [],
          gastosFixos: dadosCarregados.gastosFixos || [],
          parcelas: dadosCarregados.parcelas || [],
          insumos: dadosCarregados.insumos || [],
          saldoAtual: dadosCarregados.saldoAtual || 0
        };
        return true;
      }
    } catch (error) {
      console.error('Erro ao carregar dados locais:', error);
    }
    return false;
  }

    // === Busca por C√≥digo de Barras (escaneamento) ===
    function buscarInsumoPorCodigo(codigo) {
        const display = document.getElementById('resultadoBusca');
        if (!codigo) {
            display.innerHTML = '';
            return;
        }
        const insumo = dados.insumos.find(item => String(item.codigoBarras || '') === String(codigo));
        if (insumo) {
            display.innerHTML = `
                <p><strong>Produto:</strong> ${insumo.nome}</p>
                <p><strong>Categoria:</strong> ${insumo.categoria}</p>
                <p><strong>Quantidade:</strong> ${insumo.quantidade} ${insumo.unidade}</p>
                <p><strong>Pre√ßo Unit√°rio:</strong> ${formatarMoeda(parseFloat(insumo.preco || 0))}</p>
                <p><strong>C√≥digo:</strong> ${insumo.codigoBarras || ''}</p>
            `;
        } else {
            display.innerHTML = "<p style='color:red'>Produto n√£o encontrado</p>";
        }
    }

    (function() {
        var buscarInput = document.getElementById('buscarCodigoBarras');
        if (!buscarInput) return;
        buscarInput.addEventListener('input', function(e) {
            buscarInsumoPorCodigo(e.target.value.trim());
        });
        buscarInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscarInsumoPorCodigo(e.target.value.trim());
            }
        });
    })();


// === Fun√ß√£o para editar cirurgia ===
function editarCirurgia(id) {
    var cirurgia = dados.cirurgias.find(c => c.id === id);
    if (!cirurgia) return;

    // Preencher formul√°rio com os dados da cirurgia selecionada
    document.querySelector('#formCirurgia select[name="tipo"]').value = cirurgia.tipo;
    document.querySelector('#formCirurgia input[name="paciente"]').value = cirurgia.paciente;
    document.querySelector('#formCirurgia input[name="valorBruto"]').value = cirurgia.valorBruto;
    document.querySelector('#formCirurgia select[name="formaPagamento"]').value = cirurgia.formaPagamento;
    document.querySelector('#formCirurgia input[name="taxaCartao"]').value = cirurgia.taxaCartao;
    document.querySelector('#formCirurgia input[name="comissaoOrientadora"]').value = cirurgia.comissaoOrientadora;
    document.querySelector('#formCirurgia input[name="valorInstrumentadora"]').value = cirurgia.valorInstrumentadora;
    document.querySelector('#formCirurgia input[name="outrosCustos"]').value = cirurgia.outrosCustos;
    document.querySelector('#formCirurgia input[name="data"]').value = cirurgia.data;
    document.querySelector('#formCirurgia select[name="status"]').value = cirurgia.status;
    document.querySelector('#formCirurgia textarea[name="observacoes"]').value = cirurgia.observacoes;

    // Alterar bot√£o principal para modo edi√ß√£o
    var submitBtn = document.querySelector('#formCirurgia button[type="submit"]');
    submitBtn.textContent = 'üíæ Salvar Altera√ß√µes';
    submitBtn.onclick = function(e) {
        e.preventDefault();
        atualizarCirurgia(id);
    };

    adicionarBotaoCancelarEdicao();
}

// === Fun√ß√£o para atualizar cirurgia ===
function atualizarCirurgia(id) {
    var formData = new FormData(document.getElementById('formCirurgia'));
    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var dadosBasicos = {
        id: id,
        tipo: formData.get('tipo'),
        paciente: formData.get('paciente'),
                medico: formData.get('medico'),
        valorBruto: parseFloat(formData.get('valorBruto')),
        formaPagamento: formData.get('formaPagamento'),
        taxaCartao: parseFloat(formData.get('taxaCartao')) || 0,
        comissaoOrientadora: parseFloat(formData.get('comissaoOrientadora')) || 3,
                comissaoMedico: parseFloat(formData.get('comissaoMedico')) || 0,
        valorInstrumentadora: parseFloat(formData.get('valorInstrumentadora')) || 0,
        outrosCustos: parseFloat(formData.get('outrosCustos')) || 0,
        data: formData.get('data'),
        status: formData.get('status'),
        observacoes: formData.get('observacoes')
    };

    var cirurgiaAtualizada = processarCirurgia(dadosBasicos);
    dados.cirurgias[cirurgiaIndex] = cirurgiaAtualizada;

    atualizarReceitaCirurgia(cirurgiaAtualizada);
    cancelarEdicao();
    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('‚úÖ Cirurgia atualizada com sucesso!', 'success');
}

// === Fun√ß√£o para cancelar edi√ß√£o ===
function cancelarEdicao() {
    var form = document.getElementById('formCirurgia');
    form.reset();

    var submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Registrar Cirurgia';
    submitBtn.onclick = null;

    var cancelarBtn = document.getElementById('cancelarEdicaoBtn');
    if (cancelarBtn) cancelarBtn.remove();
}

// === Adiciona bot√£o cancelar ===
function adicionarBotaoCancelarEdicao() {
    if (document.getElementById('cancelarEdicaoBtn')) return;
    var form = document.getElementById('formCirurgia');
    var cancelarBtn = document.createElement('button');
    cancelarBtn.id = 'cancelarEdicaoBtn';
    cancelarBtn.type = 'button';
    cancelarBtn.textContent = '‚ùå Cancelar';
    cancelarBtn.className = 'btn';
    cancelarBtn.style.background = '#dc3545';
    cancelarBtn.onclick = cancelarEdicao;
    form.appendChild(cancelarBtn);
}


// === Fun√ß√£o para excluir cirurgia ===
function excluirCirurgia(id) {
    if (!confirm('Tem certeza que deseja excluir esta cirurgia?')) return;

    var cirurgiaIndex = dados.cirurgias.findIndex(c => c.id === id);
    if (cirurgiaIndex === -1) return;

    var cirurgiaRemovida = dados.cirurgias[cirurgiaIndex];

    // 1. Devolver insumos ao estoque
    if (cirurgiaRemovida.insumos && cirurgiaRemovida.insumos.length > 0) {
        cirurgiaRemovida.insumos.forEach(item => {
            var insumoEstoque = dados.insumos.find(i => i.codigoBarras === item.codigoBarras);
            if (insumoEstoque) {
                insumoEstoque.quantidade += item.quantidade;
            }
        });
    }

    // 2. Remover cirurgia da lista
    dados.cirurgias.splice(cirurgiaIndex, 1);

    atualizarTodasAsVisualizacoes();
    salvarAutomatico();
    mostrarNotificacao('üóëÔ∏è Cirurgia exclu√≠da com sucesso!', 'success');
}

</script>

</html>

<!-- Script de restaura√ß√£o autom√°tica do backup inserido -->
<script>
(function() {
  try {
    var KEY = 'sistemaFinanceiro_dados';
    var LAST = 'sistemaFinanceiro_ultimoSalvamento';
    var existing = localStorage.getItem(KEY);
    if (!existing) {
      var dados = {"receitas": [{"data": "2025-08-29", "descricao": "L√≠quido da Cirurgia: ANA BETE DE FATIMA SILVEIRA (catarata)", "fonte": "cirurgias", "id": 1756909410421, "valor": 6130}, {"data": "2025-08-29", "descricao": "L√≠quido da Cirurgia: Ozorio Martins Stalschimidt (catarata)", "fonte": "cirurgias", "id": 1756909518051, "valor": 6170}, {"data": "2025-08-22", "descricao": "L√≠quido da Cirurgia: Jose Walter Brisola (catarata)", "fonte": "cirurgias", "id": 1756909759701, "valor": 6929.34}, {"data": "2025-08-21", "descricao": "L√≠quido da Cirurgia: Luis Procopio Schimidt (retina)", "fonte": "cirurgias", "id": 1756909859355, "valor": 12688.1}, {"data": "2025-08-25", "descricao": "L√≠quido da Cirurgia: ADAO DA SILVA RAMOS (retina)", "fonte": "cirurgias", "id": 1756910048145, "valor": 10182.08}, {"data": "2025-09-01", "descricao": "L√≠quido da Cirurgia: EUCLIDES JOSE VALENTIM SOBRINHO (outras)", "fonte": "cirurgias", "id": 1756911072182, "valor": 3328}, {"data": "2025-09-02", "descricao": "L√≠quido da Cirurgia: DOMICIANO JOSE BANINSKI (outras)", "fonte": "cirurgias", "id": 1756911121035, "valor": 1891}, {"data": "2025-09-03", "descricao": "L√≠quido da Cirurgia: ALCINDO HENRIQUE DE OLIVEIRA LACERDA (retina)", "fonte": "cirurgias", "id": 1756926385823, "valor": 11398.1}, {"data": "2025-09-10", "descricao": "L√≠quido da Cirurgia: SANDRO VALERANOVICZ (catarata)", "fonte": "cirurgias", "id": 1757683312351, "valor": 3096.1000000000004}, {"data": "2025-09-11", "descricao": "L√≠quido da Cirurgia: JOAO OLIMPIO BORTO MININI (retina)", "fonte": "cirurgias", "id": 1757683799590, "valor": 11440.16}, {"data": "2025-09-12", "descricao": "L√≠quido da Cirurgia: JOSE EDMUNDO MARCHINSKI (retina)", "fonte": "cirurgias", "id": 1758135989077, "valor": 12011}, {"data": "2025-09-18", "descricao": "L√≠quido da Cirurgia: MARIA CANDIDA ARAUJO (catarata)", "fonte": "cirurgias", "id": 1758285032787, "valor": 2686.08}, {"data": "2025-09-19", "descricao": "L√≠quido da Cirurgia: ANDRELINA DOMINGUES BABIUK (catarata)", "fonte": "cirurgias", "id": 1758288238848, "valor": 3060}, {"data": "2025-09-19", "descricao": "L√≠quido da Cirurgia: JAROSLAVA KRZYK TARAS (catarata)", "fonte": "cirurgias", "id": 1758291252722, "valor": 6770}], "despesas": [{"categoria": "outros", "data": "2025-09-01", "descricao": "SALARIO NICOLE", "id": 1757515517232, "valor": 8462.5}, {"categoria": "outros", "data": "2025-09-01", "descricao": "SALARIO JULIELLI", "id": 1757515538281, "valor": 4750}, {"categoria": "outros", "data": "2025-09-01", "descricao": "SALARIO FERNANDA", "id": 1757515547884, "valor": 2100}, {"categoria": "outros", "data": "2025-09-01", "descricao": "TAXA DE SALA (agosto)", "id": 1757515577656, "valor": 6000}, {"categoria": "outros", "data": "2025-09-01", "descricao": "ANESTESISTAS (agosto)", "id": 1757515595666, "valor": 5400}, {"categoria": "outros", "data": "2025-09-01", "descricao": "salario Ennos", "id": 1757515614499, "valor": 3800}, {"categoria": "outros", "data": "2025-09-02", "descricao": "A√áAI MENINAS", "id": 1757515677173, "valor": 115.65}, {"categoria": "outros", "data": "2025-09-03", "descricao": "APRAMED - OCT", "id": 1757515714649, "valor": 15297.36}, {"categoria": "outros", "data": "2025-09-05", "descricao": "COMISSAO JU SEMANAL", "id": 1757515750031, "valor": 300}, {"categoria": "outros", "data": "2025-09-05", "descricao": "Lampada de fenda", "id": 1757515789110, "valor": 1501.35}, {"categoria": "outros", "data": "2025-09-08", "descricao": "PAGAMENTO CAMILA (SABADO + CAPINHAS E PELICULAS)", "id": 1757515843399, "valor": 240}, {"categoria": "outros", "data": "2025-09-09", "descricao": "BOLETO ALCON EM ATRASO", "id": 1757515870783, "valor": 1972.89}, {"categoria": "outros", "data": "2025-09-09", "descricao": "BOLETO ALCON EM ATRASO", "id": 1757515890448, "valor": 246.49}, {"categoria": "outros", "data": "2025-09-09", "descricao": "BOLETO HOYA", "id": 1757515907316, "valor": 888.5}, {"categoria": "outros", "data": "2025-09-09", "descricao": "NESSIM", "id": 1757515928882, "valor": 14946.48}, {"categoria": "outros", "data": "2025-09-09", "descricao": "NESSIM", "id": 1757516139624, "valor": 16953.52}, {"categoria": "outros", "data": "2025-09-09", "descricao": "NESSIM", "id": 1757516155108, "valor": 5715}], "cirurgias": [{"comissaoOrientadora": 240, "custoFuncionarios": 0, "custoInsumos": 40, "data": "2025-08-29", "formaPagamento": "dinheiro", "id": 1756909410419, "impostos": 1440, "insumosUtilizados": [{"id": 1756483937523, "nome": "BISTURI SURGISTAR 2.4 (231214)", "preco": 40, "quantidade": 1, "total": 40, "unidade": "unidade"}], "margem": 76.625, "observacoes": "", "outrosCustos": 0, "paciente": "ANA BETE DE FATIMA SILVEIRA", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "catarata", "totalCustos": 1870, "totalCustosOperacionais": 390, "valorBruto": 8000, "valorInstrumentadora": 150, "valorLiquido": 6130}, {"comissaoOrientadora": 240, "custoFuncionarios": 0, "custoInsumos": 0, "data": "2025-08-29", "formaPagamento": "dinheiro", "id": 1756909518049, "impostos": 1440, "insumosUtilizados": [{"id": 1756484027418, "nome": "PONTEIRA  ALCON", "preco": 0, "quantidade": 1, "total": 0, "unidade": "unidade"}], "margem": 77.125, "observacoes": "", "outrosCustos": 0, "paciente": "Ozorio Martins Stalschimidt", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "catarata", "totalCustos": 1830, "totalCustosOperacionais": 390, "valorBruto": 8000, "valorInstrumentadora": 150, "valorLiquido": 6170}, {"comissaoOrientadora": 300, "custoFuncionarios": 0, "custoInsumos": 170.66, "data": "2025-08-22", "formaPagamento": "cartao-credito-parcelado", "id": 1756909759699, "impostos": 1800, "insumosUtilizados": [{"id": 1755627578265, "nome": "BISTURI 1.10mm - RUMEX (RU/230806)", "preco": 58.33, "quantidade": 1, "total": 58.33, "unidade": "unidade"}, {"id": 1755627749089, "nome": "BISTURI RUMEX 2.40mm (RU240406)", "preco": 58.33, "quantidade": 1, "total": 58.33, "unidade": "unidade"}, {"id": 1755868562153, "nome": "cartucho C (15939004)", "preco": 54, "quantidade": 1, "total": 54, "unidade": "unidade"}], "margem": 69.2934, "observacoes": "fez um ANTI VEGF tamb√©m", "outrosCustos": 0, "paciente": "Jose Walter Brisola", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 550, "tipo": "catarata", "totalCustos": 3070.66, "totalCustosOperacionais": 550, "valorBruto": 10000, "valorInstrumentadora": 250, "valorLiquido": 6929.34}, {"comissaoOrientadora": 540, "custoFuncionarios": 0, "custoInsumos": 341.9, "data": "2025-08-21", "formaPagamento": "cartao-credito-parcelado", "id": 1756909859354, "impostos": 3240, "insumosUtilizados": [{"id": 1755626435720, "nome": "PERFLUORCARBONO (062506 - 06/27)", "preco": 341.9, "quantidade": 1, "total": 341.9, "unidade": "unidade"}], "margem": 70.48944444444444, "observacoes": "", "outrosCustos": 0, "paciente": "Luis Procopio Schimidt", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 990, "tipo": "retina", "totalCustos": 5311.9, "totalCustosOperacionais": 740, "valorBruto": 18000, "valorInstrumentadora": 200, "valorLiquido": 12688.1}, {"comissaoOrientadora": 480, "custoFuncionarios": 0, "custoInsumos": 1067.92, "data": "2025-08-25", "formaPagamento": "cartao-credito-parcelado", "id": 1756910048144, "impostos": 2880, "insumosUtilizados": [{"id": 1753469569555, "nome": "VISCOAT - VMF20 ( V: 12/27)", "preco": 373.92, "quantidade": 1, "total": 373.92, "unidade": "unidade"}, {"id": 1753468504288, "nome": "metotrexato - 24K0601 ( V:11/26)", "preco": 46, "quantidade": 1, "total": 46, "unidade": "frasco"}, {"id": 1755868562153, "nome": "cartucho C (15939004)", "preco": 54, "quantidade": 1, "total": 54, "unidade": "unidade"}, {"id": 1755867724535, "nome": "ANTI VEGF - aflibercept", "preco": 214, "quantidade": 1, "total": 214, "unidade": "unidade"}, {"id": 1755626686179, "nome": "OLEO DE SILICONE 1000 ( 062408 - 06/26)", "preco": 380, "quantidade": 1, "total": 380, "unidade": "unidade"}], "margem": 63.63799999999999, "observacoes": "", "outrosCustos": 0, "paciente": "ADAO DA SILVA RAMOS", "status": "realizada", "taxaCartao": 6.5, "taxaCartaoValor": 1040, "tipo": "retina", "totalCustos": 5817.92, "totalCustosOperacionais": 830, "valorBruto": 16000, "valorInstrumentadora": 350, "valorLiquido": 10182.08}, {"comissaoOrientadora": 144, "custoFuncionarios": 0, "custoInsumos": 0, "data": "2025-09-01", "formaPagamento": "cartao-credito-parcelado", "id": 1756911072181, "impostos": 864, "margem": 69.33333333333334, "observacoes": "", "outrosCustos": 0, "paciente": "EUCLIDES JOSE VALENTIM SOBRINHO", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 264, "tipo": "outras", "totalCustos": 1472, "totalCustosOperacionais": 344, "valorBruto": 4800, "valorInstrumentadora": 200, "valorLiquido": 3328}, {"comissaoOrientadora": 90, "custoFuncionarios": 0, "custoInsumos": 214, "data": "2025-09-02", "formaPagamento": "cartao-credito-parcelado", "id": 1756911121034, "impostos": 540, "insumosUtilizados": [{"id": 1755867724535, "nome": "ANTI VEGF - aflibercept", "preco": 214, "quantidade": 1, "total": 214, "unidade": "unidade"}], "margem": 63.03333333333333, "observacoes": "ANTI VEGF OE", "outrosCustos": 0, "paciente": "DOMICIANO JOSE BANINSKI", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 165, "tipo": "outras", "totalCustos": 1109, "totalCustosOperacionais": 190, "valorBruto": 3000, "valorInstrumentadora": 100, "valorLiquido": 1891}, {"comissaoOrientadora": 540, "custoFuncionarios": 0, "custoInsumos": 2621.9, "data": "2025-09-03", "formaPagamento": "dinheiro", "id": 1756926385821, "impostos": 3240, "insumosUtilizados": [{"id": 1755626686179, "nome": "OLEO DE SILICONE 1000 ( 062408 - 06/26)", "preco": 380, "quantidade": 1, "total": 380, "unidade": "unidade"}, {"id": 1756162273649, "nome": "PERFLUORCARBONO (062530 - 06/27)", "preco": 341.9, "quantidade": 1, "total": 341.9, "unidade": "unidade"}, {"id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 1, "total": 1000, "unidade": "unidade"}, {"id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 1, "total": 900, "unidade": "unidade"}], "margem": 63.32277777777778, "observacoes": "", "outrosCustos": 0, "paciente": "ALCINDO HENRIQUE DE OLIVEIRA LACERDA", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "retina", "totalCustos": 6601.9, "totalCustosOperacionais": 740, "valorBruto": 18000, "valorInstrumentadora": 200, "valorLiquido": 11398.1}, {"comissaoOrientadora": 0, "custoFuncionarios": 0, "custoInsumos": 98, "data": "2025-09-03", "formaPagamento": "dinheiro", "id": 1757515259086, "impostos": 0, "insumosUtilizados": [{"id": 1753906661902, "nome": "AZUL BRILHANTE (022531 - 02/27)", "preco": 98, "quantidade": 1, "total": 98, "unidade": "unidade"}], "margem": 0, "observacoes": "PACIENTE SUS", "outrosCustos": 0, "paciente": "ROSE MARI VIEIRA", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "retina", "totalCustos": 298, "totalCustosOperacionais": 200, "valorBruto": 0, "valorInstrumentadora": 200, "valorLiquido": -298}, {"comissaoOrientadora": 0, "custoFuncionarios": 0, "custoInsumos": 721.9, "data": "2025-09-05", "formaPagamento": "dinheiro", "id": 1757515366698, "impostos": 0, "insumosUtilizados": [{"id": 1755626435720, "nome": "PERFLUORCARBONO (062506 - 06/27)", "preco": 341.9, "quantidade": 1, "total": 341.9, "unidade": "unidade"}, {"id": 1755626686179, "nome": "OLEO DE SILICONE 1000 ( 062408 - 06/26)", "preco": 380, "quantidade": 1, "total": 380, "unidade": "unidade"}], "margem": 0, "observacoes": "PACIENTE SUS", "outrosCustos": 0, "paciente": "HELBER PEREIRA HOURI", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "retina", "totalCustos": 921.9, "totalCustosOperacionais": 200, "valorBruto": 0, "valorInstrumentadora": 200, "valorLiquido": -921.9}, {"comissaoOrientadora": 270, "custoFuncionarios": 0, "custoInsumos": 3133.9, "data": "2025-09-10", "formaPagamento": "cartao-credito-parcelado", "id": 1757683312349, "impostos": 1620, "insumosUtilizados": [{"id": 1757683194463, "nome": "MA60 +21,00", "preco": 297, "quantidade": 1, "total": 297, "unidade": "unidade"}, {"id": 1757682896167, "nome": "PERFLUORCARBONO (062506 - 06/27)", "preco": 342.9, "quantidade": 1, "total": 342.9, "unidade": "unidade"}, {"id": 1757682941515, "nome": "OLEO DE SILICONE 1000 ( 062408 - 06/26)", "preco": 380, "quantidade": 1, "total": 380, "unidade": "unidade"}, {"id": 1755867724535, "nome": "ANTI VEGF - aflibercept", "preco": 214, "quantidade": 1, "total": 214, "unidade": "unidade"}, {"id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 1, "total": 1000, "unidade": "unidade"}, {"id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 1, "total": 900, "unidade": "unidade"}], "margem": 34.40111111111111, "observacoes": "FACO + VVPP", "outrosCustos": 0, "paciente": "SANDRO VALERANOVICZ", "status": "realizada", "taxaCartao": 7, "taxaCartaoValor": 630.0000000000001, "tipo": "catarata", "totalCustos": 5903.9, "totalCustosOperacionais": 520, "valorBruto": 9000, "valorInstrumentadora": 250, "valorLiquido": 3096.1000000000004}, {"comissaoOrientadora": 630, "custoFuncionarios": 0, "custoInsumos": 3744.84, "data": "2025-09-11", "formaPagamento": "cartao-credito-parcelado", "id": 1757683799582, "impostos": 3780, "insumosUtilizados": [{"id": 1753469569555, "nome": "VISCOAT - VMF20 ( V: 12/27)", "preco": 373.92, "quantidade": 2, "total": 747.84, "unidade": "unidade"}, {"id": 1757683713875, "nome": "GORETEX", "preco": 400, "quantidade": 1, "total": 400, "unidade": "unidade"}, {"id": 1755630480099, "nome": "ANEL DE TENSAO CAPSULAR (SNJB753950)", "preco": 400, "quantidade": 1, "total": 400, "unidade": "unidade"}, {"id": 1756927932622, "nome": "MA60 +18,00 (31582413038)", "preco": 297, "quantidade": 1, "total": 297, "unidade": "unidade"}, {"id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 1, "total": 1000, "unidade": "unidade"}, {"id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 1, "total": 900, "unidade": "unidade"}], "margem": 54.47695238095238, "observacoes": "", "outrosCustos": 0, "paciente": "JOAO OLIMPIO BORTO MININI", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 1155, "tipo": "retina", "totalCustos": 9559.84, "totalCustosOperacionais": 880, "valorBruto": 21000, "valorInstrumentadora": 250, "valorLiquido": 11440.16}, {"comissaoOrientadora": 0, "custoFuncionarios": 0, "custoInsumos": 721.9, "data": "2025-09-17", "formaPagamento": "dinheiro", "id": 1758135712484, "impostos": 0, "insumosUtilizados": [{"id": 1757703805914, "nome": "OLEO DE SILICONE 1000 ( 062408 - 06/26) ", "preco": 380, "quantidade": 1, "total": 380, "unidade": "unidade"}, {"id": 1756162273649, "nome": "PERFLUORCARBONO (062530 - 06/27)", "preco": 341.9, "quantidade": 1, "total": 341.9, "unidade": "unidade"}], "margem": 0, "observacoes": "paciente SUS", "outrosCustos": 0, "paciente": "VALDIR MOREIRA", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "retina", "totalCustos": 921.9, "totalCustosOperacionais": 200, "valorBruto": 0, "valorInstrumentadora": 200, "valorLiquido": -921.9}, {"comissaoOrientadora": 540, "custoFuncionarios": 0, "custoInsumos": 2009, "data": "2025-09-12", "formaPagamento": "dinheiro", "id": 1758135989076, "impostos": 3240, "insumosUtilizados": [{"id": 1757704914237, "nome": "AZUL BRILHANTE (022531 - 02/27)", "preco": 98, "quantidade": 1, "total": 98, "unidade": "unidade"}, {"id": 1755627057913, "nome": "FILTRO GAS - 331011 (04/2027)", "preco": 11, "quantidade": 1, "total": 11, "unidade": "unidade"}, {"id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 1, "total": 1000, "unidade": "unidade"}, {"id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 1, "total": 900, "unidade": "unidade"}], "margem": 66.72777777777777, "observacoes": "USADO GAS", "outrosCustos": 0, "paciente": "JOSE EDMUNDO MARCHINSKI", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "retina", "totalCustos": 5989, "totalCustosOperacionais": 740, "valorBruto": 18000, "valorInstrumentadora": 200, "valorLiquido": 12011}, {"comissaoOrientadora": 18, "custoFuncionarios": 0, "custoInsumos": 341.9, "data": "2025-09-17", "formaPagamento": "dinheiro", "id": 1758136998845, "impostos": 108, "insumosUtilizados": [{"id": 1756162273649, "nome": "PERFLUORCARBONO (062530 - 06/27)", "preco": 341.9, "quantidade": 1, "total": 341.9, "unidade": "unidade"}], "margem": -11.316666666666663, "observacoes": "", "outrosCustos": 0, "paciente": "arrumar estoque", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "outras", "totalCustos": 667.9, "totalCustosOperacionais": 218, "valorBruto": 600, "valorInstrumentadora": 200, "valorLiquido": -67.89999999999998}, {"comissaoOrientadora": 240, "custoFuncionarios": 0, "custoInsumos": 3043.92, "data": "2025-09-18", "formaPagamento": "cartao-credito-parcelado", "id": 1758285032786, "impostos": 1440, "insumosUtilizados": [{"id": 1753469569555, "nome": "VISCOAT - VMF20 ( V: 12/27)", "preco": 373.92, "quantidade": 1, "total": 373.92, "unidade": "unidade"}, {"id": 1757701683689, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "total": 770, "unidade": "unidade"}, {"id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 1, "total": 1000, "unidade": "unidade"}, {"id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 1, "total": 900, "unidade": "unidade"}], "margem": 33.576, "observacoes": "", "outrosCustos": 0, "paciente": "MARIA CANDIDA ARAUJO", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 440, "tipo": "catarata", "totalCustos": 5313.92, "totalCustosOperacionais": 390, "valorBruto": 8000, "valorInstrumentadora": 150, "valorLiquido": 2686.08}, {"comissaoOrientadora": 240, "custoFuncionarios": 0, "custoInsumos": 2670, "data": "2025-09-19", "formaPagamento": "cartao-credito-parcelado", "id": 1758288238847, "impostos": 1440, "insumosUtilizados": [{"id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 1, "total": 1000, "unidade": "unidade"}, {"id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 1, "total": 900, "unidade": "unidade"}, {"id": 1757701832192, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "total": 770, "unidade": "unidade"}], "margem": 38.25, "observacoes": "", "outrosCustos": 0, "paciente": "ANDRELINA DOMINGUES BABIUK", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 440, "tipo": "catarata", "totalCustos": 4940, "totalCustosOperacionais": 390, "valorBruto": 8000, "valorInstrumentadora": 150, "valorLiquido": 3060}, {"comissaoOrientadora": 360, "custoFuncionarios": 0, "custoInsumos": 1900, "data": "2025-09-19", "formaPagamento": "cartao-credito-parcelado", "id": 1758291252721, "impostos": 2160, "insumosUtilizados": [{"id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 1, "total": 1000, "unidade": "unidade"}, {"id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 1, "total": 900, "unidade": "unidade"}], "margem": 56.41666666666667, "observacoes": "lente VIVITY +22,00 (PAGAMENTO UNITY)", "outrosCustos": 0, "paciente": "JAROSLAVA KRZYK TARAS", "status": "realizada", "taxaCartao": 5.5, "taxaCartaoValor": 660, "tipo": "catarata", "totalCustos": 5230, "totalCustosOperacionais": 510, "valorBruto": 12000, "valorInstrumentadora": 150, "valorLiquido": 6770}, {"comissaoOrientadora": 0, "custoFuncionarios": 0, "custoInsumos": 98, "data": "2025-09-19", "formaPagamento": "dinheiro", "id": 1758308463598, "impostos": 0, "insumosUtilizados": [{"id": 1757704914237, "nome": "AZUL BRILHANTE (022531 - 02/27)", "preco": 98, "quantidade": 1, "total": 98, "unidade": "unidade"}], "margem": 0, "observacoes": "SUS", "outrosCustos": 0, "paciente": "JUDITE LEMES JACOBS", "status": "agendada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "retina", "totalCustos": 298, "totalCustosOperacionais": 200, "valorBruto": 0, "valorInstrumentadora": 200, "valorLiquido": -298}, {"comissaoOrientadora": 0, "custoFuncionarios": 0, "custoInsumos": 225, "data": "2025-09-19", "formaPagamento": "dinheiro", "id": 1758309481271, "impostos": 0, "insumosUtilizados": [{"id": 1755627057913, "nome": "FILTRO GAS - 331011 (04/2027)", "preco": 11, "quantidade": 1, "total": 11, "unidade": "unidade"}, {"id": 1755867724535, "nome": "ANTI VEGF - aflibercept", "preco": 214, "quantidade": 1, "total": 214, "unidade": "unidade"}], "margem": 0, "observacoes": "SUS", "outrosCustos": 0, "paciente": "CELSO UBIRAJARA FOGA√áA DA SILVA", "status": "realizada", "taxaCartao": 0, "taxaCartaoValor": 0, "tipo": "retina", "totalCustos": 425, "totalCustosOperacionais": 200, "valorBruto": 0, "valorInstrumentadora": 200, "valorLiquido": -425}], "funcionarios": [], "gastosFixos": [], "parcelas": [], "insumos": [{"categoria": "medicamentos", "estoqueMinimo": 1, "id": 1753468504288, "nome": "metotrexato - 24K0601 ( V:11/26)", "preco": 46, "quantidade": 2, "unidade": "frasco"}, {"categoria": "medicamentos", "estoqueMinimo": 2, "id": 1753469569555, "nome": "VISCOAT - VMF20 ( V: 12/27)", "preco": 373.92, "quantidade": 0, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 5, "id": 1755627057913, "nome": "FILTRO GAS - 331011 (04/2027)", "preco": 11, "quantidade": 15, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 0, "id": 1755627129199, "nome": "FILTRO DE GAS CABINHO", "preco": 15, "quantidade": 4, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 3, "id": 1755627578265, "nome": "BISTURI 1.10mm - RUMEX (RU/230806)", "preco": 58.33, "quantidade": 5, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 3, "id": 1755627644343, "nome": "BISTURI RUMEX 2mm ( RU231204)", "preco": 58.33, "quantidade": 6, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 3, "id": 1755627749089, "nome": "BISTURI RUMEX 2.40mm (RU240406)", "preco": 58.33, "quantidade": 4, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 3, "id": 1755627850188, "nome": "BISTURI 20G (NF0054/2021)", "preco": 58.33, "quantidade": 4, "unidade": "unidade"}, {"categoria": "equipamentos", "estoqueMinimo": 0, "id": 1755627973375, "nome": "CALTERIZADOR", "preco": 78.9, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 3, "id": 1755628483253, "nome": "Canula simples 23G (B1710)", "preco": 30, "quantidade": 3, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 3, "id": 1755628570024, "nome": "Canula dual bore 23G (F2407)", "preco": 130, "quantidade": 1, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 0, "id": 1755628627206, "nome": "Bisturi 2.4 visi slim (BT1185M)", "preco": 37.9, "quantidade": 2, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 1, "id": 1755628782693, "nome": "KIT LUVINHAS", "preco": 0, "quantidade": 2, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 5, "id": 1755629598516, "nome": "CANULA ROXA", "preco": 2, "quantidade": 33, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 10, "id": 1755629650809, "nome": "CANULA BRANCA", "preco": 2, "quantidade": 32, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 3, "id": 1755629684129, "nome": "CANULA VERDE ANGULADA", "preco": 2, "quantidade": 9, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 3, "id": 1755629731102, "nome": "CANULA VERDE RETA", "preco": 2, "quantidade": 21, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 3, "id": 1755629783527, "nome": "CANULA AMARELA ", "preco": 2, "quantidade": 20, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630406054, "nome": "CHANDELIER 23G", "preco": 890, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630426276, "nome": "LENTE BIOM DESCARTAVEL", "preco": 0, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630533319, "nome": "LENTE SENSAR +19,00 (2185602325)", "preco": 0, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630644026, "nome": "MA60 +14,00 (15117462015)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630680125, "nome": "MA60 +15,00 (31582853023)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630711599, "nome": "MA60 +16,00 (31581978059)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630738375, "nome": "MA60 +17,00 (31581689075)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630778425, "nome": "MA60 +20,00 (31583554076)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630914743, "nome": "MA60 +23,00 (31582726015)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755630965643, "nome": "MA60 +26,00 (31581515037)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755631201667, "nome": "255 +21,00", "preco": 450, "quantidade": 2, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1755631256975, "nome": "INSERT PY +26,00", "preco": 312, "quantidade": 1, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 2, "id": 1755632132438, "nome": "VIGADEXA COLIRIO (7859 - 01/27)", "preco": 45, "quantidade": 3, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 2, "id": 1755632226536, "nome": "NEVANAC COLIRIO (78453 - 06/2026)", "preco": 75.6, "quantidade": 3, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 1, "id": 1755632468419, "nome": "colirio anestesico (590056 - 10/25)", "preco": 38.5, "quantidade": 4, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 1, "id": 1755632668283, "nome": "mitomicina c (579461)", "preco": 93, "quantidade": 4, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 0, "id": 1755632760711, "nome": "vancomicina ( 78TF2666 - 13/06/2026)", "preco": 110, "quantidade": 1, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 0, "id": 1755632835594, "nome": " CEFTAZIDIMA (111415C)", "preco": 44, "quantidade": 1, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 10, "id": 1755633824972, "nome": "LUVAS 7,5", "preco": 1.2, "quantidade": 18, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 5, "id": 1755634221959, "nome": "CAMPO IMPERMEAVEL", "preco": 2.8, "quantidade": 11, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 5, "id": 1755634265748, "nome": "CAMPO FENESTRADO", "preco": 3.5, "quantidade": 116, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 10, "id": 1755634309476, "nome": "COTONETE", "preco": 0.3, "quantidade": 45, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 10, "id": 1755634346910, "nome": "TOUCAS", "preco": 0.1, "quantidade": 94, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 10, "id": 1755634398384, "nome": "SORO 10ML", "preco": 0.45, "quantidade": 65, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 10, "id": 1755634434391, "nome": "AVENTAL", "preco": 3, "quantidade": 6, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 5, "id": 1755867724535, "nome": "ANTI VEGF - aflibercept", "preco": 214, "quantidade": 11, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 3, "id": 1755868562153, "nome": "cartucho C (15939004)", "preco": 54, "quantidade": 5, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 1, "id": 1755886355871, "nome": "mi loop (FG24021610)", "preco": 1000, "quantidade": 5, "unidade": "unidade"}, {"categoria": "medicamentos", "estoqueMinimo": 3, "id": 1756162273649, "nome": "PERFLUORCARBONO (062530 - 06/27)", "preco": 341.9, "quantidade": 0, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 3, "id": 1756483937523, "nome": "BISTURI SURGISTAR 2.4 (231214)", "preco": 40, "quantidade": 5, "unidade": "unidade"}, {"categoria": "descartaveis", "estoqueMinimo": 3, "id": 1756484027418, "nome": "PONTEIRA  ALCON", "preco": 0, "quantidade": 5, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1756926294894, "nome": "TAXA DE SALA", "preco": 1000, "quantidade": 99993, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1756926315696, "nome": "ANESTESISTA", "preco": 900, "quantidade": 99993, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1756927724503, "nome": "LIO 255 +21,00 (TDQ10D45)", "preco": 450, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1756927780001, "nome": "LIO 255 +23,00 (TDQ209N3)", "preco": 450, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1756927885583, "nome": "MA60 +19,00 (31584238055)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "estoqueMinimo": 0, "id": 1756927932622, "nome": "MA60 +18,00 (31582413038)", "preco": 297, "quantidade": 0, "unidade": "unidade"}, {"categoria": "medicamentos", "codigoBarras": "000", "estoqueMinimo": 0, "id": 1757514798458, "nome": "ANTI VEGF ( bevacizumabe) - 90438", "preco": 214, "quantidade": 1, "unidade": "unidade"}, {"categoria": "medicamentos", "codigoBarras": "000", "estoqueMinimo": 10, "id": 1757514860750, "nome": "ANTI VEGF ( bevacizumabe) - 90438", "preco": 214, "quantidade": 16, "unidade": "unidade"}, {"categoria": "medicamentos", "codigoBarras": "000", "estoqueMinimo": 0, "id": 1757514900701, "nome": "ANTI VEGF ( bevacizumabe) - 90460", "preco": 214, "quantidade": 3, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "31588856063", "estoqueMinimo": 0, "id": 1757531229845, "nome": "MA60 +22,00(31588856063)", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "31588424073", "estoqueMinimo": 0, "id": 1757531299846, "nome": "MA60 +24,00", "preco": 297, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "01089077459628891727120021GJ0224000006285488102DA014", "estoqueMinimo": 0, "id": 1757531341546, "nome": "EYEOL +24,50", "preco": 75, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "01045474804513741727123121TDQ113V7", "estoqueMinimo": 0, "id": 1757531519644, "nome": "255+25,00", "preco": 450, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "01045474804512061728013121TDQ200S6", "estoqueMinimo": 0, "id": 1757531652588, "nome": "255 +16,50", "preco": 450, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "010454748050412417280229214WQ21XG8", "estoqueMinimo": 0, "id": 1757531764834, "nome": "IMPRESS", "preco": 1200, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "0", "estoqueMinimo": 0, "id": 1757682896167, "nome": "PERFLUORCARBONO (062506 - 06/27)", "preco": 342.9, "quantidade": 0, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "0", "estoqueMinimo": 0, "id": 1757683194463, "nome": "MA60 +21,00", "preco": 297, "quantidade": 0, "unidade": "unidade"}, {"categoria": "descartaveis", "codigoBarras": "0", "estoqueMinimo": 0, "id": 1757683713875, "nome": "GORETEX", "preco": 400, "quantidade": 0, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "25981033113", "estoqueMinimo": 0, "id": 1757700855034, "nome": "Clareon +24.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "descartaveis", "codigoBarras": "25964924043", "estoqueMinimo": 0, "id": 1757700895838, "nome": "Clareon +24.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "descartaveis", "codigoBarras": "25964924045", "estoqueMinimo": 0, "id": 1757701112284, "nome": "Clareon +24.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001137056", "estoqueMinimo": 0, "id": 1757701142962, "nome": "Clareon +23.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001137066", "estoqueMinimo": 0, "id": 1757701191465, "nome": "Clareon +23.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001137143", "estoqueMinimo": 0, "id": 1757701233569, "nome": "Clareon +23.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959074", "estoqueMinimo": 0, "id": 1757701298980, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959128", "estoqueMinimo": 0, "id": 1757701321570, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959077", "estoqueMinimo": 0, "id": 1757701341158, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959073", "estoqueMinimo": 1, "id": 1757701355907, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959127", "estoqueMinimo": 0, "id": 1757701370377, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959078", "estoqueMinimo": 0, "id": 1757701391758, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959076", "estoqueMinimo": 0, "id": 1757701409766, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959121", "estoqueMinimo": 0, "id": 1757701424873, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959110", "estoqueMinimo": 0, "id": 1757701439024, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26051959079", "estoqueMinimo": 0, "id": 1757701457200, "nome": "Clareon +23.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042277122", "estoqueMinimo": 0, "id": 1757701483843, "nome": "Clareon +22.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042277046", "estoqueMinimo": 0, "id": 1757701504179, "nome": "Clareon +22.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042277036", "estoqueMinimo": 0, "id": 1757701515797, "nome": "Clareon +22.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042277140", "estoqueMinimo": 0, "id": 1757701531253, "nome": "Clareon +22.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042295092", "estoqueMinimo": 0, "id": 1757701545230, "nome": "Clareon +22.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169099", "estoqueMinimo": 0, "id": 1757701585746, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169114", "estoqueMinimo": 0, "id": 1757701609907, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169048", "estoqueMinimo": 0, "id": 1757701623123, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169098", "estoqueMinimo": 0, "id": 1757701637368, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169118", "estoqueMinimo": 0, "id": 1757701649300, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169103", "estoqueMinimo": 0, "id": 1757701660248, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169101", "estoqueMinimo": 0, "id": 1757701671351, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169080", "estoqueMinimo": 0, "id": 1757701683689, "nome": "Clareon +22.00", "preco": 770, "quantidade": 0, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169056", "estoqueMinimo": 0, "id": 1757701696964, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26042169052", "estoqueMinimo": 0, "id": 1757701707926, "nome": "Clareon +22.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001263066", "estoqueMinimo": 0, "id": 1757701734189, "nome": "Clareon +21.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001263102", "estoqueMinimo": 0, "id": 1757701750027, "nome": "Clareon +21.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001263101", "estoqueMinimo": 0, "id": 1757701762322, "nome": "Clareon +21.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001263050", "estoqueMinimo": 0, "id": 1757701774856, "nome": "Clareon +21.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001263098", "estoqueMinimo": 0, "id": 1757701798839, "nome": "Clareon +21.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884025", "estoqueMinimo": 0, "id": 1757701820114, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884156", "estoqueMinimo": 0, "id": 1757701832192, "nome": "Clareon +21.00", "preco": 770, "quantidade": 0, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884005", "estoqueMinimo": 0, "id": 1757701844122, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884060", "estoqueMinimo": 0, "id": 1757701856775, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884004", "estoqueMinimo": 0, "id": 1757701892266, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884003", "estoqueMinimo": 0, "id": 1757701906024, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884139", "estoqueMinimo": 0, "id": 1757701919247, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884120", "estoqueMinimo": 0, "id": 1757701942598, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041884013", "estoqueMinimo": 0, "id": 1757701957116, "nome": "Clareon +21.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001477088", "estoqueMinimo": 0, "id": 1757701988942, "nome": "Clareon +20.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001477095", "estoqueMinimo": 0, "id": 1757702005674, "nome": "Clareon +20.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001477087", "estoqueMinimo": 0, "id": 1757702016898, "nome": "Clareon +20.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001477031", "estoqueMinimo": 0, "id": 1757702028312, "nome": "Clareon +20.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001477081", "estoqueMinimo": 0, "id": 1757702039259, "nome": "Clareon +20.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972055", "estoqueMinimo": 0, "id": 1757702081308, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972035", "estoqueMinimo": 0, "id": 1757702094035, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972029", "estoqueMinimo": 0, "id": 1757702110864, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26001137056", "estoqueMinimo": 0, "id": 1757702126014, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972026", "estoqueMinimo": 0, "id": 1757702137758, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972032", "estoqueMinimo": 0, "id": 1757702149069, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972037", "estoqueMinimo": 0, "id": 1757702161125, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972020", "estoqueMinimo": 0, "id": 1757702170889, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007972033", "estoqueMinimo": 0, "id": 1757702180951, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26007969005", "estoqueMinimo": 0, "id": 1757702193309, "nome": "Clareon +20.00", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480143", "estoqueMinimo": 0, "id": 1757702231374, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480061", "estoqueMinimo": 0, "id": 1757702244091, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480053", "estoqueMinimo": 0, "id": 1757702257384, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480026", "estoqueMinimo": 0, "id": 1757702271188, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480032", "estoqueMinimo": 0, "id": 1757702283931, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480084", "estoqueMinimo": 0, "id": 1757702294945, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480044", "estoqueMinimo": 0, "id": 1757702308060, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480063", "estoqueMinimo": 0, "id": 1757702320229, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480173", "estoqueMinimo": 0, "id": 1757702337471, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480151", "estoqueMinimo": 0, "id": 1757702349349, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480074", "estoqueMinimo": 0, "id": 1757702361523, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480071", "estoqueMinimo": 0, "id": 1757702376286, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480078", "estoqueMinimo": 0, "id": 1757702389158, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480174", "estoqueMinimo": 0, "id": 1757702402911, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26041480082", "estoqueMinimo": 0, "id": 1757702422061, "nome": "Clareon +19.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26000846136", "estoqueMinimo": 0, "id": 1757702445741, "nome": "Clareon +18.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "26000846129", "estoqueMinimo": 0, "id": 1757702465369, "nome": "Clareon +18.50", "preco": 770, "quantidade": 1, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "7898154460541", "estoqueMinimo": 0, "id": 1757703805914, "nome": "OLEO DE SILICONE 1000 ( 062408 - 06/26) ", "preco": 380, "quantidade": 8, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "7898154460558", "estoqueMinimo": 0, "id": 1757704245773, "nome": "OLEO DE SILICONE 5000 (10/26-01/27)", "preco": 380, "quantidade": 5, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "7898154460527", "estoqueMinimo": 0, "id": 1757704914237, "nome": "AZUL BRILHANTE (022531 - 02/27)", "preco": 98, "quantidade": 4, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "+M583VV11E", "estoqueMinimo": 0, "id": 1757704986266, "nome": "METIL ( 4L1095VV - 11/27)", "preco": 35, "quantidade": 9, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "0105200702400022", "estoqueMinimo": 0, "id": 1757705181040, "nome": "BSS (09/26-11/25)", "preco": 85, "quantidade": 5, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "0114546951403406112408301729073010K249123700", "estoqueMinimo": 0, "id": 1757705283312, "nome": "BISTURI DE 2.40mm ( K249123700)", "preco": 70, "quantidade": 4, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "0114546951400184112405131729041310K249066000", "estoqueMinimo": 0, "id": 1757705346329, "nome": "bisturi 2.75 mm (K249066000)", "preco": 70, "quantidade": 5, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "01080211180010711726082110P23080018", "estoqueMinimo": 0, "id": 1757705704219, "nome": "OLEO DE SILICONE 1300 ( P23080018 - 08/26)", "preco": 380, "quantidade": 2, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "01108113130125221729022810B2410", "estoqueMinimo": 0, "id": 1757705887722, "nome": "Canula flex tip 23G ( B2410)", "preco": 130, "quantidade": 4, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "0000003272", "estoqueMinimo": 0, "id": 1757705992471, "nome": "Canula soft tip 23G ( 3194638 )", "preco": 130, "quantidade": 6, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "7898731960228", "estoqueMinimo": 0, "id": 1757706577300, "nome": "Seringa de 1ml ‚ö†Ô∏è", "preco": 1.55, "quantidade": 62, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "01", "estoqueMinimo": 1000, "id": 1758136670085, "nome": "GAS C3F8", "preco": 1.44, "quantidade": 13000, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "0", "estoqueMinimo": 1, "id": 1758200571535, "nome": "ANEL DE TENSAO CAPSULAR (SNJB753950) ‚ö†Ô∏è", "preco": 370, "quantidade": 2, "unidade": "unidade"}, {"categoria": "outros", "codigoBarras": "7898154460121", "estoqueMinimo": 3, "id": 1758291336654, "nome": "PERFLUORCARBONO", "preco": 341.9, "quantidade": 5, "unidade": "unidade"}, {"categoria": "", "codigoBarras": "", "estoqueMinimo": 0, "id": 1759966624621, "nome": "", "preco": 0, "quantidade": 0, "unidade": "unidade"}], "saldoAtual": 19600, "metadados": {"dataExportacao": "2025-10-08T23:48:02.520Z", "dataUltimaSalvamento": "08/10/2025, 20:40:05", "versaoSistema": "1.0", "nomeClinica": "Cl√≠nica Oftalmol√≥gica Dr. Leonardo"}};
      // acrescenta metadados de restaura√ß√£o
      if (typeof dados === 'object' && dados) {
        dados.dataUltimaRestauracao = new Date().toISOString();
        dados.versaoUnificada = '2025-10-08';
      }
      localStorage.setItem(KEY, JSON.stringify(dados));
      localStorage.setItem(LAST, new Date().toLocaleString('pt-BR'));
      console.log('Backup embutido restaurado no localStorage.');
    } else {
      console.log('Dados existentes encontrados no localStorage; restaura√ß√£o autom√°tica ignorada.');
    }
  } catch (e) {
    console.error('Falha ao restaurar backup embutido:', e);
  }
})();
</script>
