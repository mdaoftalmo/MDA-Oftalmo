<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login • Sistema Financeiro</title>
  <style>
    body {font-family: ui-sans-serif, system-ui, Arial; background: #0f172a; margin:0; min-height:100vh; display:grid; place-items:center;}
    .card {background:#fff; width:min(520px, 92vw); padding:28px 24px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.15);}
    h1 {margin:0 0 8px; font-size:22px; color:#0f172a;}
    p.sub {margin:0 0 18px; color:#475569; font-size:14px;}
    label {display:block; margin:12px 0 6px; font-weight:600; font-size:14px; color:#0f172a;}
    input {width:100%; padding:12px 12px; border:1px solid #cbd5e1; border-radius:10px; font-size:15px;}
    button {width:100%; margin-top:18px; padding:12px; border:0; border-radius:10px; font-weight:700; color:#fff; background:#1e3a8a; cursor:pointer;}
    .row {display:flex; align-items:center; justify-content:space-between; margin-top:10px; font-size:13px; color:#475569;}
    .error {margin-top:10px; color:#b91c1c; font-size:13px; display:none;}
  </style>
</head>
<body>
  <div class="card">
    <h1>Acesso ao Sistema</h1>
    <p class="sub">Entre com seu e‑mail e senha para acessar</p>

    <form id="loginForm">
      <label for="usuario">E‑mail</label>
      <input id="usuario" type="email" placeholder="seu@email.com" required />

      <label for="senha">Senha</label>
      <input id="senha" type="password" placeholder="••••••••" required />

      <div class="row">
        <label style="display:flex; gap:8px; align-items:center; font-weight:500;">
          <input id="remember" type="checkbox" /> Lembrar de mim
        </label>
        <a href="#" id="forgot" style="text-decoration:none;">Esqueceu a senha?</a>
      </div>

      <button type="submit">Entrar</button>
      <div id="msg" class="error">Erro ao entrar. Verifique e‑mail e senha.</div>
    </form>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, setPersistence, browserLocalPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    const firebaseConfig = {'apiKey': 'AIzaSyD1ruP7W5uYL185rOUnFqHd9GUlDp4VhXs', 'authDomain': 'clinica-981e8.firebaseapp.com', 'databaseURL': 'https://clinica-981e8-default-rtdb.firebaseio.com', 'projectId': 'clinica-981e8', 'storageBucket': 'clinica-981e8.appspot.com', 'messagingSenderId': '766482530366', 'appId': '1:766482530366:web:31321baff2da7a8623916f'};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // reset de senha
    document.getElementById('forgot').addEventListener('click', async (e) => {
      e.preventDefault();
      const email = (document.getElementById('usuario').value || '').trim();
      if (!email) return alert("Digite seu e‑mail no campo acima para receber o link.");
      try { await sendPasswordResetEmail(auth, email); alert("Enviamos um link de redefinição para seu e‑mail."); }
      catch (err) { console.error(err); alert("Não foi possível enviar o e‑mail. Confirme o endereço."); }
    });

    // login normal
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('usuario').value.trim();
      const senha = document.getElementById('senha').value;

      const remember = document.getElementById('remember').checked;
      await setPersistence(auth, remember ? browserLocalPersistence : browserSessionPersistence);

      try {
        await signInWithEmailAndPassword(auth, email, senha);
        localStorage.setItem('auth_ok', '1');
        window.location.href = "index.html";
      } catch (err) {
        console.error(err);
        const msg = document.getElementById('msg');
        msg.style.display = 'block';
        msg.textContent = "Usuário ou senha incorretos.";
      }
    });
  </script>
</body>
</html>
